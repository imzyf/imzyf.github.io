<!doctype html><html lang=en dir=auto data-theme=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes å…¥é—¨å®æˆ˜ Part1 | ZYF.IM BLOG</title><meta name=keywords content="kubernetes"><meta name=description content="01 åˆè¯† Docker
https://docs.docker.com/get-started/overview/
curl -fsSL https://get.docker.com | sudo sh
# sudo usermod -aG docker $USER
# newgrp docker
dockerd-rootless-setuptool.sh install

docker version
docker info
docker ps
docker pull busybox
# show all images
docker images
02 è¢«éš”ç¦»çš„è¿›ç¨‹
# æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ
docker pull alpine
# ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell
docker run -it alpine sh
# æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯
cat /etc/os-release
Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š

namespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾
cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰
chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

03 å®¹å™¨åŒ–çš„åº”ç”¨
Build once, Run anywhere."><meta name=author content="Me"><link rel=canonical href=https://zyf.im/2023/02/15/kubernetes-getting-started-part1/><link crossorigin=anonymous href=/assets/css/stylesheet.88888b1f97bcb20b824590bc7c6603a852913a2540638b3b3e2663e642691da3.css integrity="sha256-iIiLH5e8sguCRZC8fGYDqFKROiVAY4s7PiZj5kJpHaM=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zyf.im/2023/02/15/kubernetes-getting-started-part1/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="light"&&(document.querySelector("html").dataset.theme="light")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6DVZ6E58DG"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6DVZ6E58DG")}</script><meta property="og:url" content="https://zyf.im/2023/02/15/kubernetes-getting-started-part1/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="Kubernetes å…¥é—¨å®æˆ˜ Part1"><meta property="og:description" content="01 åˆè¯† Docker https://docs.docker.com/get-started/overview/
curl -fsSL https://get.docker.com | sudo sh # sudo usermod -aG docker $USER # newgrp docker dockerd-rootless-setuptool.sh install docker version docker info docker ps docker pull busybox # show all images docker images 02 è¢«éš”ç¦»çš„è¿›ç¨‹ # æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ docker pull alpine # ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell docker run -it alpine sh # æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ cat /etc/os-release Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š
namespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾ cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰ chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦» 03 å®¹å™¨åŒ–çš„åº”ç”¨ Build once, Run anywhere."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-15T14:46:38+08:00"><meta property="article:modified_time" content="2023-02-15T14:46:38+08:00"><meta property="article:tag" content="Kubernetes"><meta property="og:image" content="https://images.unsplash.com/photo-1451337516015-6b6e9a44a8a3?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=960&amp;q=80"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1451337516015-6b6e9a44a8a3?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=960&amp;q=80"><meta name=twitter:title content="Kubernetes å…¥é—¨å®æˆ˜ Part1"><meta name=twitter:description content="01 åˆè¯† Docker
https://docs.docker.com/get-started/overview/
curl -fsSL https://get.docker.com | sudo sh
# sudo usermod -aG docker $USER
# newgrp docker
dockerd-rootless-setuptool.sh install

docker version
docker info
docker ps
docker pull busybox
# show all images
docker images
02 è¢«éš”ç¦»çš„è¿›ç¨‹
# æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ
docker pull alpine
# ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell
docker run -it alpine sh
# æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯
cat /etc/os-release
Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š

namespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾
cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰
chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

03 å®¹å™¨åŒ–çš„åº”ç”¨
Build once, Run anywhere."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zyf.im/posts/"},{"@type":"ListItem","position":2,"name":"Kubernetes å…¥é—¨å®æˆ˜ Part1","item":"https://zyf.im/2023/02/15/kubernetes-getting-started-part1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes å…¥é—¨å®æˆ˜ Part1","name":"Kubernetes å…¥é—¨å®æˆ˜ Part1","description":"01 åˆè¯† Docker https://docs.docker.com/get-started/overview/\ncurl -fsSL https://get.docker.com | sudo sh # sudo usermod -aG docker $USER # newgrp docker dockerd-rootless-setuptool.sh install docker version docker info docker ps docker pull busybox # show all images docker images 02 è¢«éš”ç¦»çš„è¿›ç¨‹ # æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ docker pull alpine # ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell docker run -it alpine sh # æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ cat /etc/os-release Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š\nnamespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾ cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰ chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦» 03 å®¹å™¨åŒ–çš„åº”ç”¨ Build once, Run anywhere.\n","keywords":["kubernetes"],"articleBody":"01 åˆè¯† Docker https://docs.docker.com/get-started/overview/\ncurl -fsSL https://get.docker.com | sudo sh # sudo usermod -aG docker $USER # newgrp docker dockerd-rootless-setuptool.sh install docker version docker info docker ps docker pull busybox # show all images docker images 02 è¢«éš”ç¦»çš„è¿›ç¨‹ # æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ docker pull alpine # ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell docker run -it alpine sh # æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ cat /etc/os-release Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š\nnamespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾ cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰ chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦» 03 å®¹å™¨åŒ–çš„åº”ç”¨ Build once, Run anywhere.\nåº”ç”¨ç¨‹åºä¸å†ç›´æ¥å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œè€Œæ˜¯å°è£…æˆé•œåƒï¼Œå†äº¤ç»™å®¹å™¨ç¯å¢ƒå»è¿è¡Œã€‚\n# remove image docker rmi busybox # å¼€å¯ä¸€ä¸ªäº¤äº’å¼æ“ä½œçš„ Shell docker run -it busybox # åœ¨åå°è¿è¡Œ docker run -d busybox # ä¸ºå®¹å™¨èµ·ä¸€ä¸ªåå­— docker run -d --name xxx busybox # ä¸ä¿å­˜å®¹å™¨ï¼Œåªè¦è¿è¡Œå®Œæ¯•å°±è‡ªåŠ¨æ¸…é™¤ docker run --rm busybox echo \"hello docker\" docker stop xxx # remove container docker rm xxx # show all container docker ps -a docker exec xxx echo \"hello docker\" 05 é•œåƒä»“åº“ https://github.com/docker-library/official-images https://hub.docker.com/u/library ç”¨æˆ·å/åº”ç”¨å:æ ‡ç­¾ å®˜æ–¹é•œåƒç”¨æˆ·åæ˜¯ libraryã€‚\nslim ç»è¿‡ç²¾ç®€çš„ fat åŒ…å«äº†è¾ƒå¤šçš„è¾…åŠ©å·¥å…· rc å€™é€‰ç‰ˆæœ¬ï¼Œrelease candidate docker build -t docker tag ngx-app chronolaw/ngx-app:1.0 docker push chronolaw/ngx-app:1.0 save å’Œ load è¿™ä¸¤ä¸ªé•œåƒå½’æ¡£å‘½ä»¤ï¼š\ndocker save ngx-app:latest -o ngx.tar docker load -i ngx.tar 06 æ‰“ç ´æ¬¡å…ƒå£ docker run -d --rm --name ubu phusion/baseimage:jammy-1.0.1 echo \"hello\" \u003e a.txt # a.txt æ‹·è´åˆ°å®¹å™¨ tmp docker cp a.txt ubu:/tmp docker exec -it ubu bash # è€ƒå‡ºå®¹å™¨ docker cp ubu:/tmp/a.txt ./b.txt å®¹å™¨å’Œä¸»æœºå…±äº«æœ¬åœ°ç›®å½•ï¼š\n# --mount # -v /tmp:/tmp:ro åªè¯» docker run -d --rm -v /tmp:/tmp --name ubu phusion/baseimage:jammy-1.0.1 docker exec -it ubu bash docker pull python:alpine docker run -it --rm -v `pwd`:/tmp python:alpine sh ç½‘ç»œæ¨¡å¼ï¼šnull host bridge\n# host docker run -d --rm --net=host --name=ng nginx:alpine docker exec ng ip addr docker inspect ng | grep IPAddress docker stop ng # bridge é»˜è®¤æ¨¡å¼ docker run -d --rm --name=ng nginx:alpine docker inspect ng | grep IPAddress # \"IPAddress\": \"172.17.0.3\" docker run -d --rm --name=rd redis docker inspect rd | grep IPAddress # \"IPAddress\": \"172.17.0.4\" åˆ†é…æœåŠ¡ç«¯å£å·\ndocker run -d -p 80:80 --rm nginx:alpine docker run -d -p 8080:80 --rm nginx:alpine # åˆ†åˆ«â€œæ˜ å°„â€åˆ°äº†ä¸¤ä¸ªå®¹å™¨é‡Œçš„ 80 ç«¯å£ 07 ç©è½¬ Docker Container Image Registry\nhttps://registry.hub.docker.com/_/registry/\ndocker run -d -p 5000:5000 registry # ä½¿ç”¨ docker tag å‘½ä»¤ç»™é•œåƒæ‰“æ ‡ç­¾å†ä¸Šä¼  docker tag nginx:alpine 127.0.0.1:5000/nginx:alpine docker push 127.0.0.1:5000/nginx:alpine # æœ¬æ¬¡é‡æ–°æ‹‰å–æµ‹è¯• docker rmi 127.0.0.1:5000/nginx:alpine docker pull 127.0.0.1:5000/nginx:alpine https://docs.docker.com/registry/spec/api/\n# Listing Repositories curl 127.1:5000/v2/_catalog # {\"repositories\":[\"nginx\"]} curl 127.1:5000/v2/nginx/tags/list # {\"name\":\"nginx\",\"tags\":[\"alpine\"]} registry é»˜è®¤ä¼šæŠŠé•œåƒå­˜å‚¨åœ¨ Docker å†…éƒ¨ç›®å½• /var/lib/registryã€‚\næ­å»º WordPressï¼š\ndocker run -d --rm \\ --env MARIADB_DATABASE=db \\ --env MARIADB_USER=wp \\ --env MARIADB_PASSWORD=123 \\ --env MARIADB_ROOT_PASSWORD=123 \\ --name mariadb \\ mariadb:10 # è¿›å…¥ mariadb docker exec -it mariadb mysql -uwp -p123 # show mariadb ip docker inspect mariadb | grep IPAddress # \"IPAddress\": \"172.17.0.2\" docker run -d --rm \\ --env WORDPRESS_DB_HOST=172.17.0.2 \\ --env WORDPRESS_DB_USER=wp \\ --env WORDPRESS_DB_PASSWORD=123 \\ --env WORDPRESS_DB_NAME=db \\ --name wp \\ wordpress:5 docker inspect wp | grep IPAddress # \"IPAddress\": \"172.17.0.4\" vim wp.conf server { listen 80; default_type text/html; location / { proxy_http_version 1.1; proxy_set_header Host $host; # wordpress server proxy_pass http://172.17.0.4; } } # æ„Ÿè§‰å¯ä»¥ç›´æ¥ç”¨ wordpress çš„ 80ï¼Œæ— éœ€å†ä»£ç†ä¸€æ¬¡ docker run -d --rm \\ -p 80:80 \\ -v `pwd`/wp.conf:/etc/nginx/conf.d/default.conf \\ --name ng \\ nginx:alpine # show logs docker logs mariadb docker logs ng docker logs wp 08 å…¥é—¨ç¯‡æ€»ç»“ æ„å»ºè‡ªå·±çš„é•œåƒï¼š\nhttps://github.com/chronolaw/k8s_study/blob/master/ch1/Dockerfile\nARG IMAGE_BASE=\"nginx\" ARG IMAGE_TAG=\"1.21-alpine\" FROM ${IMAGE_BASE}:${IMAGE_TAG} ENV PATH=$PATH:/tmp ENV DEBUG=OFF COPY ./default.conf /etc/nginx/conf.d/ RUN cd /usr/share/nginx/html \\ \u0026\u0026 echo \"hello nginx\" \u003e a.txt EXPOSE 8081 8082 8083 WORKDIR /etc/nginx docker build -t ngx-app:1.0 . docker run -it --rm ngx-app:1.0 sh docker save ngx-app:1.0 -o ngx.tar docker load -i ngx.tar 09 Kubernetes ç¯å¢ƒ Kubernetes å°±æ˜¯ä¸€ä¸ª Production-Grade Container Orchestration ç”Ÿäº§çº§åˆ«çš„å®¹å™¨ç¼–æ’å¹³å°å’Œé›†ç¾¤ç®¡ç†ç³»ç»Ÿã€‚\nminikube quickly sets up a local Kubernetes cluster on macOS, Linux, and Windows.\nbrew install minikube minikube version # minikube version: v1.37.0 # commit: 65318f4cfff9c12cc87ec9eb8f4cdd57b25047f3 # ç»Ÿä¸€å®éªŒç¯å¢ƒ minikube start # æŸ¥çœ‹çŠ¶æ€ minikube status # type: Control Plane # host: Running # kubelet: Running # apiserver: Running # kubeconfig: Configured minikube node list # minikube 192.168.49.2 # ç™»å½•åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Š minikube ssh uname -a # Linux minikube 6.17.8-orbstack-00308-g8f9c941121b1 #1 SMP PREEMPT Thu Nov 20 09:34:02 UTC 2025 aarch64 aarch64 aarch64 GNU/Linux ip add # minikube ç®¡ç† Kubernetes é›†ç¾¤ç¯å¢ƒ # kubectl æ“ä½œå®é™…çš„ Kubernetes åŠŸèƒ½ # install kubectl minikube kubectl minikube kubectl -- version # Client Version: v1.34.0 # Kustomize Version: v5.7.1 # Server Version: v1.34.0 alias kubectl=\"minikube kubectl --\" kubectl version # å¯åŠ¨ä¸€ä¸ªé•œåƒ kubectl run ngx --image=nginx:alpine # like docker ps kubectl get pod # NAME READY STATUS RESTARTS AGE # ngx 0/1 ContainerCreating 0 7s 10 Kubernetes å·¥ä½œæœºåˆ¶ Kubernetes æ¶æ„åŸºäºæµè¡Œçš„â€œæ§åˆ¶é¢ Control Plane / æ•°æ®é¢ Data Planeâ€è®¾è®¡ã€‚é›†ç¾¤ç”±å¤šä¸ªâ€œèŠ‚ç‚¹â€ï¼ˆNodeï¼‰ç»„æˆï¼Œåº•å±‚ç¯å¢ƒæ”¯æŒç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚\næŒ‰ç…§åŠŸèƒ½åˆ’åˆ†ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šè´Ÿè´£â€œå¤§è„‘â€å·¥ä½œçš„ Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰ï¼Œç”¨äºæ‰§è¡Œç®¡ç†å’Œè°ƒåº¦ä»»åŠ¡ï¼›ä»¥åŠè´Ÿè´£â€œä½“åŠ›â€å·¥ä½œçš„ Worker èŠ‚ç‚¹ï¼ˆæ•°æ®é¢ï¼‰ï¼Œç”¨äºè¿è¡Œå…·ä½“çš„ä¸šåŠ¡åº”ç”¨ã€‚\nkubectl get node # NAME STATUS ROLES AGE VERSION # minikube Ready control-plane 11m v1.34.0 # æŸ¥çœ‹ master Component pod kubectl get pod -n kube-system # NAME READY STATUS RESTARTS AGE # coredns-66bc5c9577-6c27s 1/1 Running 0 11m # etcd-minikube 1/1 Running 0 11m # kube-apiserver-minikube 1/1 Running 0 11m # kube-controller-manager-minikube 1/1 Running 0 11m # kube-proxy-9v5wf 1/1 Running 0 11m # kube-scheduler-minikube 1/1 Running 0 11m # storage-provisioner 1/1 Running 0 11m # worker node minikube ssh # show kube-proxy docker ps | grep kube-proxy # show kubelet, not exist docker ps -ef | grep kubelet # show addons list minikube addons list minikube dashboard # ğŸ‰ Opening http://127.0.0.1:50733/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser... 11 YAML YAML åœ¨è¯­æ³•ä¸Šæ˜¯ JSON çš„è¶…é›†ï¼Œå¸¸è¢«ç”¨ä½œ Kubernetes çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚\nå…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ç§æ€ç»´æ¨¡å¼ï¼šShell è„šæœ¬å’Œ Dockerfile æ˜¯å…¸å‹çš„ â€œå‘½ä»¤å¼â€ï¼Œå®ƒå‘Šè¯‰æœºå™¨â€œç¬¬ä¸€æ­¥åšä»€ä¹ˆï¼Œç¬¬äºŒæ­¥åšä»€ä¹ˆâ€ï¼›è€Œ Kubernetes æ¨å´‡ â€œå£°æ˜å¼â€ï¼Œå®ƒåªå‘Šè¯‰æœºå™¨â€œæˆ‘æƒ³è¦ä»€ä¹ˆæ ·çš„ç»“æœâ€ï¼Œå…·ä½“çš„æ­¥éª¤ç”±ç³»ç»Ÿè‡ªå·±å®Œæˆã€‚\næœ€åï¼ŒKubernetes çš„æ ¸å¿ƒç»„ä»¶ apiserver å€Ÿé‰´äº† HTTP åè®®ä¸­â€œèµ„æºâ€çš„æ¦‚å¿µï¼Œä½¿ç”¨äº†æ ‡å‡†çš„ RESTful é£æ ¼ã€‚åœ¨ K8s çš„ä½“ç³»é‡Œï¼Œæ‰€æœ‰è¢«ç®¡ç†çš„å†…å®¹ï¼ˆå¦‚ Pod, Serviceï¼‰éƒ½è¢«æŠ½è±¡æˆäº† â€œAPI å¯¹è±¡â€ æ¥è¿›è¡Œæ“ä½œã€‚\n# æŸ¥çœ‹ kubectl api-service æ”¯æŒçš„æ‰€æœ‰å¯¹è±¡ kubectl api-resources # æ˜¾ç¤ºå‡ºè¯¦ç»†çš„å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ kubectl get pod --v=9 # è‡ªå¸¦çš„ API æ–‡æ¡£ https://kubernetes.io/docs/reference/kubernetes-api/ kubectl explain pod kubectl explain pod.metadata # å‘½ä»¤å¼ kubectl run ngx --image=nginx:alpine # è½¬æ¢ä¸º YAML å£°åå¼ kubectl run ngx --image=nginx:alpine --dry-run=client -o yaml \u003e ngx-pod.yml kubectl apply -f ngx-pod.yml kubectl delete -f ngx-pod.yml apiVersion: v1 kind: Pod metadata: creationTimestamp: null labels: run: ngx name: ngx spec: containers: - image: nginx:alpine name: ngx resources: {} dnsPolicy: ClusterFirst restartPolicy: Always status: {} 12 Pod æ—¢ç„¶ Docker å®¹å™¨æå€¡â€œä¸€ä¸ªå®¹å™¨åªè·‘ä¸€ä¸ªè¿›ç¨‹â€ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦å¤šä¸ªç´§å¯†åä½œçš„è¿›ç¨‹ï¼ˆå¤šåº”ç”¨è”åˆè¿è¡Œï¼‰å…±åŒå·¥ä½œæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç ´åå•å®¹å™¨å•è¿›ç¨‹çš„éš”ç¦»åŸåˆ™ï¼ˆä¸ç ´åå®¹å™¨éš”ç¦»ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨ä¹‹ä¸Šå¼•å…¥ä¸€ä¸ªæ›´é«˜å±‚çº§çš„æŠ½è±¡å¯¹è±¡ï¼ˆæ”¶çº³èˆ±/Podï¼‰ï¼Œè®©è¿™äº›å®¹å™¨åœ¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨çš„åŒæ—¶ï¼Œä¾ç„¶ä¿æŒé•œåƒå±‚é¢çš„ç‹¬ç«‹ã€‚\nkubectl apply -f ngx-pod.yml kubectl logs ngx kubectl get pod kubectl describe pod ngx # cp file to pod echo 'aaa' \u003e a.txt kubectl cp a.txt ngx:/tmp # exec need -- kubectl exec -it ngx -- sh cat /tmp/a.txt 13 Job CronJob ç¦»çº¿ä¸šåŠ¡ å•ä¸€èŒè´£ æ„å‘³ç€æ¯ä¸ªå®¹å™¨åº”å½“åªè¿è¡Œä¸€ä¸ªæ ¸å¿ƒè¿›ç¨‹ã€‚é¿å…â€œå¤§è€Œå…¨â€çš„å·¨å‹å®¹å™¨ï¼Œä¿æŒå®¹å™¨åŠŸèƒ½çš„å•ä¸€å’Œçº¯ç²¹ï¼Œæ‰èƒ½è®©å®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·è¢«çµæ´»å¤ç”¨å’Œç‹¬ç«‹å‡çº§ã€‚\nç»„åˆä¼˜äºç»§æ‰¿ æ„å‘³ç€åº”è¯¥é€šè¿‡â€œç»„åˆâ€å¤šä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼ˆPod æ¨¡å¼ï¼‰æ¥æ„å»ºå¤æ‚çš„åº”ç”¨ï¼Œè€Œä¸æ˜¯é€šè¿‡â€œç»§æ‰¿â€åŸºç¡€é•œåƒå¹¶åœ¨å…¶ä¸Šå±‚å±‚å åŠ æ‰€æœ‰åŠŸèƒ½ï¼ˆå·¨å‹é•œåƒï¼‰ã€‚è¿™ç§æ¾è€¦åˆçš„æ–¹å¼ï¼Œå…è®¸åº”ç”¨åœ¨è¿è¡Œæ—¶é€šè¿‡ Sidecar ç­‰æ¨¡å¼çµæ´»åä½œï¼Œè€Œä¸æ˜¯è¢«å›ºåŒ–åœ¨åŒä¸€ä¸ªé•œåƒæ–‡ä»¶é‡Œã€‚\nkubectl create job echo-job --image=busybox --dry-run=client -o yaml \u003e echo-job.yml # å‘Šè¯‰ k8s æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªåä¸º echo-job çš„ä»»åŠ¡ï¼ˆJobï¼‰ã€‚ # --dry-run=client å‘Šè¯‰ kubectlï¼Œâ€œä½ å‡è£…æ‰§è¡Œä¸€ä¸‹åˆ›å»ºå‘½ä»¤ï¼Œæ£€æŸ¥ä¸€ä¸‹è¯­æ³•ï¼Œä½†æ˜¯åƒä¸‡ä¸è¦çœŸçš„æŠŠè¯·æ±‚å‘ç»™ Kubernetes API Serverï¼Œä¹Ÿä¸è¦çœŸçš„åœ¨é›†ç¾¤é‡Œåˆ›å»ºè¿™ä¸ª Jobâ€ vim echo-job.yml apiVersion: batch/v1 kind: Job metadata: creationTimestamp: null name: echo-job spec: template: metadata: creationTimestamp: null spec: containers: - image: busybox name: echo-job resources: {} # è¡¥å……è¾“å‡º command: [\"echo\", \"hello world\"] # ----- restartPolicy: Never status: {} kubectl apply -f echo-job.yml kubectl get job # NAME COMPLETIONS DURATION AGE # echo-job 1/1 16s 33s kubectl get pod # NAME READY STATUS RESTARTS AGE # echo-job-59sgn 0/1 Completed 0 68s kubectl logs echo-job-59sgn # hello world apiVersion: batch/v1 kind: Job metadata: creationTimestamp: null name: sleep-job spec: # è®¾ç½® Pod è¿è¡Œçš„è¶…æ—¶æ—¶é—´ activeDeadlineSeconds: 60 # è®¾ç½® Pod çš„å¤±è´¥é‡è¯•æ¬¡æ•° backoffLimit: 2 # Job å®Œæˆéœ€è¦è¿è¡Œå¤šå°‘ä¸ª Podï¼Œé»˜è®¤æ˜¯ 1 completions: 4 # å®ƒä¸ completions ç›¸å…³ï¼Œè¡¨ç¤ºå…è®¸å¹¶å‘è¿è¡Œçš„ Pod æ•°é‡ï¼Œé¿å…è¿‡å¤šå ç”¨èµ„æº parallelism: 2 template: metadata: creationTimestamp: null spec: containers: - image: busybox name: echo-job resources: {} # éšæœºä¼‘çœ  command: - sh - -c - sleep $(($RANDOM % 10 + 1)) \u0026\u0026 echo done restartPolicy: Never status: {} kubectl apply -f sleep-job.yaml kubectl get pod -w # NAME READY STATUS RESTARTS AGE # sleep-job-92m4d 0/1 Completed 0 30s # sleep-job-g8pmj 0/1 Completed 0 15s # sleep-job-tsncl 0/1 Completed 0 30s # sleep-job-x4qlp 0/1 Completed 0 15s # cronjob kubectl create cj echo-cj --image=busybox --schedule=\"*/1 * * * *\" --dry-run=client -o yaml \u003e echo-cj.yaml apiVersion: batch/v1 kind: CronJob metadata: creationTimestamp: null name: echo-cj spec: jobTemplate: metadata: creationTimestamp: null name: echo-cj spec: template: metadata: creationTimestamp: null spec: containers: - image: busybox name: echo-cj resources: {} # è¡¥å……è¾“å‡º command: [\"/bin/echo\"] args: [\"hello\", \"world\"] restartPolicy: OnFailure schedule: \"*/1 * * * *\" status: {} kubectl apply -f echo-cj.yaml kubectl get cj # NAME SCHEDULE SUSPEND ACTIVE LAST SCHEDULE AGE # echo-cj */1 * * * * False 1 5s 8s kubectl get pod # NAME READY STATUS RESTARTS AGE # echo-cj-27942326-qng4j 0/1 Completed 0 93s # echo-cj-27942327-vlrvs 0/1 Completed 0 33s 14 ConfigMap Secret ç®¡ç†é…ç½®ä¿¡æ¯ kubectl create cm info --from-literal=name=zhao --dry-run=client -o yaml \u003e cm.yml kubectl apply -f cm.yml kubectl get cm kubectl describe cm info kubectl create secret generic user --from-literal=name=root --dry-run=client -o yaml \u003e secret.yml # -n å»æ‰å­—ç¬¦ä¸²é‡Œéšå«çš„æ¢è¡Œç¬¦ echo -n \"root\" | base64 kubectl apply -f secret.yml kubectl get secret kubectl describe secret user kubectl explain pod.spec.containers.env.valueFrom apiVersion: v1 kind: Pod metadata: creationTimestamp: null labels: run: ngx name: ngx spec: containers: - image: nginx:alpine name: ngx resources: {} env: - name: NAME valueFrom: configMapKeyRef: name: info key: name - name: SNAME valueFrom: secretKeyRef: name: user key: name dnsPolicy: ClusterFirst restartPolicy: Always status: {} kubectl apply -f env-pod.yml kubectl exec -it ngx -- sh echo $NAME $SNAME # ä»¥ Volume çš„æ–¹å¼ä½¿ç”¨ ConfigMap/Secret apiVersion: v1 kind: Pod metadata: name: vol-pod spec: # Volume å±äº Pod ä¸ containers åŒçº§ volumes: - name: cm-vol configMap: name: info - name: sec-vol secret: secretName: user containers: # æŒ‚è½½åˆ°å®¹å™¨é‡Œçš„æŸä¸ªè·¯å¾„ä¸‹ - volumeMounts: - mountPath: /tmp/cm-items name: cm-vol - mountPath: /tmp/sec-items name: sec-vol image: nginx:alpine name: ngx resources: {} dnsPolicy: ClusterFirst restartPolicy: Always status: {} vim vol-pod.yml kubectl apply -f vol-pod.yml kubectl get pod kubectl exec -it vol-pod -- sh cat /tmp/cm-items/name cat /tmp/sec-items/name # ConfigMap å’Œ Secret éƒ½å˜æˆäº†ç›®å½•çš„å½¢å¼ï¼Œè€Œå®ƒä»¬é‡Œé¢çš„ Key-Value å˜æˆäº†ä¸€ä¸ªä¸ªçš„æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶åå°±æ˜¯ Keyã€‚ 15 ç©è½¬ Kubernetes æ­å»º WordPress ç¯å¢ƒï¼š\n# vim mariadb-pod.yml apiVersion: v1 kind: ConfigMap metadata: name: maria-cm data: DATABASE: \"db\" USER: \"wp\" PASSWORD: \"123\" ROOT_PASSWORD: \"123\" --- apiVersion: v1 kind: Pod metadata: name: maria-pod labels: app: wordpress role: database spec: containers: - image: mariadb:10 name: maria imagePullPolicy: IfNotPresent ports: - containerPort: 3306 envFrom: - prefix: \"MARIADB_\" configMapRef: name: maria-cm kubectl apply -f mariadb-pod.yml # è·å– IP åœ°å€éœ€è¦åŠ ä¸Šå‚æ•° -o wide kubectl get pod -o wide # NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES # maria-pod 1/1 Running 0 64s 172.17.0.5 minikube # vim wp-pod.yml apiVersion: v1 kind: ConfigMap metadata: name: wp-cm data: # MariaDB Pod çš„ IP HOST: \"172.17.0.5\" USER: \"wp\" PASSWORD: \"123\" NAME: \"db\" --- apiVersion: v1 kind: Pod metadata: name: wp-pod labels: app: wordpress role: website spec: containers: - image: wordpress:5 name: wp-pod imagePullPolicy: IfNotPresent ports: - containerPort: 80 envFrom: - prefix: \"WORDPRESS_DB_\" configMapRef: name: wp-cm kubectl apply -f wp-pod.yml kubectl get pod -o wide # NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES # maria-pod 1/1 Running 0 160m 172.17.0.5 minikube # wp-pod 1/1 Running 0 2m47s 172.17.0.6 minikube # æœ¬åœ°çš„ â€œ8080â€ æ˜ å°„åˆ° WordPress Pod çš„â€œ80â€ kubectl port-forward wp-pod 8080:80 \u0026 # Forwarding from 127.0.0.1:8080 -\u003e 80 # Forwarding from [::1]:8080 -\u003e 80 # fg 16 åˆçº§ç¯‡æ€»ç»“ minikube version minikube status minikube start --kubernetes-version=v1.23.3 minikube node list kubectl version kubectl run ngx --image=nginx:alpine # apiserver ç­‰æ ¸å¿ƒç»„ä»¶æ˜¯åœ¨ kube-system åå­—ç©ºé—´ kubectl get pod -n kube-system kubectl api-resources kubectl explain pod.metadata export out=\"--dry-run=client -o yaml\" kubectl run ngx --image=nginx:alpine $out \u003e pod.yml kubectl apply -f ngx-pod.yml kubectl get pod kubectl logs ngx-pod kubectl exec -it ngx-pod -- sh kubectl delete -f ngx-pod kubectl create job echo-job --image=busybox $out kubectl apply -f job.yml kubectl get job kubectl get pod kubectl logs echo-job-l52l7 kubectl create cj echo-cj --image=busybox --schedule=\"* * * * *\" $out kubectl apply -f cronjob.yml kubectl get cj kubectl get pod kubectl create cm info --from-literal=k=v $out kubectl get cm kubectl describe cm info kubectl create secret generic user --from-literal=name=root $out kubectl get secret kubectl describe secret user echo cm9vdA== | base64 -d References chronolaw/k8s_study | GitHub â€“ EOF â€“\n","wordCount":"1873","inLanguage":"en","image":"https://images.unsplash.com/photo-1451337516015-6b6e9a44a8a3?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=960\u0026q=80","datePublished":"2023-02-15T14:46:38+08:00","dateModified":"2023-02-15T14:46:38+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zyf.im/2023/02/15/kubernetes-getting-started-part1/"},"publisher":{"@type":"Organization","name":"ZYF.IM BLOG","logo":{"@type":"ImageObject","url":"https://zyf.im/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zyf.im/>Home</a>&nbsp;Â»&nbsp;<a href=https://zyf.im/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Kubernetes å…¥é—¨å®æˆ˜ Part1</h1><div class=post-meta><span title='2023-02-15 14:46:38 +0800 CST'>February 15, 2023</span>&nbsp;Â·&nbsp;<span>9 min</span>&nbsp;Â·&nbsp;<span>1873 words</span>&nbsp;Â·&nbsp;<span>Me</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#01-åˆè¯†-docker>01 åˆè¯† Docker</a></li><li><a href=#02-è¢«éš”ç¦»çš„è¿›ç¨‹>02 è¢«éš”ç¦»çš„è¿›ç¨‹</a></li><li><a href=#03-å®¹å™¨åŒ–çš„åº”ç”¨>03 å®¹å™¨åŒ–çš„åº”ç”¨</a></li><li><a href=#05-é•œåƒä»“åº“>05 é•œåƒä»“åº“</a></li><li><a href=#06-æ‰“ç ´æ¬¡å…ƒå£>06 æ‰“ç ´æ¬¡å…ƒå£</a></li><li><a href=#07-ç©è½¬-docker>07 ç©è½¬ Docker</a></li><li><a href=#08-å…¥é—¨ç¯‡æ€»ç»“>08 å…¥é—¨ç¯‡æ€»ç»“</a></li><li><a href=#09-kubernetes-ç¯å¢ƒ>09 Kubernetes ç¯å¢ƒ</a></li><li><a href=#10-kubernetes-å·¥ä½œæœºåˆ¶>10 Kubernetes å·¥ä½œæœºåˆ¶</a></li><li><a href=#11-yaml>11 YAML</a></li><li><a href=#12-pod>12 Pod</a></li><li><a href=#13-job-cronjob-ç¦»çº¿ä¸šåŠ¡>13 Job CronJob ç¦»çº¿ä¸šåŠ¡</a></li><li><a href=#14-configmap-secret-ç®¡ç†é…ç½®ä¿¡æ¯>14 ConfigMap Secret ç®¡ç†é…ç½®ä¿¡æ¯</a></li><li><a href=#15-ç©è½¬-kubernetes>15 ç©è½¬ Kubernetes</a></li><li><a href=#16-åˆçº§ç¯‡æ€»ç»“>16 åˆçº§ç¯‡æ€»ç»“</a></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h2 id=01-åˆè¯†-docker>01 åˆè¯† Docker<a hidden class=anchor aria-hidden=true href=#01-åˆè¯†-docker>#</a></h2><p><a href=https://docs.docker.com/get-started/overview/>https://docs.docker.com/get-started/overview/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -fsSL https://get.docker.com <span class=p>|</span> sudo sh
</span></span><span class=line><span class=cl><span class=c1># sudo usermod -aG docker $USER</span>
</span></span><span class=line><span class=cl><span class=c1># newgrp docker</span>
</span></span><span class=line><span class=cl>dockerd-rootless-setuptool.sh install
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker version
</span></span><span class=line><span class=cl>docker info
</span></span><span class=line><span class=cl>docker ps
</span></span><span class=line><span class=cl>docker pull busybox
</span></span><span class=line><span class=cl><span class=c1># show all images</span>
</span></span><span class=line><span class=cl>docker images
</span></span></code></pre></div><h2 id=02-è¢«éš”ç¦»çš„è¿›ç¨‹>02 è¢«éš”ç¦»çš„è¿›ç¨‹<a hidden class=anchor aria-hidden=true href=#02-è¢«éš”ç¦»çš„è¿›ç¨‹>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æ‹‰å–è½»é‡çº§ Alpine Linux é•œåƒ</span>
</span></span><span class=line><span class=cl>docker pull alpine
</span></span><span class=line><span class=cl><span class=c1># ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨å¹¶è¿›å…¥ shell</span>
</span></span><span class=line><span class=cl>docker run -it alpine sh
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹å®¹å™¨å†…çš„æ“ä½œç³»ç»Ÿä¿¡æ¯</span>
</span></span><span class=line><span class=cl>cat /etc/os-release
</span></span></code></pre></div><p>Docker å®ç°èµ„æºéš”ç¦»çš„ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š</p><ul><li>namespaceï¼šéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰èµ„æºè§†å›¾</li><li>cgroupï¼šé™åˆ¶å’Œç›‘æ§èµ„æºä½¿ç”¨ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/O ç­‰ï¼‰</li><li>chroot/pivot_rootï¼šæ”¹å˜è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå®ç°æ–‡ä»¶ç³»ç»Ÿéš”ç¦»</li></ul><h2 id=03-å®¹å™¨åŒ–çš„åº”ç”¨>03 å®¹å™¨åŒ–çš„åº”ç”¨<a hidden class=anchor aria-hidden=true href=#03-å®¹å™¨åŒ–çš„åº”ç”¨>#</a></h2><p>Build once, Run anywhere.</p><p>åº”ç”¨ç¨‹åºä¸å†ç›´æ¥å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œè€Œæ˜¯å°è£…æˆé•œåƒï¼Œå†äº¤ç»™å®¹å™¨ç¯å¢ƒå»è¿è¡Œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># remove image</span>
</span></span><span class=line><span class=cl>docker rmi busybox
</span></span><span class=line><span class=cl><span class=c1># å¼€å¯ä¸€ä¸ªäº¤äº’å¼æ“ä½œçš„ Shell</span>
</span></span><span class=line><span class=cl>docker run -it busybox
</span></span><span class=line><span class=cl><span class=c1># åœ¨åå°è¿è¡Œ</span>
</span></span><span class=line><span class=cl>docker run -d busybox
</span></span><span class=line><span class=cl><span class=c1># ä¸ºå®¹å™¨èµ·ä¸€ä¸ªåå­—</span>
</span></span><span class=line><span class=cl>docker run -d --name xxx busybox
</span></span><span class=line><span class=cl><span class=c1># ä¸ä¿å­˜å®¹å™¨ï¼Œåªè¦è¿è¡Œå®Œæ¯•å°±è‡ªåŠ¨æ¸…é™¤</span>
</span></span><span class=line><span class=cl>docker run --rm busybox <span class=nb>echo</span> <span class=s2>&#34;hello docker&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker stop xxx
</span></span><span class=line><span class=cl><span class=c1># remove container</span>
</span></span><span class=line><span class=cl>docker rm xxx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># show all container</span>
</span></span><span class=line><span class=cl>docker ps -a
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> xxx <span class=nb>echo</span> <span class=s2>&#34;hello docker&#34;</span>
</span></span></code></pre></div><h2 id=05-é•œåƒä»“åº“>05 é•œåƒä»“åº“<a hidden class=anchor aria-hidden=true href=#05-é•œåƒä»“åº“>#</a></h2><ul><li><a href=https://github.com/docker-library/official-images>https://github.com/docker-library/official-images</a></li><li><a href=https://hub.docker.com/u/library>https://hub.docker.com/u/library</a></li></ul><p><code>ç”¨æˆ·å/åº”ç”¨å:æ ‡ç­¾</code> å®˜æ–¹é•œåƒç”¨æˆ·åæ˜¯ <code>library</code>ã€‚</p><ul><li>slim ç»è¿‡ç²¾ç®€çš„</li><li>fat åŒ…å«äº†è¾ƒå¤šçš„è¾…åŠ©å·¥å…·</li><li>rc å€™é€‰ç‰ˆæœ¬ï¼Œrelease candidate</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t
</span></span><span class=line><span class=cl>docker tag ngx-app chronolaw/ngx-app:1.0
</span></span><span class=line><span class=cl>docker push chronolaw/ngx-app:1.0
</span></span></code></pre></div><p>save å’Œ load è¿™ä¸¤ä¸ªé•œåƒå½’æ¡£å‘½ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker save ngx-app:latest -o ngx.tar
</span></span><span class=line><span class=cl>docker load -i ngx.tar
</span></span></code></pre></div><h2 id=06-æ‰“ç ´æ¬¡å…ƒå£>06 æ‰“ç ´æ¬¡å…ƒå£<a hidden class=anchor aria-hidden=true href=#06-æ‰“ç ´æ¬¡å…ƒå£>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --rm --name ubu phusion/baseimage:jammy-1.0.1
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;hello&#34;</span> &gt; a.txt
</span></span><span class=line><span class=cl><span class=c1># a.txt æ‹·è´åˆ°å®¹å™¨ tmp</span>
</span></span><span class=line><span class=cl>docker cp a.txt ubu:/tmp
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it ubu bash
</span></span><span class=line><span class=cl><span class=c1># è€ƒå‡ºå®¹å™¨</span>
</span></span><span class=line><span class=cl>docker cp ubu:/tmp/a.txt ./b.txt
</span></span></code></pre></div><p>å®¹å™¨å’Œä¸»æœºå…±äº«æœ¬åœ°ç›®å½•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># --mount</span>
</span></span><span class=line><span class=cl><span class=c1># -v /tmp:/tmp:ro åªè¯»</span>
</span></span><span class=line><span class=cl>docker run -d --rm -v /tmp:/tmp --name ubu phusion/baseimage:jammy-1.0.1
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it ubu bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker pull python:alpine
</span></span><span class=line><span class=cl>docker run -it --rm -v <span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>:/tmp python:alpine sh
</span></span></code></pre></div><p>ç½‘ç»œæ¨¡å¼ï¼š<code>null</code> <code>host</code> <code>bridge</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># host</span>
</span></span><span class=line><span class=cl>docker run -d --rm --net<span class=o>=</span>host --name<span class=o>=</span>ng nginx:alpine
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> ng ip addr
</span></span><span class=line><span class=cl>docker inspect ng <span class=p>|</span> grep IPAddress
</span></span><span class=line><span class=cl>docker stop ng
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bridge é»˜è®¤æ¨¡å¼</span>
</span></span><span class=line><span class=cl>docker run -d --rm --name<span class=o>=</span>ng nginx:alpine
</span></span><span class=line><span class=cl>docker inspect ng <span class=p>|</span> grep IPAddress
</span></span><span class=line><span class=cl><span class=c1># &#34;IPAddress&#34;: &#34;172.17.0.3&#34;</span>
</span></span><span class=line><span class=cl>docker run -d --rm --name<span class=o>=</span>rd redis
</span></span><span class=line><span class=cl>docker inspect rd <span class=p>|</span> grep IPAddress
</span></span><span class=line><span class=cl><span class=c1># &#34;IPAddress&#34;: &#34;172.17.0.4&#34;</span>
</span></span></code></pre></div><p>åˆ†é…æœåŠ¡ç«¯å£å·</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -p 80:80 --rm nginx:alpine
</span></span><span class=line><span class=cl>docker run -d -p 8080:80 --rm nginx:alpine
</span></span><span class=line><span class=cl><span class=c1># åˆ†åˆ«â€œæ˜ å°„â€åˆ°äº†ä¸¤ä¸ªå®¹å™¨é‡Œçš„ 80 ç«¯å£</span>
</span></span></code></pre></div><h2 id=07-ç©è½¬-docker>07 ç©è½¬ Docker<a hidden class=anchor aria-hidden=true href=#07-ç©è½¬-docker>#</a></h2><p>Container Image Registry</p><p><a href=https://registry.hub.docker.com/_/registry/>https://registry.hub.docker.com/_/registry/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -p 5000:5000 registry
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ docker tag å‘½ä»¤ç»™é•œåƒæ‰“æ ‡ç­¾å†ä¸Šä¼ </span>
</span></span><span class=line><span class=cl>docker tag nginx:alpine 127.0.0.1:5000/nginx:alpine
</span></span><span class=line><span class=cl>docker push 127.0.0.1:5000/nginx:alpine
</span></span><span class=line><span class=cl><span class=c1># æœ¬æ¬¡é‡æ–°æ‹‰å–æµ‹è¯•</span>
</span></span><span class=line><span class=cl>docker rmi 127.0.0.1:5000/nginx:alpine
</span></span><span class=line><span class=cl>docker pull 127.0.0.1:5000/nginx:alpine
</span></span></code></pre></div><p><a href=https://docs.docker.com/registry/spec/api/>https://docs.docker.com/registry/spec/api/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Listing Repositories</span>
</span></span><span class=line><span class=cl>curl 127.1:5000/v2/_catalog
</span></span><span class=line><span class=cl><span class=c1># {&#34;repositories&#34;:[&#34;nginx&#34;]}</span>
</span></span><span class=line><span class=cl>curl 127.1:5000/v2/nginx/tags/list
</span></span><span class=line><span class=cl><span class=c1># {&#34;name&#34;:&#34;nginx&#34;,&#34;tags&#34;:[&#34;alpine&#34;]}</span>
</span></span></code></pre></div><p>registry é»˜è®¤ä¼šæŠŠé•œåƒå­˜å‚¨åœ¨ Docker å†…éƒ¨ç›®å½• <code>/var/lib/registry</code>ã€‚</p><p>æ­å»º WordPressï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --rm <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>MARIADB_DATABASE</span><span class=o>=</span>db <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>MARIADB_USER</span><span class=o>=</span>wp <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>MARIADB_PASSWORD</span><span class=o>=</span><span class=m>123</span> <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>MARIADB_ROOT_PASSWORD</span><span class=o>=</span><span class=m>123</span> <span class=se>\
</span></span></span><span class=line><span class=cl>    --name mariadb <span class=se>\
</span></span></span><span class=line><span class=cl>    mariadb:10
</span></span><span class=line><span class=cl><span class=c1># è¿›å…¥ mariadb</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mariadb mysql -uwp -p123
</span></span><span class=line><span class=cl><span class=c1># show mariadb ip</span>
</span></span><span class=line><span class=cl>docker inspect mariadb <span class=p>|</span> grep IPAddress
</span></span><span class=line><span class=cl><span class=c1># &#34;IPAddress&#34;: &#34;172.17.0.2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker run -d --rm <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>WORDPRESS_DB_HOST</span><span class=o>=</span>172.17.0.2 <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>WORDPRESS_DB_USER</span><span class=o>=</span>wp <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>WORDPRESS_DB_PASSWORD</span><span class=o>=</span><span class=m>123</span> <span class=se>\
</span></span></span><span class=line><span class=cl>    --env <span class=nv>WORDPRESS_DB_NAME</span><span class=o>=</span>db <span class=se>\
</span></span></span><span class=line><span class=cl>    --name wp <span class=se>\
</span></span></span><span class=line><span class=cl>    wordpress:5
</span></span><span class=line><span class=cl>docker inspect wp <span class=p>|</span> grep IPAddress
</span></span><span class=line><span class=cl><span class=c1># &#34;IPAddress&#34;: &#34;172.17.0.4&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim wp.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  default_type text/html<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>      proxy_http_version 1.1<span class=p>;</span>
</span></span><span class=line><span class=cl>      proxy_set_header Host <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=c1># wordpress server</span>
</span></span><span class=line><span class=cl>      proxy_pass http://172.17.0.4<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æ„Ÿè§‰å¯ä»¥ç›´æ¥ç”¨ wordpress çš„ 80ï¼Œæ— éœ€å†ä»£ç†ä¸€æ¬¡</span>
</span></span><span class=line><span class=cl>docker run -d --rm <span class=se>\
</span></span></span><span class=line><span class=cl>    -p 80:80 <span class=se>\
</span></span></span><span class=line><span class=cl>    -v <span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>/wp.conf:/etc/nginx/conf.d/default.conf <span class=se>\
</span></span></span><span class=line><span class=cl>    --name ng <span class=se>\
</span></span></span><span class=line><span class=cl>    nginx:alpine
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># show logs</span>
</span></span><span class=line><span class=cl>docker logs mariadb
</span></span><span class=line><span class=cl>docker logs ng
</span></span><span class=line><span class=cl>docker logs wp
</span></span></code></pre></div><h2 id=08-å…¥é—¨ç¯‡æ€»ç»“>08 å…¥é—¨ç¯‡æ€»ç»“<a hidden class=anchor aria-hidden=true href=#08-å…¥é—¨ç¯‡æ€»ç»“>#</a></h2><p>æ„å»ºè‡ªå·±çš„é•œåƒï¼š</p><p><a href=https://github.com/chronolaw/k8s_study/blob/master/ch1/Dockerfile>https://github.com/chronolaw/k8s_study/blob/master/ch1/Dockerfile</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>ARG</span> <span class=nv>IMAGE_BASE</span><span class=o>=</span><span class=s2>&#34;nginx&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>ARG</span> <span class=nv>IMAGE_TAG</span><span class=o>=</span><span class=s2>&#34;1.21-alpine&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>${IMAGE_BASE}:${IMAGE_TAG</span><span class=o>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/tmp<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>DEBUG</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>COPY</span> ./default.conf /etc/nginx/conf.d/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> <span class=nb>cd</span> /usr/share/nginx/html <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;hello nginx&#34;</span> &gt; a.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>EXPOSE</span><span class=w> </span><span class=s>8081</span> <span class=m>8082</span> <span class=m>8083</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=w> </span><span class=s>/etc/nginx</span><span class=err>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t ngx-app:1.0 .
</span></span><span class=line><span class=cl>docker run -it --rm ngx-app:1.0 sh
</span></span><span class=line><span class=cl>docker save ngx-app:1.0 -o ngx.tar
</span></span><span class=line><span class=cl>docker load -i ngx.tar
</span></span></code></pre></div><h2 id=09-kubernetes-ç¯å¢ƒ>09 Kubernetes ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#09-kubernetes-ç¯å¢ƒ>#</a></h2><p>Kubernetes å°±æ˜¯ä¸€ä¸ª <a href=https://kubernetes.io/>Production-Grade Container Orchestration</a> ç”Ÿäº§çº§åˆ«çš„å®¹å™¨ç¼–æ’å¹³å°å’Œé›†ç¾¤ç®¡ç†ç³»ç»Ÿã€‚</p><p><a href=https://minikube.sigs.k8s.io/docs/start/>minikube</a> quickly sets up a local Kubernetes cluster on macOS, Linux, and Windows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install minikube
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>minikube version
</span></span><span class=line><span class=cl><span class=c1># minikube version: v1.37.0</span>
</span></span><span class=line><span class=cl><span class=c1># commit: 65318f4cfff9c12cc87ec9eb8f4cdd57b25047f3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç»Ÿä¸€å®éªŒç¯å¢ƒ</span>
</span></span><span class=line><span class=cl>minikube start
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹çŠ¶æ€</span>
</span></span><span class=line><span class=cl>minikube status
</span></span><span class=line><span class=cl><span class=c1># type: Control Plane</span>
</span></span><span class=line><span class=cl><span class=c1># host: Running</span>
</span></span><span class=line><span class=cl><span class=c1># kubelet: Running</span>
</span></span><span class=line><span class=cl><span class=c1># apiserver: Running</span>
</span></span><span class=line><span class=cl><span class=c1># kubeconfig: Configured</span>
</span></span><span class=line><span class=cl>minikube node list
</span></span><span class=line><span class=cl><span class=c1># minikube 192.168.49.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç™»å½•åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Š</span>
</span></span><span class=line><span class=cl>minikube ssh
</span></span><span class=line><span class=cl>uname -a
</span></span><span class=line><span class=cl><span class=c1># Linux minikube 6.17.8-orbstack-00308-g8f9c941121b1 #1 SMP PREEMPT Thu Nov 20 09:34:02 UTC 2025 aarch64 aarch64 aarch64 GNU/Linux</span>
</span></span><span class=line><span class=cl>ip add
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># minikube ç®¡ç† Kubernetes é›†ç¾¤ç¯å¢ƒ</span>
</span></span><span class=line><span class=cl><span class=c1># kubectl æ“ä½œå®é™…çš„ Kubernetes åŠŸèƒ½</span>
</span></span><span class=line><span class=cl><span class=c1># install kubectl</span>
</span></span><span class=line><span class=cl>minikube kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>minikube kubectl -- version
</span></span><span class=line><span class=cl><span class=c1># Client Version: v1.34.0</span>
</span></span><span class=line><span class=cl><span class=c1># Kustomize Version: v5.7.1</span>
</span></span><span class=line><span class=cl><span class=c1># Server Version: v1.34.0</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>kubectl</span><span class=o>=</span><span class=s2>&#34;minikube kubectl --&#34;</span>
</span></span><span class=line><span class=cl>kubectl version
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯åŠ¨ä¸€ä¸ªé•œåƒ</span>
</span></span><span class=line><span class=cl>kubectl run ngx --image<span class=o>=</span>nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># like docker ps</span>
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl><span class=c1># NAME   READY   STATUS              RESTARTS   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># ngx    0/1     ContainerCreating   0          7s</span>
</span></span></code></pre></div><h2 id=10-kubernetes-å·¥ä½œæœºåˆ¶>10 Kubernetes å·¥ä½œæœºåˆ¶<a hidden class=anchor aria-hidden=true href=#10-kubernetes-å·¥ä½œæœºåˆ¶>#</a></h2><p>Kubernetes æ¶æ„åŸºäºæµè¡Œçš„â€œæ§åˆ¶é¢ Control Plane / æ•°æ®é¢ Data Planeâ€è®¾è®¡ã€‚é›†ç¾¤ç”±å¤šä¸ªâ€œèŠ‚ç‚¹â€ï¼ˆNodeï¼‰ç»„æˆï¼Œåº•å±‚ç¯å¢ƒæ”¯æŒç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚</p><p>æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šè´Ÿè´£â€œå¤§è„‘â€å·¥ä½œçš„ Master èŠ‚ç‚¹ï¼ˆæ§åˆ¶é¢ï¼‰ï¼Œç”¨äºæ‰§è¡Œç®¡ç†å’Œè°ƒåº¦ä»»åŠ¡ï¼›ä»¥åŠè´Ÿè´£â€œä½“åŠ›â€å·¥ä½œçš„ Worker èŠ‚ç‚¹ï¼ˆæ•°æ®é¢ï¼‰ï¼Œç”¨äºè¿è¡Œå…·ä½“çš„ä¸šåŠ¡åº”ç”¨ã€‚</p><img width=600 alt=image src=https://user-images.githubusercontent.com/9289792/219293821-a4e1620a-c024-4edf-ba29-a5bc1f8d3f57.png><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get node
</span></span><span class=line><span class=cl><span class=c1># NAME       STATUS   ROLES           AGE   VERSION</span>
</span></span><span class=line><span class=cl><span class=c1># minikube   Ready    control-plane   11m   v1.34.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ master Component pod</span>
</span></span><span class=line><span class=cl>kubectl get pod -n kube-system
</span></span><span class=line><span class=cl><span class=c1># NAME                               READY   STATUS    RESTARTS   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># coredns-66bc5c9577-6c27s           1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># etcd-minikube                      1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># kube-apiserver-minikube            1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># kube-controller-manager-minikube   1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># kube-proxy-9v5wf                   1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># kube-scheduler-minikube            1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl><span class=c1># storage-provisioner                1/1     Running   0          11m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># worker node</span>
</span></span><span class=line><span class=cl>minikube ssh
</span></span><span class=line><span class=cl><span class=c1># show kube-proxy</span>
</span></span><span class=line><span class=cl>docker ps <span class=p>|</span> grep kube-proxy
</span></span><span class=line><span class=cl><span class=c1># show kubelet, not exist docker</span>
</span></span><span class=line><span class=cl>ps -ef <span class=p>|</span> grep kubelet
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># show addons list</span>
</span></span><span class=line><span class=cl>minikube addons list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>minikube dashboard
</span></span><span class=line><span class=cl><span class=c1># ğŸ‰  Opening http://127.0.0.1:50733/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...</span>
</span></span></code></pre></div><img width=600 alt=image src=https://user-images.githubusercontent.com/9289792/219294564-12655273-044c-4d56-a99a-d6f6e7cf7525.png><h2 id=11-yaml>11 YAML<a hidden class=anchor aria-hidden=true href=#11-yaml>#</a></h2><p>YAML åœ¨è¯­æ³•ä¸Šæ˜¯ JSON çš„è¶…é›†ï¼Œå¸¸è¢«ç”¨ä½œ Kubernetes çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸¤ç§æ€ç»´æ¨¡å¼ï¼šShell è„šæœ¬å’Œ Dockerfile æ˜¯å…¸å‹çš„ <strong>â€œå‘½ä»¤å¼â€</strong>ï¼Œå®ƒå‘Šè¯‰æœºå™¨â€œç¬¬ä¸€æ­¥åšä»€ä¹ˆï¼Œç¬¬äºŒæ­¥åšä»€ä¹ˆâ€ï¼›è€Œ Kubernetes æ¨å´‡ <strong>â€œå£°æ˜å¼â€</strong>ï¼Œå®ƒåªå‘Šè¯‰æœºå™¨â€œæˆ‘æƒ³è¦ä»€ä¹ˆæ ·çš„ç»“æœâ€ï¼Œå…·ä½“çš„æ­¥éª¤ç”±ç³»ç»Ÿè‡ªå·±å®Œæˆã€‚</p><p>æœ€åï¼ŒKubernetes çš„æ ¸å¿ƒç»„ä»¶ apiserver å€Ÿé‰´äº† HTTP åè®®ä¸­â€œèµ„æºâ€çš„æ¦‚å¿µï¼Œä½¿ç”¨äº†æ ‡å‡†çš„ RESTful é£æ ¼ã€‚åœ¨ K8s çš„ä½“ç³»é‡Œï¼Œæ‰€æœ‰è¢«ç®¡ç†çš„å†…å®¹ï¼ˆå¦‚ Pod, Serviceï¼‰éƒ½è¢«æŠ½è±¡æˆäº† <strong>â€œAPI å¯¹è±¡â€</strong> æ¥è¿›è¡Œæ“ä½œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ kubectl api-service æ”¯æŒçš„æ‰€æœ‰å¯¹è±¡</span>
</span></span><span class=line><span class=cl>kubectl api-resources
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾ç¤ºå‡ºè¯¦ç»†çš„å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹</span>
</span></span><span class=line><span class=cl>kubectl get pod --v<span class=o>=</span><span class=m>9</span>
</span></span><span class=line><span class=cl><span class=c1># è‡ªå¸¦çš„ API æ–‡æ¡£ https://kubernetes.io/docs/reference/kubernetes-api/</span>
</span></span><span class=line><span class=cl>kubectl explain pod
</span></span><span class=line><span class=cl>kubectl explain pod.metadata
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‘½ä»¤å¼</span>
</span></span><span class=line><span class=cl>kubectl run ngx --image<span class=o>=</span>nginx:alpine
</span></span><span class=line><span class=cl><span class=c1># è½¬æ¢ä¸º YAML å£°åå¼</span>
</span></span><span class=line><span class=cl>kubectl run ngx --image<span class=o>=</span>nginx:alpine --dry-run<span class=o>=</span>client -o yaml &gt; ngx-pod.yml
</span></span><span class=line><span class=cl>kubectl apply -f ngx-pod.yml
</span></span><span class=line><span class=cl>kubectl delete -f ngx-pod.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><h2 id=12-pod>12 Pod<a hidden class=anchor aria-hidden=true href=#12-pod>#</a></h2><p>æ—¢ç„¶ Docker å®¹å™¨æå€¡â€œä¸€ä¸ªå®¹å™¨åªè·‘ä¸€ä¸ªè¿›ç¨‹â€ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦å¤šä¸ªç´§å¯†åä½œçš„è¿›ç¨‹ï¼ˆå¤šåº”ç”¨è”åˆè¿è¡Œï¼‰å…±åŒå·¥ä½œæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç ´åå•å®¹å™¨å•è¿›ç¨‹çš„éš”ç¦»åŸåˆ™ï¼ˆä¸ç ´åå®¹å™¨éš”ç¦»ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨ä¹‹ä¸Šå¼•å…¥ä¸€ä¸ªæ›´é«˜å±‚çº§çš„æŠ½è±¡å¯¹è±¡ï¼ˆæ”¶çº³èˆ±/Podï¼‰ï¼Œè®©è¿™äº›å®¹å™¨åœ¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨çš„åŒæ—¶ï¼Œä¾ç„¶ä¿æŒé•œåƒå±‚é¢çš„ç‹¬ç«‹ã€‚</p><img width=600 alt=image src=https://user-images.githubusercontent.com/9289792/219309091-7436a44b-c0e4-4e8f-8dc1-7a208122ae7d.png><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ngx-pod.yml
</span></span><span class=line><span class=cl>kubectl logs ngx
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl>kubectl describe pod ngx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cp file to pod</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;aaa&#39;</span> &gt; a.txt
</span></span><span class=line><span class=cl>kubectl cp a.txt ngx:/tmp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># exec need --</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it ngx -- sh
</span></span><span class=line><span class=cl>cat /tmp/a.txt
</span></span></code></pre></div><h2 id=13-job-cronjob-ç¦»çº¿ä¸šåŠ¡>13 Job CronJob ç¦»çº¿ä¸šåŠ¡<a hidden class=anchor aria-hidden=true href=#13-job-cronjob-ç¦»çº¿ä¸šåŠ¡>#</a></h2><p>å•ä¸€èŒè´£ æ„å‘³ç€æ¯ä¸ªå®¹å™¨åº”å½“åªè¿è¡Œä¸€ä¸ªæ ¸å¿ƒè¿›ç¨‹ã€‚é¿å…â€œå¤§è€Œå…¨â€çš„å·¨å‹å®¹å™¨ï¼Œä¿æŒå®¹å™¨åŠŸèƒ½çš„å•ä¸€å’Œçº¯ç²¹ï¼Œæ‰èƒ½è®©å®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·è¢«çµæ´»å¤ç”¨å’Œç‹¬ç«‹å‡çº§ã€‚</p><p>ç»„åˆä¼˜äºç»§æ‰¿ æ„å‘³ç€åº”è¯¥é€šè¿‡â€œç»„åˆâ€å¤šä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼ˆPod æ¨¡å¼ï¼‰æ¥æ„å»ºå¤æ‚çš„åº”ç”¨ï¼Œè€Œä¸æ˜¯é€šè¿‡â€œç»§æ‰¿â€åŸºç¡€é•œåƒå¹¶åœ¨å…¶ä¸Šå±‚å±‚å åŠ æ‰€æœ‰åŠŸèƒ½ï¼ˆå·¨å‹é•œåƒï¼‰ã€‚è¿™ç§æ¾è€¦åˆçš„æ–¹å¼ï¼Œå…è®¸åº”ç”¨åœ¨è¿è¡Œæ—¶é€šè¿‡ Sidecar ç­‰æ¨¡å¼çµæ´»åä½œï¼Œè€Œä¸æ˜¯è¢«å›ºåŒ–åœ¨åŒä¸€ä¸ªé•œåƒæ–‡ä»¶é‡Œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create job echo-job --image<span class=o>=</span>busybox --dry-run<span class=o>=</span>client -o yaml &gt; echo-job.yml
</span></span><span class=line><span class=cl><span class=c1># å‘Šè¯‰ k8s æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªåä¸º echo-job çš„ä»»åŠ¡ï¼ˆJobï¼‰ã€‚</span>
</span></span><span class=line><span class=cl><span class=c1># --dry-run=client å‘Šè¯‰ kubectlï¼Œâ€œä½ å‡è£…æ‰§è¡Œä¸€ä¸‹åˆ›å»ºå‘½ä»¤ï¼Œæ£€æŸ¥ä¸€ä¸‹è¯­æ³•ï¼Œä½†æ˜¯åƒä¸‡ä¸è¦çœŸçš„æŠŠè¯·æ±‚å‘ç»™ Kubernetes API Serverï¼Œä¹Ÿä¸è¦çœŸçš„åœ¨é›†ç¾¤é‡Œåˆ›å»ºè¿™ä¸ª Jobâ€</span>
</span></span><span class=line><span class=cl>vim echo-job.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># è¡¥å……è¾“å‡º</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;echo&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;hello world&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># -----</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f echo-job.yml
</span></span><span class=line><span class=cl>kubectl get job
</span></span><span class=line><span class=cl><span class=c1># NAME       COMPLETIONS   DURATION   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># echo-job   1/1           16s        33s</span>
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl><span class=c1># NAME             READY   STATUS      RESTARTS   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># echo-job-59sgn   0/1     Completed   0          68s</span>
</span></span><span class=line><span class=cl>kubectl logs echo-job-59sgn
</span></span><span class=line><span class=cl><span class=c1># hello world</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sleep-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># è®¾ç½® Pod è¿è¡Œçš„è¶…æ—¶æ—¶é—´</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>activeDeadlineSeconds</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># è®¾ç½® Pod çš„å¤±è´¥é‡è¯•æ¬¡æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backoffLimit</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Job å®Œæˆéœ€è¦è¿è¡Œå¤šå°‘ä¸ª Podï¼Œé»˜è®¤æ˜¯ 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>completions</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># å®ƒä¸ completions ç›¸å…³ï¼Œè¡¨ç¤ºå…è®¸å¹¶å‘è¿è¡Œçš„ Pod æ•°é‡ï¼Œé¿å…è¿‡å¤šå ç”¨èµ„æº</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallelism</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># éšæœºä¼‘çœ </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sleep $(($RANDOM % 10 + 1)) &amp;&amp; echo done</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f sleep-job.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pod -w
</span></span><span class=line><span class=cl><span class=c1># NAME              READY   STATUS      RESTARTS   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># sleep-job-92m4d   0/1     Completed   0          30s</span>
</span></span><span class=line><span class=cl><span class=c1># sleep-job-g8pmj   0/1     Completed   0          15s</span>
</span></span><span class=line><span class=cl><span class=c1># sleep-job-tsncl   0/1     Completed   0          30s</span>
</span></span><span class=line><span class=cl><span class=c1># sleep-job-x4qlp   0/1     Completed   0          15s</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># cronjob</span>
</span></span><span class=line><span class=cl>kubectl create cj echo-cj --image<span class=o>=</span>busybox --schedule<span class=o>=</span><span class=s2>&#34;*/1 * * * *&#34;</span> --dry-run<span class=o>=</span>client -o yaml &gt; echo-cj.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>batch/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>CronJob</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-cj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jobTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-cj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>echo-cj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=c># è¡¥å……è¾“å‡º</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/echo&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;hello&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;world&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>OnFailure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;*/1 * * * *&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f echo-cj.yaml
</span></span><span class=line><span class=cl>kubectl get cj
</span></span><span class=line><span class=cl><span class=c1># NAME      SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># echo-cj   */1 * * * *   False     1        5s              8s</span>
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl><span class=c1># NAME                     READY   STATUS      RESTARTS   AGE</span>
</span></span><span class=line><span class=cl><span class=c1># echo-cj-27942326-qng4j   0/1     Completed   0          93s</span>
</span></span><span class=line><span class=cl><span class=c1># echo-cj-27942327-vlrvs   0/1     Completed   0          33s</span>
</span></span></code></pre></div><h2 id=14-configmap-secret-ç®¡ç†é…ç½®ä¿¡æ¯>14 ConfigMap Secret ç®¡ç†é…ç½®ä¿¡æ¯<a hidden class=anchor aria-hidden=true href=#14-configmap-secret-ç®¡ç†é…ç½®ä¿¡æ¯>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create cm info --from-literal<span class=o>=</span><span class=nv>name</span><span class=o>=</span>zhao --dry-run<span class=o>=</span>client -o yaml &gt; cm.yml
</span></span><span class=line><span class=cl>kubectl apply -f cm.yml
</span></span><span class=line><span class=cl>kubectl get cm
</span></span><span class=line><span class=cl>kubectl describe cm info
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create secret generic user --from-literal<span class=o>=</span><span class=nv>name</span><span class=o>=</span>root --dry-run<span class=o>=</span>client -o yaml &gt; secret.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -n å»æ‰å­—ç¬¦ä¸²é‡Œéšå«çš„æ¢è¡Œç¬¦</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;root&#34;</span> <span class=p>|</span> base64
</span></span><span class=line><span class=cl>kubectl apply -f secret.yml
</span></span><span class=line><span class=cl>kubectl get secret
</span></span><span class=line><span class=cl>kubectl describe secret user
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl explain pod.spec.containers.env.valueFrom
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SNAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f env-pod.yml
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it ngx -- sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$NAME</span> <span class=nv>$SNAME</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ä»¥ Volume çš„æ–¹å¼ä½¿ç”¨ ConfigMap/Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>vol-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Volume å±äº Pod ä¸ containers åŒçº§</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm-vol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sec-vol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æŒ‚è½½åˆ°å®¹å™¨é‡Œçš„æŸä¸ªè·¯å¾„ä¸‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/cm-items</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm-vol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/sec-items</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sec-vol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim vol-pod.yml
</span></span><span class=line><span class=cl>kubectl apply -f vol-pod.yml
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it vol-pod -- sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat /tmp/cm-items/name
</span></span><span class=line><span class=cl>cat /tmp/sec-items/name
</span></span><span class=line><span class=cl><span class=c1># ConfigMap å’Œ Secret éƒ½å˜æˆäº†ç›®å½•çš„å½¢å¼ï¼Œè€Œå®ƒä»¬é‡Œé¢çš„ Key-Value å˜æˆäº†ä¸€ä¸ªä¸ªçš„æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶åå°±æ˜¯ Keyã€‚</span>
</span></span></code></pre></div><h2 id=15-ç©è½¬-kubernetes>15 ç©è½¬ Kubernetes<a hidden class=anchor aria-hidden=true href=#15-ç©è½¬-kubernetes>#</a></h2><img width=600 alt=image src=https://user-images.githubusercontent.com/9289792/219537942-31e778eb-888d-4331-8d65-03ae4095b003.png><p>æ­å»º WordPress ç¯å¢ƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># vim mariadb-pod.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>maria-cm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DATABASE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;db&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>USER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;wp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>maria-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>role</span><span class=p>:</span><span class=w> </span><span class=l>database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mariadb:10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>maria</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3306</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;MARIADB_&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>configMapRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>maria-cm</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f mariadb-pod.yml
</span></span><span class=line><span class=cl><span class=c1># è·å– IP åœ°å€éœ€è¦åŠ ä¸Šå‚æ•° -o wide</span>
</span></span><span class=line><span class=cl>kubectl get pod -o wide
</span></span><span class=line><span class=cl><span class=c1># NAME        READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES</span>
</span></span><span class=line><span class=cl><span class=c1># maria-pod   1/1     Running   0          64s   172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># vim wp-pod.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wp-cm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># MariaDB Pod çš„ IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>HOST</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;172.17.0.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>USER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;wp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>NAME</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;db&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wp-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>role</span><span class=p>:</span><span class=w> </span><span class=l>website</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>wordpress:5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wp-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;WORDPRESS_DB_&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>configMapRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>wp-cm</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f wp-pod.yml
</span></span><span class=line><span class=cl>kubectl get pod -o wide
</span></span><span class=line><span class=cl><span class=c1># NAME        READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES</span>
</span></span><span class=line><span class=cl><span class=c1># maria-pod   1/1     Running   0          160m    172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># wp-pod      1/1     Running   0          2m47s   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æœ¬åœ°çš„ â€œ8080â€ æ˜ å°„åˆ° WordPress Pod çš„â€œ80â€</span>
</span></span><span class=line><span class=cl>kubectl port-forward wp-pod 8080:80 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=c1># Forwarding from 127.0.0.1:8080 -&gt; 80</span>
</span></span><span class=line><span class=cl><span class=c1># Forwarding from [::1]:8080 -&gt; 80</span>
</span></span><span class=line><span class=cl><span class=c1># fg</span>
</span></span></code></pre></div><h2 id=16-åˆçº§ç¯‡æ€»ç»“>16 åˆçº§ç¯‡æ€»ç»“<a hidden class=anchor aria-hidden=true href=#16-åˆçº§ç¯‡æ€»ç»“>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>minikube version
</span></span><span class=line><span class=cl>minikube status
</span></span><span class=line><span class=cl>minikube start --kubernetes-version<span class=o>=</span>v1.23.3
</span></span><span class=line><span class=cl>minikube node list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl version
</span></span><span class=line><span class=cl>kubectl run ngx --image<span class=o>=</span>nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># apiserver ç­‰æ ¸å¿ƒç»„ä»¶æ˜¯åœ¨ kube-system åå­—ç©ºé—´</span>
</span></span><span class=line><span class=cl>kubectl get pod -n kube-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl api-resources
</span></span><span class=line><span class=cl>kubectl explain pod.metadata
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>out</span><span class=o>=</span><span class=s2>&#34;--dry-run=client -o yaml&#34;</span>
</span></span><span class=line><span class=cl>kubectl run ngx --image<span class=o>=</span>nginx:alpine <span class=nv>$out</span> &gt; pod.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl apply -f ngx-pod.yml
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl>kubectl logs ngx-pod
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it ngx-pod -- sh
</span></span><span class=line><span class=cl>kubectl delete -f ngx-pod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create job echo-job --image<span class=o>=</span>busybox <span class=nv>$out</span>
</span></span><span class=line><span class=cl>kubectl apply -f job.yml
</span></span><span class=line><span class=cl>kubectl get job
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl>kubectl logs echo-job-l52l7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create cj echo-cj --image<span class=o>=</span>busybox --schedule<span class=o>=</span><span class=s2>&#34;* * * * *&#34;</span> <span class=nv>$out</span>
</span></span><span class=line><span class=cl>kubectl apply -f cronjob.yml
</span></span><span class=line><span class=cl>kubectl get cj
</span></span><span class=line><span class=cl>kubectl get pod
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create cm info --from-literal<span class=o>=</span><span class=nv>k</span><span class=o>=</span>v <span class=nv>$out</span>
</span></span><span class=line><span class=cl>kubectl get cm
</span></span><span class=line><span class=cl>kubectl describe cm info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create secret generic user --from-literal<span class=o>=</span><span class=nv>name</span><span class=o>=</span>root <span class=nv>$out</span>
</span></span><span class=line><span class=cl>kubectl get secret
</span></span><span class=line><span class=cl>kubectl describe secret user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>cm9vdA</span><span class=o>==</span> <span class=p>|</span> base64 -d
</span></span></code></pre></div><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://github.com/chronolaw/k8s_study>chronolaw/k8s_study | GitHub</a></li></ul><p>&ndash; EOF &ndash;</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zyf.im/tags/kubernetes/>Kubernetes</a></li></ul><nav class=paginav><a class=prev href=https://zyf.im/2023/02/22/kubernetes-getting-started-part2/><span class=title>Â« Prev</span><br><span>Kubernetes å…¥é—¨å®æˆ˜ Part2</span>
</a><a class=next href=https://zyf.im/2023/02/01/go-language-lesson-one/><span class=title>Next Â»</span><br><span>Go è¯­è¨€ç¬¬ä¸€è¯¾</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>