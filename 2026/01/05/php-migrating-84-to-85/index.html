<!doctype html><html lang=en dir=auto data-theme=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PHP Migrating 8.4 to 8.5 | ZYF.IM BLOG</title><meta name=keywords content="php,php-migrating"><meta name=description content="简介
PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、#[\NoDiscard] 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。
参考资源

在线测试环境：https://3v4l.org/
官方发布说明：https://www.php.net/releases/8.5/en.php
迁移指南：https://www.php.net/manual/en/migration85.php
更新详情：https://php.watch/versions/8.5

PHP 8.5 新特性
管道运算符（Pipe Operator）
PHP 8.5 引入了管道运算符 |>，使函数链式调用更加清晰易读：
// PHP 8.5 之前 - 嵌套函数调用，难以阅读
$slug = strtolower(str_replace('.', '', str_replace(' ', '-', trim($title))));

// PHP 8.5 - 使用管道运算符，从左到右清晰阅读
$slug = $title
    |> trim(...)
    |> (fn($str) => str_replace(' ', '-', $str))
    |> (fn($str) => str_replace('.', '', $str))
    |> strtolower(...);
管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。
URI 扩展
PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。

URI 与 URL 的关系：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。"><meta name=author content="Me, LLM"><link rel=canonical href=https://zyf.im/2026/01/05/php-migrating-84-to-85/><link crossorigin=anonymous href=/assets/css/stylesheet.88888b1f97bcb20b824590bc7c6603a852913a2540638b3b3e2663e642691da3.css integrity="sha256-iIiLH5e8sguCRZC8fGYDqFKROiVAY4s7PiZj5kJpHaM=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zyf.im/2026/01/05/php-migrating-84-to-85/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="light"&&(document.querySelector("html").dataset.theme="light")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6DVZ6E58DG"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6DVZ6E58DG")}</script><meta property="og:url" content="https://zyf.im/2026/01/05/php-migrating-84-to-85/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="PHP Migrating 8.4 to 8.5"><meta property="og:description" content="简介 PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、#[\NoDiscard] 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。
参考资源 在线测试环境：https://3v4l.org/ 官方发布说明：https://www.php.net/releases/8.5/en.php 迁移指南：https://www.php.net/manual/en/migration85.php 更新详情：https://php.watch/versions/8.5 PHP 8.5 新特性 管道运算符（Pipe Operator） PHP 8.5 引入了管道运算符 |>，使函数链式调用更加清晰易读：
// PHP 8.5 之前 - 嵌套函数调用，难以阅读 $slug = strtolower(str_replace('.', '', str_replace(' ', '-', trim($title)))); // PHP 8.5 - 使用管道运算符，从左到右清晰阅读 $slug = $title |> trim(...) |> (fn($str) => str_replace(' ', '-', $str)) |> (fn($str) => str_replace('.', '', $str)) |> strtolower(...); 管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。
URI 扩展 PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。
URI 与 URL 的关系：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-05T21:33:57+08:00"><meta property="article:modified_time" content="2026-01-05T21:33:57+08:00"><meta property="article:tag" content="Php"><meta property="article:tag" content="Php-Migrating"><meta property="og:image" content="https://images.unsplash.com/photo-1502085671122-2d218cd434e6?q=80&amp;w=960&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1502085671122-2d218cd434e6?q=80&amp;w=960&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0"><meta name=twitter:title content="PHP Migrating 8.4 to 8.5"><meta name=twitter:description content="简介
PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、#[\NoDiscard] 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。
参考资源

在线测试环境：https://3v4l.org/
官方发布说明：https://www.php.net/releases/8.5/en.php
迁移指南：https://www.php.net/manual/en/migration85.php
更新详情：https://php.watch/versions/8.5

PHP 8.5 新特性
管道运算符（Pipe Operator）
PHP 8.5 引入了管道运算符 |>，使函数链式调用更加清晰易读：
// PHP 8.5 之前 - 嵌套函数调用，难以阅读
$slug = strtolower(str_replace('.', '', str_replace(' ', '-', trim($title))));

// PHP 8.5 - 使用管道运算符，从左到右清晰阅读
$slug = $title
    |> trim(...)
    |> (fn($str) => str_replace(' ', '-', $str))
    |> (fn($str) => str_replace('.', '', $str))
    |> strtolower(...);
管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。
URI 扩展
PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。

URI 与 URL 的关系：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zyf.im/posts/"},{"@type":"ListItem","position":2,"name":"PHP Migrating 8.4 to 8.5","item":"https://zyf.im/2026/01/05/php-migrating-84-to-85/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PHP Migrating 8.4 to 8.5","name":"PHP Migrating 8.4 to 8.5","description":"简介 PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、#[\\NoDiscard] 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。\n参考资源 在线测试环境：https://3v4l.org/ 官方发布说明：https://www.php.net/releases/8.5/en.php 迁移指南：https://www.php.net/manual/en/migration85.php 更新详情：https://php.watch/versions/8.5 PHP 8.5 新特性 管道运算符（Pipe Operator） PHP 8.5 引入了管道运算符 |\u0026gt;，使函数链式调用更加清晰易读：\n// PHP 8.5 之前 - 嵌套函数调用，难以阅读 $slug = strtolower(str_replace(\u0026#39;.\u0026#39;, \u0026#39;\u0026#39;, str_replace(\u0026#39; \u0026#39;, \u0026#39;-\u0026#39;, trim($title)))); // PHP 8.5 - 使用管道运算符，从左到右清晰阅读 $slug = $title |\u0026gt; trim(...) |\u0026gt; (fn($str) =\u0026gt; str_replace(\u0026#39; \u0026#39;, \u0026#39;-\u0026#39;, $str)) |\u0026gt; (fn($str) =\u0026gt; str_replace(\u0026#39;.\u0026#39;, \u0026#39;\u0026#39;, $str)) |\u0026gt; strtolower(...); 管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。\nURI 扩展 PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。\nURI 与 URL 的关系：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。\n","keywords":["php","php-migrating"],"articleBody":"简介 PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、#[\\NoDiscard] 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。\n参考资源 在线测试环境：https://3v4l.org/ 官方发布说明：https://www.php.net/releases/8.5/en.php 迁移指南：https://www.php.net/manual/en/migration85.php 更新详情：https://php.watch/versions/8.5 PHP 8.5 新特性 管道运算符（Pipe Operator） PHP 8.5 引入了管道运算符 |\u003e，使函数链式调用更加清晰易读：\n// PHP 8.5 之前 - 嵌套函数调用，难以阅读 $slug = strtolower(str_replace('.', '', str_replace(' ', '-', trim($title)))); // PHP 8.5 - 使用管道运算符，从左到右清晰阅读 $slug = $title |\u003e trim(...) |\u003e (fn($str) =\u003e str_replace(' ', '-', $str)) |\u003e (fn($str) =\u003e str_replace('.', '', $str)) |\u003e strtolower(...); 管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。\nURI 扩展 PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。\nURI 与 URL 的关系：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。\n示例：\n// PHP 8.5 之前 $components = parse_url('https://php.net/releases/8.5/en.php'); var_dump($components['host']); // \"php.net\" // PHP 8.5 - 使用新的 URI 扩展 use Uri\\Rfc3986\\Uri; $uri = new Uri('https://php.net/releases/8.5/en.php'); var_dump($uri-\u003egetHost()); // \"php.net\" var_dump($uri-\u003egetPath()); // \"/releases/8.5/en.php\" var_dump($uri-\u003egetScheme()); // \"https\" 新的 URI 扩展由 uriparser 和 Lexbor 库驱动，提供更安全、更符合标准的 URI 解析 API。\nClone With 语法 PHP 8.5 简化了对象克隆时更新属性的操作，特别适用于 readonly 类的 “with-er” 模式。\n什么是 “with-er” 模式：一种用于不可变对象的设计模式，方法名以 with 开头（如 withId()、withName()），不修改原对象，而是返回一个修改了某个属性的新对象。常见于 PSR-7 HTTP 消息接口和 DateTimeImmutable 等。\n示例：\nclass Color { public function __construct( public readonly int $red, public readonly int $green, public readonly int $blue, public readonly int $alpha = 255, ) {} // PHP 8.5 之前 public function withAlphaOld(int $alpha): self { $values = get_object_vars($this); $values['alpha'] = $alpha; return new self(...$values); } // PHP 8.5 - 使用 clone with public function withAlpha(int $alpha): self { return clone($this, ['alpha' =\u003e $alpha]); } } $color = new Color(255, 128, 0); $transparent = $color-\u003ewithAlpha(128); #[\\NoDiscard] 属性 新的 #[\\NoDiscard] 属性用于标记函数返回值不应被忽略：\n#[\\NoDiscard(\"检查操作是否成功\")] function saveData(array $data): bool { // 保存数据... return true; } // 忽略返回值会触发警告 saveData(['key' =\u003e 'value']); // Warning: return value of saveData() should be used or cast to (void) // 正确使用 $success = saveData(['key' =\u003e 'value']); if (!$success) { // 处理错误 } // 显式忽略（不会警告） (void) saveData(['key' =\u003e 'value']); 常量表达式中的闭包 PHP 8.5 允许在属性、常量和默认值中使用静态闭包和一等可调用对象：\nclass Validator { public const RULES = [ 'email' =\u003e filter_var(...), 'trim' =\u003e trim(...), ]; } function process( callable $callback = strtoupper(...) ): string { return $callback('hello'); } 持久化 cURL Share Handles 新的 curl_share_init_persistent() 函数可以跨请求维护 cURL 共享句柄：\n// 创建持久化的共享句柄 $share = curl_share_init_persistent('my-share-handle'); $ch = curl_init('https://example.com'); curl_setopt($ch, CURLOPT_SHARE, $share); curl_exec($ch); PHP 8.5 新增函数 array_first() 和 array_last() 获取数组的第一个或最后一个元素，数组为空时返回 null：\n$events = ['login', 'view_page', 'checkout', 'logout']; $first = array_first($events); // 'login' $last = array_last($events); // 'logout' $empty = []; var_dump(array_first($empty)); // null var_dump(array_last($empty)); // null get_error_handler() 和 get_exception_handler() 获取当前注册的错误处理器和异常处理器：\n// 设置自定义错误处理器 set_error_handler(function($errno, $errstr) { echo \"Error: $errstr\"; }); // 获取当前错误处理器 $handler = get_error_handler(); var_dump($handler); // Closure // 获取当前异常处理器 $exceptionHandler = get_exception_handler(); IntlListFormatter 类 新的国际化列表格式化类：\n$formatter = new IntlListFormatter('zh-CN', IntlListFormatter::TYPE_AND); echo $formatter-\u003eformat(['苹果', '香蕉', '橙子']); // 输出: 苹果、香蕉和橙子 $formatter = new IntlListFormatter('en-US', IntlListFormatter::TYPE_OR); echo $formatter-\u003eformat(['apple', 'banana', 'orange']); // 输出: apple, banana, or orange curl_multi_get_handles() 从 multi-cURL 会话中获取所有句柄：\n$mh = curl_multi_init(); $ch1 = curl_init('https://example.com/1'); $ch2 = curl_init('https://example.com/2'); curl_multi_add_handle($mh, $ch1); curl_multi_add_handle($mh, $ch2); $handles = curl_multi_get_handles($mh); var_dump(count($handles)); // 2 locale_is_right_to_left() / Locale::isRightToLeft() 判断语言环境是否使用从右到左的文字方向：\nvar_dump(locale_is_right_to_left('ar')); // true (阿拉伯语) var_dump(locale_is_right_to_left('he')); // true (希伯来语) var_dump(locale_is_right_to_left('zh-CN')); // false (中文) var_dump(Locale::isRightToLeft('fa')); // true (波斯语) grapheme_levenshtein() 计算两个字符串之间的 Levenshtein 编辑距离（基于字形簇）：\n$distance = grapheme_levenshtein('café', 'cafe'); var_dump($distance); // 1 Closure::getCurrent() 在闭包内部获取当前闭包实例，便于实现递归：\n$factorial = function(int $n): int { if ($n \u003c= 1) return 1; return $n * Closure::getCurrent()($n - 1); }; echo $factorial(5); // 120 其他改进 致命错误包含堆栈跟踪 PHP 8.5 中，致命错误现在会包含完整的堆栈跟踪信息，大大提升了调试体验。\n新的 DOM 方法 $doc = new DOMDocument(); $doc-\u003eloadHTML('AB'); // getElementsByClassName() $elements = $doc-\u003egetElementsByClassName('box'); echo $elements-\u003elength; // 2 // insertAdjacentHTML() $div = $doc-\u003equerySelector('div'); $div-\u003einsertAdjacentHTML('beforeend', 'New'); 属性可以应用于常量 class MyClass { #[Deprecated(\"Use NEW_CONST instead\")] public const OLD_CONST = 'old'; public const NEW_CONST = 'new'; } 静态属性支持非对称可见性 class Counter { public private(set) static int $count = 0; public static function increment(): void { self::$count++; } } echo Counter::$count; // 可读 Counter::$count = 10; // 错误：不可写 构造函数提升支持 final 属性 class User { public function __construct( public final string $id, public string $name, ) {} } setcookie() 支持 “partitioned” 选项 setcookie('name', 'value', [ 'expires' =\u003e time() + 3600, 'path' =\u003e '/', 'secure' =\u003e true, 'partitioned' =\u003e true, // 新选项 ]); 新的全局常量 // 构建提供者标识 echo PHP_BUILD_PROVIDER; // 例如: \"debian\" 或 \"remi\" // 构建日期 echo PHP_BUILD_DATE; // 例如: \"Jan 1 2026\" CLI 新选项 # 显示与默认值不同的 INI 配置 php --ini=diff max_memory_limit INI 指令 管理员可以设置内存限制的上限：\n; php.ini max_memory_limit = 256M 应用程序无法将 memory_limit 设置为超过 max_memory_limit 的值。\n弃用特性 反引号运算符（shell_exec 别名） // ❌ PHP 8.5 已弃用 $output = `ls -la`; // ✅ 使用 shell_exec() $output = shell_exec('ls -la'); 非标准类型转换 // ❌ PHP 8.5 已弃用 $bool = (boolean) $value; $int = (integer) $value; $float = (double) $value; $bin = (binary) $value; // ✅ 使用标准类型转换 $bool = (bool) $value; $int = (int) $value; $float = (float) $value; $bin = (string) $value; mysqli_execute() // ❌ 已弃用 mysqli_execute($stmt); // ✅ 使用 mysqli_stmt_execute() mysqli_stmt_execute($stmt); curl_close() 和 curl_share_close() 这些函数自 PHP 8.0 起就是空操作，现在正式弃用：\n// ❌ 已弃用（实际上不需要调用） curl_close($ch); curl_share_close($sh); // cURL 句柄现在会自动清理 xml_parser_free() // ❌ 已弃用（自 PHP 8.0 起是空操作） xml_parser_free($parser); // XML 解析器现在会自动清理 socket_set_timeout() // ❌ 已弃用 socket_set_timeout($stream, 30); // ✅ 使用 stream_set_timeout() stream_set_timeout($stream, 30); MHASH_* 常量 所有 MHASH_* 相关常量已弃用，应使用 hash() 函数替代。\n__sleep() 和 __wakeup() 这两个魔术方法被软弃用（soft-deprecated），建议使用 __serialize() 和 __unserialize() 替代：\n// ❌ 软弃用 class OldStyle { public function __sleep(): array { return ['data']; } public function __wakeup(): void {} } // ✅ 推荐方式 class NewStyle { public function __serialize(): array { return ['data' =\u003e $this-\u003edata]; } public function __unserialize(array $data): void { $this-\u003edata = $data['data']; } } case 语句后使用分号 // ❌ PHP 8.5 已弃用 switch ($value) { case 1; // 分号 break; } // ✅ 使用冒号 switch ($value) { case 1: // 冒号 break; } null 作为数组偏移量 // ❌ PHP 8.5 已弃用 $array[null] = 'value'; // ✅ 使用空字符串或其他明确的键 $array[''] = 'value'; 移除的特性 disable_classes INI 设置 disable_classes INI 设置已被完全移除。\nCLI -z / –zend-extension 选项 从命令行加载 Zend 扩展的选项已被移除。\n兼容性变化 类型转换警告 NAN 转换为其他类型时会产生警告 浮点数转整数时的精度损失会产生警告 对非数组使用解构语法会产生警告 class_alias() 限制 “array” 和 “callable” 不再是 class_alias() 的有效类名。\n总结 PHP 8.5 带来了许多实用的新特性和改进：\n主要新特性：\n管道运算符 |\u003e URI 扩展 Clone With 语法 #[\\NoDiscard] 属性 array_first() 和 array_last() 函数 常量表达式中的闭包 致命错误堆栈跟踪 IntlListFormatter 类 需要注意的变化：\n反引号运算符已弃用 非标准类型转换已弃用 __sleep() 和 __wakeup() 软弃用 disable_classes INI 设置已移除 通过了解这些变化并遵循迁移建议，可以顺利地从 PHP 8.4 迁移到 PHP 8.5。\n","wordCount":"952","inLanguage":"en","image":"https://images.unsplash.com/photo-1502085671122-2d218cd434e6?q=80\u0026w=960\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.1.0","datePublished":"2026-01-05T21:33:57+08:00","dateModified":"2026-01-05T21:33:57+08:00","author":[{"@type":"Person","name":"Me"},{"@type":"Person","name":"LLM"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://zyf.im/2026/01/05/php-migrating-84-to-85/"},"publisher":{"@type":"Organization","name":"ZYF.IM BLOG","logo":{"@type":"ImageObject","url":"https://zyf.im/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zyf.im/>Home</a>&nbsp;»&nbsp;<a href=https://zyf.im/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PHP Migrating 8.4 to 8.5</h1><div class=post-meta><span title='2026-01-05 21:33:57 +0800 CST'>January 5, 2026</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>952 words</span>&nbsp;·&nbsp;<span>Me, LLM</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#简介>简介</a><ul><li><a href=#参考资源>参考资源</a></li></ul></li><li><a href=#php-85-新特性>PHP 8.5 新特性</a><ul><li><a href=#管道运算符pipe-operator>管道运算符（Pipe Operator）</a></li><li><a href=#uri-扩展>URI 扩展</a></li><li><a href=#clone-with-语法>Clone With 语法</a></li><li><a href=#nodiscard-属性>#[\NoDiscard] 属性</a></li><li><a href=#常量表达式中的闭包>常量表达式中的闭包</a></li><li><a href=#持久化-curl-share-handles>持久化 cURL Share Handles</a></li></ul></li><li><a href=#php-85-新增函数>PHP 8.5 新增函数</a><ul><li><a href=#array_first-和-array_last>array_first() 和 array_last()</a></li><li><a href=#get_error_handler-和-get_exception_handler>get_error_handler() 和 get_exception_handler()</a></li><li><a href=#intllistformatter-类>IntlListFormatter 类</a></li><li><a href=#curl_multi_get_handles>curl_multi_get_handles()</a></li><li><a href=#locale_is_right_to_left--localeisrighttoleft>locale_is_right_to_left() / Locale::isRightToLeft()</a></li><li><a href=#grapheme_levenshtein>grapheme_levenshtein()</a></li><li><a href=#closuregetcurrent>Closure::getCurrent()</a></li></ul></li><li><a href=#其他改进>其他改进</a><ul><li><a href=#致命错误包含堆栈跟踪>致命错误包含堆栈跟踪</a></li><li><a href=#新的-dom-方法>新的 DOM 方法</a></li><li><a href=#属性可以应用于常量>属性可以应用于常量</a></li><li><a href=#静态属性支持非对称可见性>静态属性支持非对称可见性</a></li><li><a href=#构造函数提升支持-final-属性>构造函数提升支持 final 属性</a></li><li><a href=#setcookie-支持-partitioned-选项>setcookie() 支持 &ldquo;partitioned&rdquo; 选项</a></li><li><a href=#新的全局常量>新的全局常量</a></li><li><a href=#cli-新选项>CLI 新选项</a></li><li><a href=#max_memory_limit-ini-指令>max_memory_limit INI 指令</a></li></ul></li><li><a href=#弃用特性>弃用特性</a><ul><li><a href=#反引号运算符shell_exec-别名>反引号运算符（shell_exec 别名）</a></li><li><a href=#非标准类型转换>非标准类型转换</a></li><li><a href=#mysqli_execute>mysqli_execute()</a></li><li><a href=#curl_close-和-curl_share_close>curl_close() 和 curl_share_close()</a></li><li><a href=#xml_parser_free>xml_parser_free()</a></li><li><a href=#socket_set_timeout>socket_set_timeout()</a></li><li><a href=#mhash_-常量>MHASH_* 常量</a></li><li><a href=#__sleep-和-__wakeup>__sleep() 和 __wakeup()</a></li><li><a href=#case-语句后使用分号>case 语句后使用分号</a></li><li><a href=#null-作为数组偏移量>null 作为数组偏移量</a></li></ul></li><li><a href=#移除的特性>移除的特性</a><ul><li><a href=#disable_classes-ini-设置>disable_classes INI 设置</a></li><li><a href=#cli--z--zend-extension-选项>CLI -z / &ndash;zend-extension 选项</a></li></ul></li><li><a href=#兼容性变化>兼容性变化</a><ul><li><a href=#类型转换警告>类型转换警告</a></li><li><a href=#class_alias-限制>class_alias() 限制</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></details></div><div class=post-content><h2 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h2><p>PHP 8.5 引入了许多令人兴奋的新特性，包括管道运算符（Pipe Operator）、URI 扩展、Clone With 语法、<code>#[\NoDiscard]</code> 属性等。本文将介绍主要变化和如何从 PHP 8.4 迁移到 PHP 8.5。</p><h3 id=参考资源>参考资源<a hidden class=anchor aria-hidden=true href=#参考资源>#</a></h3><ul><li>在线测试环境：<a href=https://3v4l.org/>https://3v4l.org/</a></li><li>官方发布说明：<a href=https://www.php.net/releases/8.5/en.php>https://www.php.net/releases/8.5/en.php</a></li><li>迁移指南：<a href=https://www.php.net/manual/en/migration85.php>https://www.php.net/manual/en/migration85.php</a></li><li>更新详情：<a href=https://php.watch/versions/8.5>https://php.watch/versions/8.5</a></li></ul><h2 id=php-85-新特性>PHP 8.5 新特性<a hidden class=anchor aria-hidden=true href=#php-85-新特性>#</a></h2><h3 id=管道运算符pipe-operator>管道运算符（Pipe Operator）<a hidden class=anchor aria-hidden=true href=#管道运算符pipe-operator>#</a></h3><p>PHP 8.5 引入了管道运算符 <code>|></code>，使函数链式调用更加清晰易读：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// PHP 8.5 之前 - 嵌套函数调用，难以阅读
</span></span></span><span class=line><span class=cl><span class=nv>$slug</span> <span class=o>=</span> <span class=nx>strtolower</span><span class=p>(</span><span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=nx>trim</span><span class=p>(</span><span class=nv>$title</span><span class=p>))));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PHP 8.5 - 使用管道运算符，从左到右清晰阅读
</span></span></span><span class=line><span class=cl><span class=nv>$slug</span> <span class=o>=</span> <span class=nv>$title</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nx>trim</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=p>(</span><span class=nx>fn</span><span class=p>(</span><span class=nv>$str</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=nv>$str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=p>(</span><span class=nx>fn</span><span class=p>(</span><span class=nv>$str</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$str</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nx>strtolower</span><span class=p>(</span><span class=o>...</span><span class=p>);</span>
</span></span></code></pre></div><p>管道运算符将左侧的值作为右侧函数的第一个参数传递，实现函数组合的链式调用。</p><h3 id=uri-扩展>URI 扩展<a hidden class=anchor aria-hidden=true href=#uri-扩展>#</a></h3><p>PHP 8.5 新增了内置的 URI 扩展，遵循 RFC 3986 和 WHATWG URL 标准来解析和处理 URL。</p><blockquote><p><strong>URI 与 URL 的关系</strong>：URI（统一资源标识符）用于标识资源，URL（统一资源定位符）用于定位资源。所有 URL 都是 URI，但不是所有 URI 都是 URL。该扩展命名为 URI 是因为它能处理更广泛的标识符格式。</p></blockquote><p>示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// PHP 8.5 之前
</span></span></span><span class=line><span class=cl><span class=nv>$components</span> <span class=o>=</span> <span class=nx>parse_url</span><span class=p>(</span><span class=s1>&#39;https://php.net/releases/8.5/en.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$components</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]);</span> <span class=c1>// &#34;php.net&#34;
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PHP 8.5 - 使用新的 URI 扩展
</span></span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Uri\Rfc3986\Uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$uri</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uri</span><span class=p>(</span><span class=s1>&#39;https://php.net/releases/8.5/en.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$uri</span><span class=o>-&gt;</span><span class=na>getHost</span><span class=p>());</span>   <span class=c1>// &#34;php.net&#34;
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$uri</span><span class=o>-&gt;</span><span class=na>getPath</span><span class=p>());</span>   <span class=c1>// &#34;/releases/8.5/en.php&#34;
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$uri</span><span class=o>-&gt;</span><span class=na>getScheme</span><span class=p>());</span> <span class=c1>// &#34;https&#34;
</span></span></span></code></pre></div><p>新的 URI 扩展由 uriparser 和 Lexbor 库驱动，提供更安全、更符合标准的 URI 解析 API。</p><h3 id=clone-with-语法>Clone With 语法<a hidden class=anchor aria-hidden=true href=#clone-with-语法>#</a></h3><p>PHP 8.5 简化了对象克隆时更新属性的操作，特别适用于 readonly 类的 &ldquo;with-er&rdquo; 模式。</p><blockquote><p><strong>什么是 &ldquo;with-er&rdquo; 模式</strong>：一种用于不可变对象的设计模式，方法名以 <code>with</code> 开头（如 <code>withId()</code>、<code>withName()</code>），不修改原对象，而是返回一个修改了某个属性的新对象。常见于 PSR-7 HTTP 消息接口和 DateTimeImmutable 等。</p></blockquote><p>示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>readonly</span> <span class=nx>int</span> <span class=nv>$red</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>readonly</span> <span class=nx>int</span> <span class=nv>$green</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>readonly</span> <span class=nx>int</span> <span class=nv>$blue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>readonly</span> <span class=nx>int</span> <span class=nv>$alpha</span> <span class=o>=</span> <span class=mi>255</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// PHP 8.5 之前
</span></span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>withAlphaOld</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$alpha</span><span class=p>)</span><span class=o>:</span> <span class=nx>self</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$values</span> <span class=o>=</span> <span class=nx>get_object_vars</span><span class=p>(</span><span class=nv>$this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$values</span><span class=p>[</span><span class=s1>&#39;alpha&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$alpha</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>self</span><span class=p>(</span><span class=o>...</span><span class=nv>$values</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// PHP 8.5 - 使用 clone with
</span></span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>withAlpha</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$alpha</span><span class=p>)</span><span class=o>:</span> <span class=nx>self</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>clone</span><span class=p>(</span><span class=nv>$this</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;alpha&#39;</span> <span class=o>=&gt;</span> <span class=nv>$alpha</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$color</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Color</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$transparent</span> <span class=o>=</span> <span class=nv>$color</span><span class=o>-&gt;</span><span class=na>withAlpha</span><span class=p>(</span><span class=mi>128</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=nodiscard-属性>#[\NoDiscard] 属性<a hidden class=anchor aria-hidden=true href=#nodiscard-属性>#</a></h3><p>新的 <code>#[\NoDiscard]</code> 属性用于标记函数返回值不应被忽略：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>#[\NoDiscard(&#34;检查操作是否成功&#34;)]
</span></span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>saveData</span><span class=p>(</span><span class=k>array</span> <span class=nv>$data</span><span class=p>)</span><span class=o>:</span> <span class=nx>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 保存数据...
</span></span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 忽略返回值会触发警告
</span></span></span><span class=line><span class=cl><span class=nx>saveData</span><span class=p>([</span><span class=s1>&#39;key&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;value&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// Warning: return value of saveData() should be used or cast to (void)
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 正确使用
</span></span></span><span class=line><span class=cl><span class=nv>$success</span> <span class=o>=</span> <span class=nx>saveData</span><span class=p>([</span><span class=s1>&#39;key&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;value&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$success</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理错误
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 显式忽略（不会警告）
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>void</span><span class=p>)</span> <span class=nx>saveData</span><span class=p>([</span><span class=s1>&#39;key&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;value&#39;</span><span class=p>]);</span>
</span></span></code></pre></div><h3 id=常量表达式中的闭包>常量表达式中的闭包<a hidden class=anchor aria-hidden=true href=#常量表达式中的闭包>#</a></h3><p>PHP 8.5 允许在属性、常量和默认值中使用静态闭包和一等可调用对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Validator</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>const</span> <span class=no>RULES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;email&#39;</span> <span class=o>=&gt;</span> <span class=nx>filter_var</span><span class=p>(</span><span class=o>...</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;trim&#39;</span> <span class=o>=&gt;</span> <span class=nx>trim</span><span class=p>(</span><span class=o>...</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>process</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>callable</span> <span class=nv>$callback</span> <span class=o>=</span> <span class=nx>strtoupper</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$callback</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=持久化-curl-share-handles>持久化 cURL Share Handles<a hidden class=anchor aria-hidden=true href=#持久化-curl-share-handles>#</a></h3><p>新的 <code>curl_share_init_persistent()</code> 函数可以跨请求维护 cURL 共享句柄：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 创建持久化的共享句柄
</span></span></span><span class=line><span class=cl><span class=nv>$share</span> <span class=o>=</span> <span class=nx>curl_share_init_persistent</span><span class=p>(</span><span class=s1>&#39;my-share-handle&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>(</span><span class=s1>&#39;https://example.com&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_SHARE</span><span class=p>,</span> <span class=nv>$share</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=php-85-新增函数>PHP 8.5 新增函数<a hidden class=anchor aria-hidden=true href=#php-85-新增函数>#</a></h2><h3 id=array_first-和-array_last>array_first() 和 array_last()<a hidden class=anchor aria-hidden=true href=#array_first-和-array_last>#</a></h3><p>获取数组的第一个或最后一个元素，数组为空时返回 <code>null</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$events</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;login&#39;</span><span class=p>,</span> <span class=s1>&#39;view_page&#39;</span><span class=p>,</span> <span class=s1>&#39;checkout&#39;</span><span class=p>,</span> <span class=s1>&#39;logout&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$first</span> <span class=o>=</span> <span class=nx>array_first</span><span class=p>(</span><span class=nv>$events</span><span class=p>);</span>  <span class=c1>// &#39;login&#39;
</span></span></span><span class=line><span class=cl><span class=nv>$last</span> <span class=o>=</span> <span class=nx>array_last</span><span class=p>(</span><span class=nv>$events</span><span class=p>);</span>    <span class=c1>// &#39;logout&#39;
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$empty</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>array_first</span><span class=p>(</span><span class=nv>$empty</span><span class=p>));</span>  <span class=c1>// null
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>array_last</span><span class=p>(</span><span class=nv>$empty</span><span class=p>));</span>   <span class=c1>// null
</span></span></span></code></pre></div><h3 id=get_error_handler-和-get_exception_handler>get_error_handler() 和 get_exception_handler()<a hidden class=anchor aria-hidden=true href=#get_error_handler-和-get_exception_handler>#</a></h3><p>获取当前注册的错误处理器和异常处理器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 设置自定义错误处理器
</span></span></span><span class=line><span class=cl><span class=nx>set_error_handler</span><span class=p>(</span><span class=k>function</span><span class=p>(</span><span class=nv>$errno</span><span class=p>,</span> <span class=nv>$errstr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Error: </span><span class=si>$errstr</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取当前错误处理器
</span></span></span><span class=line><span class=cl><span class=nv>$handler</span> <span class=o>=</span> <span class=nx>get_error_handler</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$handler</span><span class=p>);</span> <span class=c1>// Closure
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取当前异常处理器
</span></span></span><span class=line><span class=cl><span class=nv>$exceptionHandler</span> <span class=o>=</span> <span class=nx>get_exception_handler</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=intllistformatter-类>IntlListFormatter 类<a hidden class=anchor aria-hidden=true href=#intllistformatter-类>#</a></h3><p>新的国际化列表格式化类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$formatter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntlListFormatter</span><span class=p>(</span><span class=s1>&#39;zh-CN&#39;</span><span class=p>,</span> <span class=nx>IntlListFormatter</span><span class=o>::</span><span class=na>TYPE_AND</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$formatter</span><span class=o>-&gt;</span><span class=na>format</span><span class=p>([</span><span class=s1>&#39;苹果&#39;</span><span class=p>,</span> <span class=s1>&#39;香蕉&#39;</span><span class=p>,</span> <span class=s1>&#39;橙子&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出: 苹果、香蕉和橙子
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$formatter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntlListFormatter</span><span class=p>(</span><span class=s1>&#39;en-US&#39;</span><span class=p>,</span> <span class=nx>IntlListFormatter</span><span class=o>::</span><span class=na>TYPE_OR</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$formatter</span><span class=o>-&gt;</span><span class=na>format</span><span class=p>([</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;banana&#39;</span><span class=p>,</span> <span class=s1>&#39;orange&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出: apple, banana, or orange
</span></span></span></code></pre></div><h3 id=curl_multi_get_handles>curl_multi_get_handles()<a hidden class=anchor aria-hidden=true href=#curl_multi_get_handles>#</a></h3><p>从 multi-cURL 会话中获取所有句柄：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$mh</span> <span class=o>=</span> <span class=nx>curl_multi_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$ch1</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>(</span><span class=s1>&#39;https://example.com/1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$ch2</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>(</span><span class=s1>&#39;https://example.com/2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>curl_multi_add_handle</span><span class=p>(</span><span class=nv>$mh</span><span class=p>,</span> <span class=nv>$ch1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>curl_multi_add_handle</span><span class=p>(</span><span class=nv>$mh</span><span class=p>,</span> <span class=nv>$ch2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$handles</span> <span class=o>=</span> <span class=nx>curl_multi_get_handles</span><span class=p>(</span><span class=nv>$mh</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>count</span><span class=p>(</span><span class=nv>$handles</span><span class=p>));</span> <span class=c1>// 2
</span></span></span></code></pre></div><h3 id=locale_is_right_to_left--localeisrighttoleft>locale_is_right_to_left() / Locale::isRightToLeft()<a hidden class=anchor aria-hidden=true href=#locale_is_right_to_left--localeisrighttoleft>#</a></h3><p>判断语言环境是否使用从右到左的文字方向：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>locale_is_right_to_left</span><span class=p>(</span><span class=s1>&#39;ar&#39;</span><span class=p>));</span>    <span class=c1>// true (阿拉伯语)
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>locale_is_right_to_left</span><span class=p>(</span><span class=s1>&#39;he&#39;</span><span class=p>));</span>    <span class=c1>// true (希伯来语)
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>locale_is_right_to_left</span><span class=p>(</span><span class=s1>&#39;zh-CN&#39;</span><span class=p>));</span> <span class=c1>// false (中文)
</span></span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>Locale</span><span class=o>::</span><span class=na>isRightToLeft</span><span class=p>(</span><span class=s1>&#39;fa&#39;</span><span class=p>));</span>      <span class=c1>// true (波斯语)
</span></span></span></code></pre></div><h3 id=grapheme_levenshtein>grapheme_levenshtein()<a hidden class=anchor aria-hidden=true href=#grapheme_levenshtein>#</a></h3><p>计算两个字符串之间的 Levenshtein 编辑距离（基于字形簇）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$distance</span> <span class=o>=</span> <span class=nx>grapheme_levenshtein</span><span class=p>(</span><span class=s1>&#39;café&#39;</span><span class=p>,</span> <span class=s1>&#39;cafe&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$distance</span><span class=p>);</span> <span class=c1>// 1
</span></span></span></code></pre></div><h3 id=closuregetcurrent>Closure::getCurrent()<a hidden class=anchor aria-hidden=true href=#closuregetcurrent>#</a></h3><p>在闭包内部获取当前闭包实例，便于实现递归：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$factorial</span> <span class=o>=</span> <span class=k>function</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$n</span><span class=p>)</span><span class=o>:</span> <span class=nx>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$n</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$n</span> <span class=o>*</span> <span class=nx>Closure</span><span class=o>::</span><span class=na>getCurrent</span><span class=p>()(</span><span class=nv>$n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$factorial</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span> <span class=c1>// 120
</span></span></span></code></pre></div><h2 id=其他改进>其他改进<a hidden class=anchor aria-hidden=true href=#其他改进>#</a></h2><h3 id=致命错误包含堆栈跟踪>致命错误包含堆栈跟踪<a hidden class=anchor aria-hidden=true href=#致命错误包含堆栈跟踪>#</a></h3><p>PHP 8.5 中，致命错误现在会包含完整的堆栈跟踪信息，大大提升了调试体验。</p><h3 id=新的-dom-方法>新的 DOM 方法<a hidden class=anchor aria-hidden=true href=#新的-dom-方法>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$doc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DOMDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$doc</span><span class=o>-&gt;</span><span class=na>loadHTML</span><span class=p>(</span><span class=s1>&#39;&lt;div class=&#34;box&#34;&gt;A&lt;/div&gt;&lt;div class=&#34;box&#34;&gt;B&lt;/div&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// getElementsByClassName()
</span></span></span><span class=line><span class=cl><span class=nv>$elements</span> <span class=o>=</span> <span class=nv>$doc</span><span class=o>-&gt;</span><span class=na>getElementsByClassName</span><span class=p>(</span><span class=s1>&#39;box&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$elements</span><span class=o>-&gt;</span><span class=na>length</span><span class=p>;</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// insertAdjacentHTML()
</span></span></span><span class=line><span class=cl><span class=nv>$div</span> <span class=o>=</span> <span class=nv>$doc</span><span class=o>-&gt;</span><span class=na>querySelector</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$div</span><span class=o>-&gt;</span><span class=na>insertAdjacentHTML</span><span class=p>(</span><span class=s1>&#39;beforeend&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;span&gt;New&lt;/span&gt;&#39;</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=属性可以应用于常量>属性可以应用于常量<a hidden class=anchor aria-hidden=true href=#属性可以应用于常量>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>#[Deprecated(&#34;Use NEW_CONST instead&#34;)]
</span></span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>const</span> <span class=no>OLD_CONST</span> <span class=o>=</span> <span class=s1>&#39;old&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>const</span> <span class=no>NEW_CONST</span> <span class=o>=</span> <span class=s1>&#39;new&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=静态属性支持非对称可见性>静态属性支持非对称可见性<a hidden class=anchor aria-hidden=true href=#静态属性支持非对称可见性>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Counter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>private</span><span class=p>(</span><span class=nx>set</span><span class=p>)</span> <span class=k>static</span> <span class=nx>int</span> <span class=nv>$count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>increment</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>self</span><span class=o>::</span><span class=nv>$count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>Counter</span><span class=o>::</span><span class=nv>$count</span><span class=p>;</span> <span class=c1>// 可读
</span></span></span><span class=line><span class=cl><span class=nx>Counter</span><span class=o>::</span><span class=nv>$count</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span> <span class=c1>// 错误：不可写
</span></span></span></code></pre></div><h3 id=构造函数提升支持-final-属性>构造函数提升支持 final 属性<a hidden class=anchor aria-hidden=true href=#构造函数提升支持-final-属性>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>final</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=setcookie-支持-partitioned-选项>setcookie() 支持 &ldquo;partitioned&rdquo; 选项<a hidden class=anchor aria-hidden=true href=#setcookie-支持-partitioned-选项>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>setcookie</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;expires&#39;</span> <span class=o>=&gt;</span> <span class=nx>time</span><span class=p>()</span> <span class=o>+</span> <span class=mi>3600</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;path&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;secure&#39;</span> <span class=o>=&gt;</span> <span class=k>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;partitioned&#39;</span> <span class=o>=&gt;</span> <span class=k>true</span><span class=p>,</span>  <span class=c1>// 新选项
</span></span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span></code></pre></div><h3 id=新的全局常量>新的全局常量<a hidden class=anchor aria-hidden=true href=#新的全局常量>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 构建提供者标识
</span></span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>PHP_BUILD_PROVIDER</span><span class=p>;</span> <span class=c1>// 例如: &#34;debian&#34; 或 &#34;remi&#34;
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 构建日期
</span></span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>PHP_BUILD_DATE</span><span class=p>;</span> <span class=c1>// 例如: &#34;Jan 1 2026&#34;
</span></span></span></code></pre></div><h3 id=cli-新选项>CLI 新选项<a hidden class=anchor aria-hidden=true href=#cli-新选项>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 显示与默认值不同的 INI 配置</span>
</span></span><span class=line><span class=cl>php --ini<span class=o>=</span>diff
</span></span></code></pre></div><h3 id=max_memory_limit-ini-指令>max_memory_limit INI 指令<a hidden class=anchor aria-hidden=true href=#max_memory_limit-ini-指令>#</a></h3><p>管理员可以设置内存限制的上限：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; php.ini</span>
</span></span><span class=line><span class=cl><span class=na>max_memory_limit</span> <span class=o>=</span> <span class=s>256M</span>
</span></span></code></pre></div><p>应用程序无法将 <code>memory_limit</code> 设置为超过 <code>max_memory_limit</code> 的值。</p><h2 id=弃用特性>弃用特性<a hidden class=anchor aria-hidden=true href=#弃用特性>#</a></h2><h3 id=反引号运算符shell_exec-别名>反引号运算符（shell_exec 别名）<a hidden class=anchor aria-hidden=true href=#反引号运算符shell_exec-别名>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ PHP 8.5 已弃用
</span></span></span><span class=line><span class=cl><span class=nv>$output</span> <span class=o>=</span> <span class=sb>`ls -la`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用 shell_exec()
</span></span></span><span class=line><span class=cl><span class=nv>$output</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;ls -la&#39;</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=非标准类型转换>非标准类型转换<a hidden class=anchor aria-hidden=true href=#非标准类型转换>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ PHP 8.5 已弃用
</span></span></span><span class=line><span class=cl><span class=nv>$bool</span> <span class=o>=</span> <span class=p>(</span><span class=nx>boolean</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$int</span> <span class=o>=</span> <span class=p>(</span><span class=nx>integer</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$float</span> <span class=o>=</span> <span class=p>(</span><span class=nx>double</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$bin</span> <span class=o>=</span> <span class=p>(</span><span class=nx>binary</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用标准类型转换
</span></span></span><span class=line><span class=cl><span class=nv>$bool</span> <span class=o>=</span> <span class=p>(</span><span class=nx>bool</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$int</span> <span class=o>=</span> <span class=p>(</span><span class=nx>int</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$float</span> <span class=o>=</span> <span class=p>(</span><span class=nx>float</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$bin</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span> <span class=nv>$value</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=mysqli_execute>mysqli_execute()<a hidden class=anchor aria-hidden=true href=#mysqli_execute>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ 已弃用
</span></span></span><span class=line><span class=cl><span class=nx>mysqli_execute</span><span class=p>(</span><span class=nv>$stmt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用 mysqli_stmt_execute()
</span></span></span><span class=line><span class=cl><span class=nx>mysqli_stmt_execute</span><span class=p>(</span><span class=nv>$stmt</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=curl_close-和-curl_share_close>curl_close() 和 curl_share_close()<a hidden class=anchor aria-hidden=true href=#curl_close-和-curl_share_close>#</a></h3><p>这些函数自 PHP 8.0 起就是空操作，现在正式弃用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ 已弃用（实际上不需要调用）
</span></span></span><span class=line><span class=cl><span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>curl_share_close</span><span class=p>(</span><span class=nv>$sh</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// cURL 句柄现在会自动清理
</span></span></span></code></pre></div><h3 id=xml_parser_free>xml_parser_free()<a hidden class=anchor aria-hidden=true href=#xml_parser_free>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ 已弃用（自 PHP 8.0 起是空操作）
</span></span></span><span class=line><span class=cl><span class=nx>xml_parser_free</span><span class=p>(</span><span class=nv>$parser</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// XML 解析器现在会自动清理
</span></span></span></code></pre></div><h3 id=socket_set_timeout>socket_set_timeout()<a hidden class=anchor aria-hidden=true href=#socket_set_timeout>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ 已弃用
</span></span></span><span class=line><span class=cl><span class=nx>socket_set_timeout</span><span class=p>(</span><span class=nv>$stream</span><span class=p>,</span> <span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用 stream_set_timeout()
</span></span></span><span class=line><span class=cl><span class=nx>stream_set_timeout</span><span class=p>(</span><span class=nv>$stream</span><span class=p>,</span> <span class=mi>30</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=mhash_-常量>MHASH_* 常量<a hidden class=anchor aria-hidden=true href=#mhash_-常量>#</a></h3><p>所有 <code>MHASH_*</code> 相关常量已弃用，应使用 <code>hash()</code> 函数替代。</p><h3 id=__sleep-和-__wakeup>__sleep() 和 __wakeup()<a hidden class=anchor aria-hidden=true href=#__sleep-和-__wakeup>#</a></h3><p>这两个魔术方法被软弃用（soft-deprecated），建议使用 <code>__serialize()</code> 和 <code>__unserialize()</code> 替代：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ 软弃用
</span></span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>OldStyle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__sleep</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 推荐方式
</span></span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NewStyle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>__serialize</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>data</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>__unserialize</span><span class=p>(</span><span class=k>array</span> <span class=nv>$data</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>data</span> <span class=o>=</span> <span class=nv>$data</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=case-语句后使用分号>case 语句后使用分号<a hidden class=anchor aria-hidden=true href=#case-语句后使用分号>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ PHP 8.5 已弃用
</span></span></span><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=p>;</span>  <span class=c1>// 分号
</span></span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用冒号
</span></span></span><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>  <span class=c1>// 冒号
</span></span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=null-作为数组偏移量>null 作为数组偏移量<a hidden class=anchor aria-hidden=true href=#null-作为数组偏移量>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// ❌ PHP 8.5 已弃用
</span></span></span><span class=line><span class=cl><span class=nv>$array</span><span class=p>[</span><span class=k>null</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;value&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ✅ 使用空字符串或其他明确的键
</span></span></span><span class=line><span class=cl><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;value&#39;</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=移除的特性>移除的特性<a hidden class=anchor aria-hidden=true href=#移除的特性>#</a></h2><h3 id=disable_classes-ini-设置>disable_classes INI 设置<a hidden class=anchor aria-hidden=true href=#disable_classes-ini-设置>#</a></h3><p><code>disable_classes</code> INI 设置已被完全移除。</p><h3 id=cli--z--zend-extension-选项>CLI -z / &ndash;zend-extension 选项<a hidden class=anchor aria-hidden=true href=#cli--z--zend-extension-选项>#</a></h3><p>从命令行加载 Zend 扩展的选项已被移除。</p><h2 id=兼容性变化>兼容性变化<a hidden class=anchor aria-hidden=true href=#兼容性变化>#</a></h2><h3 id=类型转换警告>类型转换警告<a hidden class=anchor aria-hidden=true href=#类型转换警告>#</a></h3><ul><li>NAN 转换为其他类型时会产生警告</li><li>浮点数转整数时的精度损失会产生警告</li><li>对非数组使用解构语法会产生警告</li></ul><h3 id=class_alias-限制>class_alias() 限制<a hidden class=anchor aria-hidden=true href=#class_alias-限制>#</a></h3><p>&ldquo;array&rdquo; 和 &ldquo;callable&rdquo; 不再是 <code>class_alias()</code> 的有效类名。</p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>PHP 8.5 带来了许多实用的新特性和改进：</p><p><strong>主要新特性：</strong></p><ul><li>管道运算符 <code>|></code></li><li>URI 扩展</li><li>Clone With 语法</li><li><code>#[\NoDiscard]</code> 属性</li><li><code>array_first()</code> 和 <code>array_last()</code> 函数</li><li>常量表达式中的闭包</li><li>致命错误堆栈跟踪</li><li>IntlListFormatter 类</li></ul><p><strong>需要注意的变化：</strong></p><ul><li>反引号运算符已弃用</li><li>非标准类型转换已弃用</li><li><code>__sleep()</code> 和 <code>__wakeup()</code> 软弃用</li><li><code>disable_classes</code> INI 设置已移除</li></ul><p>通过了解这些变化并遵循迁移建议，可以顺利地从 PHP 8.4 迁移到 PHP 8.5。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zyf.im/tags/php/>Php</a></li><li><a href=https://zyf.im/tags/php-migrating/>Php-Migrating</a></li></ul><nav class=paginav><a class=next href=https://zyf.im/2025/06/27/nginx-enable-http3/><span class=title>Next »</span><br><span>NGINX 启用 HTTP/3</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>