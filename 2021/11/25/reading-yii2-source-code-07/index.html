<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="preconnect" href="//www.googletagmanager.com"><link rel="preconnect" href="//zz.bdstatic.com"><link rel="preconnect" href="//sp0.baidu.com"><link rel="preconnect" href="//www.google-analytics.com"><link rel="preconnect" href="//cdn1.lncld.net"><link rel="preconnect" href="//unpkg.com"><link rel="preconnect" href="//app-router.leancloud.cn"><link rel="preconnect" href="//9qpuwspm.api.lncld.net"><link rel="preconnect" href="//gravatar.loli.net"><title>Yii2 源码阅读 07 - Controller | 全力以赴</title><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="generator" content="hexo"><meta name="author" content="Yifans_Z"><meta name="description" content=""><meta name="keywords" content=""><meta name="theme-color" content="#3c484e"><meta name="msapplication-TileColor" content="#3c484e"><meta property="og:site_name" content="全力以赴"><meta property="og:type" content="article"><meta property="og:title" content="Yii2 源码阅读 07 - Controller | 全力以赴"><meta property="og:description" content=""><meta property="og:url" content="https://zyf.im/2021/11/25/reading-yii2-source-code-07/"><meta property="article:published_time" content="2021-11-25T11:11:00+08:00"><meta property="article:author" content="Yifans_Z"><meta property="article:published_first" content="全力以赴, /2021/11/25/reading-yii2-source-code-07/"><link rel="stylesheet" href="/css/allinonecss.min.css"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-84666938-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-84666938-1")</script></head><body class="post-template"><div class="site-wrapper"><header class="site-header post-site-header outer"><div class="inner"><nav class="site-nav"><div class="site-nav-left"><ul class="nav"><li><a href="/" title="Home">HOME</a></li><li><a href="/archives" title="ARCHIVES">ARCHIVES</a></li><li><a href="/links" title="LINKS">LINKS</a></li><li><a href="/about" title="ABOUT">ABOUT</a></li></ul></div><div class="search-button-area"><a href="#search" class="search-button">Search ...</a></div><div class="site-nav-right"><a href="#search" class="search-button">Search ...</a><div class="social-links"><a class="social-link" title="github" href="https://github.com/imzyf" target="_blank" rel="noopener"><svg viewBox="0 0 1049 1024" xmlns="http://www.w3.org/2000/svg"><path d="M524.979332 0C234.676191 0 0 234.676191 0 524.979332c0 232.068678 150.366597 428.501342 358.967656 498.035028 26.075132 5.215026 35.636014-11.299224 35.636014-25.205961 0-12.168395-0.869171-53.888607-0.869171-97.347161-146.020741 31.290159-176.441729-62.580318-176.441729-62.580318-23.467619-60.841976-58.234462-76.487055-58.234463-76.487055-47.804409-32.15933 3.476684-32.15933 3.476685-32.15933 53.019436 3.476684 80.83291 53.888607 80.83291 53.888607 46.935238 79.963739 122.553122 57.365291 152.97411 43.458554 4.345855-33.897672 18.252593-57.365291 33.028501-70.402857-116.468925-12.168395-239.022047-57.365291-239.022047-259.012982 0-57.365291 20.860106-104.300529 53.888607-140.805715-5.215026-13.037566-23.467619-66.926173 5.215027-139.067372 0 0 44.327725-13.906737 144.282399 53.888607 41.720212-11.299224 86.917108-17.383422 131.244833-17.383422s89.524621 6.084198 131.244833 17.383422C756.178839 203.386032 800.506564 217.29277 800.506564 217.29277c28.682646 72.1412 10.430053 126.029806 5.215026 139.067372 33.897672 36.505185 53.888607 83.440424 53.888607 140.805715 0 201.64769-122.553122 245.975415-239.891218 259.012982 19.121764 16.514251 35.636014 47.804409 35.636015 97.347161 0 70.402857-0.869171 126.898978-0.869172 144.282399 0 13.906737 9.560882 30.420988 35.636015 25.205961 208.601059-69.533686 358.967656-265.96635 358.967655-498.035028C1049.958663 234.676191 814.413301 0 524.979332 0z"></path></svg></a></div></div></nav></div></header><div id="site-main" class="site-main outer" role="main"><div class="inner"><header class="post-full-header"><div class="post-full-meta"><time class="post-full-meta-date" datetime="2021-11-25T03:32:03.000Z">2021-11-25 </time><span class="date-divider">/</span> <a href="/categories/yii2/">yii2</a>&nbsp;&nbsp;</div><h1 class="post-full-title">Yii2 源码阅读 07 - Controller</h1></header><div class="post-full no-image"><div class="post-full-content"><article id="photoswipe" class="markdown-body"><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">|--- yii\base\BaseObject</span><br><span class="line">    |--- Behavior</span><br><span class="line">        |--- ActionFilter</span><br><span class="line">    |</span><br><span class="line">    |--- Component</span><br><span class="line">        |--- Action</span><br><span class="line">            |--- InlineAction</span><br><span class="line">        |</span><br><span class="line">        |--- Controller            &lt;-- 本节</span><br><span class="line">        |--- ErrorHandler</span><br><span class="line">        |--- Model</span><br><span class="line">            |--- DynamicModel</span><br><span class="line">        |</span><br><span class="line">        |--- Request</span><br><span class="line">        |--- Response</span><br><span class="line">        |--- Security</span><br><span class="line">        |--- Theme</span><br><span class="line">        |--- View</span><br><span class="line">        |--- Widget</span><br><span class="line">        |--- yii\di\ServiceLocator</span><br><span class="line">            |--- Module</span><br><span class="line">                |--- Application</span><br><span class="line">    |</span><br><span class="line">    |--- Event</span><br><span class="line">        |--- ActionEvent</span><br><span class="line">        |--- ModelEvent</span><br><span class="line">        |--- ViewEvent</span><br><span class="line">        |--- WidgetEvent</span><br><span class="line">    |</span><br><span class="line">    |--- Exception</span><br><span class="line">    |--- ExitException</span><br><span class="line">    |--- InvalidParamException</span><br><span class="line">    |--- InvalidValueException</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">|--- yii\base\Controller</span><br><span class="line">    |--- yii\web\Controller</span><br><span class="line">        |--- yii\rest\Controller</span><br><span class="line">            |--- ActiveController</span><br><span class="line"></span><br><span class="line">    |--- yii\console\Controller</span><br><span class="line">        |--- AssetController</span><br><span class="line">        |--- BaseMigrateController</span><br><span class="line">            |--- MigrateController</span><br><span class="line"></span><br><span class="line">        |--- CacheController</span><br><span class="line">        |--- FixtureController</span><br><span class="line">        |--- HelpController</span><br><span class="line">        |--- ServeController</span><br></pre></td></tr></tbody></table></figure><h2 id="yii-base-Controller"><a href="#yii-base-Controller" class="headerlink" title="yii\base\Controller"></a>yii\base\Controller</h2><blockquote><p>参见：<a href="https://www.yiiframework.com/doc/guide/2.0/zh-cn/structure-controllers" target="_blank" rel="noopener">控制器（Controllers）</a></p></blockquote><p>属性：</p><ul><li><code>@property-read Module[] $modules</code> 此控制器所在的所有祖先模块。</li><li><code>@property-read string $route</code> 当前请求的路由(module ID, controller ID and action ID)。</li><li><code>@property-read string $uniqueId</code> 以模块 ID(如果有)作为前缀的控制器 ID。可以理解为路由路径。</li><li><code>@property View|\yii\web\View $view</code> 可以用来呈现视图或视图文件的视图对象。</li><li><code>@property string $viewPath</code> 包含此控制器的视图文件的目录。</li></ul><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Controller</span> <span class="keyword">extends</span> <span class="title">Component</span> <span class="keyword">implements</span> <span class="title">ViewContextInterface</span></span></span><br></pre></td></tr></tbody></table></figure><p>ViewContextInterface 是那些想要 support relative view names 的类应该实现的接口。</p><ul><li><code>public function getViewPath();</code> 返回以相对视图名作为前缀的视图路径。</li></ul><p>属性：</p><ul><li><code>string $id</code> controller ID。</li><li><code>Module $module controller</code> 所属 module。</li><li><code>string $defaultAction</code> 当请求中没有指定 action ID 时使用的 action ID。默认 ‘index’。</li><li><code>null|string|false $layout</code> 要应用于此控制器视图的布局的名称。此属性主要影响 <code>render()</code> 的行为。默认为 null，意味着实际的布局值应该从 <code>module</code> 的布局值继承。如果为 false，将不应用布局。</li><li><code>Action|null $action</code> 当前正在执行的 action。当 Application 调用该属性来运行一个 action 时，<code>run()</code> 将设置该属性。</li><li><code>Request|array|string $request</code></li><li><code>Response|array|string $response</code></li></ul><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为控制器声明外部 actions。</span></span><br><span class="line"><span class="comment"> * 这个方法应该被覆盖以声明控制器的外部操作。</span></span><br><span class="line"><span class="comment"> * 它应该返回一个数组，其中数组键是操作id，数组值是对应的操作类名或操作配置数组。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Yii::createObject() 稍后将使用这里提供的配置来创建请求的操作。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'action1'</span> =&gt; <span class="string">'app\components\Action1'</span>,</span><br><span class="line">    <span class="string">'action2'</span> =&gt; [</span><br><span class="line">      <span class="string">'class'</span> =&gt; <span class="string">'app\components\Action2'</span>,</span><br><span class="line">      <span class="string">'property1'</span> =&gt; <span class="string">'value1'</span>,</span><br><span class="line">      <span class="string">'property2'</span> =&gt; <span class="string">'value2'</span>,</span><br><span class="line">    ],</span><br><span class="line">  ];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用指定的 action ID 和参数在该控制器中运行一个 action。</span></span><br><span class="line"><span class="comment"> * 如果 action ID 为空，该方法将使用 defaultAction。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $id 需要执行的 action ID。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $params 要传递给 action 的参数(名称-值对 name-value pairs)。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed the result of the action.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvalidRouteException 如果请求的 action ID 不能成功解析为 action。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> createAction()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">runAction</span><span class="params">($id, $params = [])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 根据 ID 得到一个 Action 对象</span></span><br><span class="line">    $action = <span class="keyword">$this</span>-&gt;createAction($id);</span><br><span class="line">    <span class="keyword">if</span> ($action === <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidRouteException(<span class="string">'Unable to resolve the request: '</span> . <span class="keyword">$this</span>-&gt;getUniqueId() . <span class="string">'/'</span> . $id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Yii::debug(<span class="string">'Route to run: '</span> . $action-&gt;getUniqueId(), <span class="keyword">__METHOD__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录当前 Action</span></span><br><span class="line">    <span class="keyword">if</span> (Yii::$app-&gt;requestedAction === <span class="keyword">null</span>) {</span><br><span class="line">        Yii::$app-&gt;requestedAction = $action;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取上一个 Action</span></span><br><span class="line">    $oldAction = <span class="keyword">$this</span>-&gt;action;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;action = $action;</span><br><span class="line"></span><br><span class="line">    $modules = [];</span><br><span class="line">    $runAction = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call beforeAction on modules</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;getModules() <span class="keyword">as</span> $module) {</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// $event = new ActionEvent($action);</span></span><br><span class="line">        <span class="comment">// $this-&gt;trigger(self::EVENT_BEFORE_ACTION, $event);</span></span><br><span class="line">        <span class="comment">// return $event-&gt;isValid;</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">if</span> ($module-&gt;beforeAction($action)) {</span><br><span class="line">            <span class="comment">// 在数组开头插入</span></span><br><span class="line">            array_unshift($modules, $module);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            $runAction = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    $result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 和 $module-&gt;beforeAction($action) 实现一样</span></span><br><span class="line">    <span class="keyword">if</span> ($runAction &amp;&amp; <span class="keyword">$this</span>-&gt;beforeAction($action)) {</span><br><span class="line">        <span class="comment">// run the action</span></span><br><span class="line">        <span class="comment">// 这里有点疑问 为什么不直接调用 $action-&gt;run 呢?</span></span><br><span class="line">        <span class="comment">// 现在理解可能是为了对 run 在进行封装操作，提交 action 的 beforeRun &amp; afterRun</span></span><br><span class="line">        $result = $action-&gt;runWithParams($params);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// $event = new ActionEvent($action);</span></span><br><span class="line">        <span class="comment">// $event-&gt;result = $result;</span></span><br><span class="line">        <span class="comment">// $this-&gt;trigger(self::EVENT_AFTER_ACTION, $event);</span></span><br><span class="line">        <span class="comment">// return $event-&gt;result;</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        $result = <span class="keyword">$this</span>-&gt;afterAction($action, $result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// call afterAction on modules</span></span><br><span class="line">        <span class="keyword">foreach</span> ($modules <span class="keyword">as</span> $module) {</span><br><span class="line">            <span class="comment">/* <span class="doctag">@var</span> $module Module */</span></span><br><span class="line">            $result = $module-&gt;afterAction($action, $result);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($oldAction !== <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">$this</span>-&gt;action = $oldAction;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据给定的 action ID 创建 action。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 该方法首先检查 action ID 是否在 actions() 中声明。</span></span><br><span class="line"><span class="comment"> * 如果是，它将使用声明的配置来创建 action 对象。</span></span><br><span class="line"><span class="comment"> * 如果不是，它将寻找一个名称为 actionXyz 格式的控制器方法，其中 xyz 是 action ID。</span></span><br><span class="line"><span class="comment"> *   如果找到，表示该方法的 InlineAction 将被创建并返回，否则返回 null。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $id the action ID.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Action|null 新创建的操作实例。如果 ID 没有分解为任何操作，则为空。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createAction</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="keyword">if</span> ($id === <span class="string">''</span>) {</span><br><span class="line">      <span class="comment">// 设置默认 action id index</span></span><br><span class="line">      $id = <span class="keyword">$this</span>-&gt;defaultAction;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  $actionMap = <span class="keyword">$this</span>-&gt;actions();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>($actionMap[$id])) {</span><br><span class="line">      <span class="comment">// 存在于 actions()</span></span><br><span class="line">      <span class="keyword">return</span> Yii::createObject($actionMap[$id], [$id, <span class="keyword">$this</span>]);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (preg_match(<span class="string">'/^(?:[a-z0-9_]+-)*[a-z0-9_]+$/'</span>, $id)) {</span><br><span class="line">      <span class="comment">// xyz-abc =&gt; actionXyzAbc</span></span><br><span class="line">      <span class="comment">// 中划线转大驼峰</span></span><br><span class="line">      $methodName = <span class="string">'action'</span> . str_replace(<span class="string">' '</span>, <span class="string">''</span>, ucwords(str_replace(<span class="string">'-'</span>, <span class="string">' '</span>, $id)));</span><br><span class="line">      <span class="comment">// 验证方法是否存在</span></span><br><span class="line">      <span class="keyword">if</span> (method_exists(<span class="keyword">$this</span>, $methodName)) {</span><br><span class="line">          $method = <span class="keyword">new</span> \ReflectionMethod(<span class="keyword">$this</span>, $methodName);</span><br><span class="line">          <span class="keyword">if</span> ($method-&gt;isPublic() &amp;&amp; $method-&gt;getName() === $methodName) {</span><br><span class="line">              <span class="comment">// method 需要 public &amp;&amp; method name 相等</span></span><br><span class="line">              <span class="comment">// 内联 Action</span></span><br><span class="line">              <span class="comment">// 将 ctrl 中的方法封装成了一个 InlineAction 对象</span></span><br><span class="line">              <span class="comment">// InlineAction runWithParams 就是调用这个 ctrl 的这个方法</span></span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> InlineAction($id, <span class="keyword">$this</span>, $methodName);</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 运行根据路由指定的请求。</span></span><br><span class="line"><span class="comment">  * 路由可以是该控制器内某个 action ID，也可以是由模块ID、控制器ID和动作ID组成的完整路由。</span></span><br><span class="line"><span class="comment">  * 如果路由以斜线 '/' 开头，则解析该路由将从应用程序开始；</span></span><br><span class="line"><span class="comment">  * 否则，它将从该控制器的父模块开始。</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> string $route the route to be handled, e.g., 'view', 'comment/view', '/admin/comment/view'.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> array $params the parameters to be passed to the action.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> mixed the result of the action.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> runAction()</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">($route, $params = [])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  $pos = strpos($route, <span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">if</span> ($pos === <span class="keyword">false</span>) {</span><br><span class="line">      <span class="comment">// 没有 /，从 ctrl 下开始</span></span><br><span class="line">      <span class="comment">// 'view'</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;runAction($route, $params);</span><br><span class="line">  } <span class="keyword">elseif</span> ($pos &gt; <span class="number">0</span>) {</span><br><span class="line">      <span class="comment">// 包含 /，从模块下开始</span></span><br><span class="line">      <span class="comment">// 'comment/view'</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;module-&gt;runAction($route, $params);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果路由以斜线 '/' 开头，则解析该路由将从应用程序开始</span></span><br><span class="line">  <span class="comment">// '/admin/comment/view'</span></span><br><span class="line">  <span class="keyword">return</span> Yii::$app-&gt;runAction(ltrim($route, <span class="string">'/'</span>), $params);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据动作方法签名中的类型和名称填充参数。</span></span><br><span class="line"><span class="comment">  * Fills parameters based on types and names in action method signature.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> \ReflectionType $type 动作参数的反射类型。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> string $name The name of the parameter.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> array &amp;$args 动作的参数数组，此函数可以将项目附加到它。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> array &amp;$requestedParams 具有请求参数的数组，此函数可能会向其写入特定键。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> ErrorException when we cannot load a required service.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> InvalidConfigException Thrown when there is an error in the DI configuration.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> NotInstantiableException 在容器中没有正确定义的情况下无法将定义解析为具体类（例如接口类型提示）时抛出。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@since</span> 2.0.36</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">bindInjectedParams</span><span class="params">(\ReflectionType $type, $name, &amp;$args, &amp;$requestedParams)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// Since it is not a builtin type it must be DI injection.</span></span><br><span class="line">    <span class="comment">// 由于它不是内置类型，因此必须是 DI 注入。</span></span><br><span class="line">    $typeName = $type-&gt;getName();</span><br><span class="line">    <span class="keyword">if</span> (($component = <span class="keyword">$this</span>-&gt;module-&gt;get($name, <span class="keyword">false</span>)) <span class="keyword">instanceof</span> $typeName) {</span><br><span class="line">        $args[] = $component;</span><br><span class="line">        $requestedParams[$name] = <span class="string">"Component: "</span> . get_class($component) . <span class="string">" \$$name"</span>;</span><br><span class="line">    } <span class="keyword">elseif</span> (<span class="keyword">$this</span>-&gt;module-&gt;has($typeName) &amp;&amp; ($service = <span class="keyword">$this</span>-&gt;module-&gt;get($typeName)) <span class="keyword">instanceof</span> $typeName) {</span><br><span class="line">        $args[] = $service;</span><br><span class="line">        $requestedParams[$name] = <span class="string">'Module '</span> . get_class(<span class="keyword">$this</span>-&gt;module) . <span class="string">" DI: $typeName \$$name"</span>;</span><br><span class="line">    } <span class="keyword">elseif</span> (\Yii::$container-&gt;has($typeName) &amp;&amp; ($service = \Yii::$container-&gt;get($typeName)) <span class="keyword">instanceof</span> $typeName) {</span><br><span class="line">        $args[] = $service;</span><br><span class="line">        $requestedParams[$name] = <span class="string">"Container DI: $typeName \$$name"</span>;</span><br><span class="line">    } <span class="keyword">elseif</span> ($type-&gt;allowsNull()) {</span><br><span class="line">        $args[] = <span class="keyword">null</span>;</span><br><span class="line">        $requestedParams[$name] = <span class="string">"Unavailable service: $name"</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'Could not load required service: '</span> . $name);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个方法还不清楚作用，是在 web/Controller console/Controller 中被调用。</span></span><br></pre></td></tr></tbody></table></figure><h2 id="yii-web-Controller"><a href="#yii-web-Controller" class="headerlink" title="yii\web\Controller"></a>yii\web\Controller</h2><p>属性：</p><ul><li><code>bool $enableCsrfValidation</code> 是否对该控制器中的 actions 启用 CSRF 验证。只有当这个 property 和 <code>yii\web\Request::enableCsrfValidation</code> 都为 true 时，CSRF 验证才被启用。</li><li><code>array $actionParams</code> 绑定到当前 action 的参数。</li></ul><p>方法：</p><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应 AJAX 请求呈现视图。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这个方法类似于 renderPartial()，不同的是它会用 JS/CSS 脚本和注册在视图中的文件注入到渲染结果中。</span></span><br><span class="line"><span class="comment"> * 出于这个原因，您应该使用此方法而不是 renderPartial() 来呈现一个视图以响应 AJAX 请求。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $view the view name. Please refer to [[render()]] on how to specify a view name.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $params the parameters (name-value pairs) that should be made available in the view.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string the rendering result.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">renderAjax</span><span class="params">($view, $params = [])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getView()-&gt;renderAjax($view, $params, <span class="keyword">$this</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个方法没有使用过 还不清楚作用</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Send data formatted as JSON.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">asJson</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">$this</span>-&gt;response-&gt;format = Response::FORMAT_JSON;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;response-&gt;data = $data;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// return $this-&gt;asJson($data);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Send data formatted as XML.</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">asXml</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">$this</span>-&gt;response-&gt;format = Response::FORMAT_XML;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;response-&gt;data = $data;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// return $this-&gt;asXml($data);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这两个方法异曲同工，操作 response 的 format 类型。框架已内置的方法。</span></span><br></pre></td></tr></tbody></table></figure><p>非常核心的方法，在 Action 中的 runWithParams 里调用：</p><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将参数绑定到 action。</span></span><br><span class="line"><span class="comment"> * 当 \yii\base\Action 以给定的参数开始运行时，该方法被 \yii\base\Action 调用。</span></span><br><span class="line"><span class="comment"> * 该方法将检查操作需要的参数名称，并根据需求返回他提供的参数。</span></span><br><span class="line"><span class="comment"> * 如果有任何丢失的参数，就会抛出异常。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> \yii\base\Action $action 要用参数绑定的 action</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $params 要绑定到 action 的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array action 可以使用的有效参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BadRequestHttpException if there are missing or invalid parameters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionParams</span><span class="params">($action, $params)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 获取 action 要执行的方法</span></span><br><span class="line">    <span class="keyword">if</span> ($action <span class="keyword">instanceof</span> InlineAction) {</span><br><span class="line">        $method = <span class="keyword">new</span> \ReflectionMethod(<span class="keyword">$this</span>, $action-&gt;actionMethod);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        $method = <span class="keyword">new</span> \ReflectionMethod($action, <span class="string">'run'</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    $args = [];</span><br><span class="line">    $missing = [];</span><br><span class="line">    $actionParams = [];</span><br><span class="line">    $requestedParams = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 变量方法参数</span></span><br><span class="line">    <span class="keyword">foreach</span> ($method-&gt;getParameters() <span class="keyword">as</span> $param) {</span><br><span class="line">        <span class="comment">// 参数名</span></span><br><span class="line">        $name = $param-&gt;getName();</span><br><span class="line">        <span class="comment">// 验证参数类型</span></span><br><span class="line">        <span class="keyword">if</span> (array_key_exists($name, $params)) {</span><br><span class="line">            $isValid = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (PHP_VERSION_ID &gt;= <span class="number">80000</span>) {</span><br><span class="line">                $isArray = ($type = $param-&gt;getType()) <span class="keyword">instanceof</span> \ReflectionNamedType &amp;&amp; $type-&gt;getName() === <span class="string">'array'</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                $isArray = $param-&gt;isArray();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> ($isArray) {</span><br><span class="line">                <span class="comment">// 参数是数组</span></span><br><span class="line">                $params[$name] = (<span class="keyword">array</span>)$params[$name];</span><br><span class="line">            } <span class="keyword">elseif</span> (is_array($params[$name])) {</span><br><span class="line">                $isValid = <span class="keyword">false</span>;</span><br><span class="line">            } <span class="keyword">elseif</span> (</span><br><span class="line">                PHP_VERSION_ID &gt;= <span class="number">70000</span></span><br><span class="line">                &amp;&amp; ($type = $param-&gt;getType()) !== <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; $type-&gt;isBuiltin()</span><br><span class="line">                &amp;&amp; ($params[$name] !== <span class="keyword">null</span> || !$type-&gt;allowsNull())</span><br><span class="line">            ) {</span><br><span class="line">                $typeName = PHP_VERSION_ID &gt;= <span class="number">70100</span> ? $type-&gt;getName() : (string)$type;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ($params[$name] === <span class="string">''</span> &amp;&amp; $type-&gt;allowsNull()) {</span><br><span class="line">                    <span class="keyword">if</span> ($typeName !== <span class="string">'string'</span>) { <span class="comment">// for old string behavior compatibility</span></span><br><span class="line">                        $params[$name] = <span class="keyword">null</span>;</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">switch</span> ($typeName) {</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'int'</span>:</span><br><span class="line">                            $params[$name] = filter_var($params[$name], FILTER_VALIDATE_INT, FILTER_NULL_ON_FAILURE);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'float'</span>:</span><br><span class="line">                            $params[$name] = filter_var($params[$name], FILTER_VALIDATE_FLOAT, FILTER_NULL_ON_FAILURE);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'bool'</span>:</span><br><span class="line">                            $params[$name] = filter_var($params[$name], FILTER_VALIDATE_BOOLEAN, FILTER_NULL_ON_FAILURE);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">if</span> ($params[$name] === <span class="keyword">null</span>) {</span><br><span class="line">                        $isValid = <span class="keyword">false</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!$isValid) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadRequestHttpException(</span><br><span class="line">                    Yii::t(<span class="string">'yii'</span>, <span class="string">'Invalid data received for parameter "{param}".'</span>, [<span class="string">'param'</span> =&gt; $name])</span><br><span class="line">                );</span><br><span class="line">            }</span><br><span class="line">            $args[] = $actionParams[$name] = $params[$name];</span><br><span class="line">            <span class="keyword">unset</span>($params[$name]);</span><br><span class="line">        } <span class="keyword">elseif</span> (PHP_VERSION_ID &gt;= <span class="number">70100</span> &amp;&amp; ($type = $param-&gt;getType()) !== <span class="keyword">null</span> &amp;&amp; !$type-&gt;isBuiltin()) {</span><br><span class="line">            <span class="comment">// !$type-&gt;isBuiltin() 不是内建类型</span></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">$this</span>-&gt;bindInjectedParams($type, $name, $args, $requestedParams);</span><br><span class="line">            } <span class="keyword">catch</span> (HttpException $e) {</span><br><span class="line">                <span class="keyword">throw</span> $e;</span><br><span class="line">            } <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ServerErrorHttpException($e-&gt;getMessage(), <span class="number">0</span>, $e);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">elseif</span> ($param-&gt;isDefaultValueAvailable()) {</span><br><span class="line">            $args[] = $actionParams[$name] = $param-&gt;getDefaultValue();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            $missing[] = $name;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($missing)) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BadRequestHttpException(</span><br><span class="line">            Yii::t(<span class="string">'yii'</span>, <span class="string">'Missing required parameters: {params}'</span>, [<span class="string">'params'</span> =&gt; implode(<span class="string">', '</span>, $missing)])</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">$this</span>-&gt;actionParams = $actionParams;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We use a different array here, specifically one that doesn't contain service instances but descriptions instead.</span></span><br><span class="line">    <span class="keyword">if</span> (Yii::$app-&gt;requestedParams === <span class="keyword">null</span>) {</span><br><span class="line">        Yii::$app-&gt;requestedParams = array_merge($actionParams, $requestedParams);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $args;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="yii-console-Controller"><a href="#yii-console-Controller" class="headerlink" title="yii\console\Controller"></a>yii\console\Controller</h2><p><code>yii &lt;route&gt; [--param1=value1 --param2 ...]</code></p><p>属性：</p><ul><li>@property-read string $help</li><li>@property-read string $helpSummary</li><li>@property-read array $passedOptionValues 与传递的选项对应的属性。</li><li>@property-read array $passedOptions 执行期间传递的选项的名称。</li><li>public $interactive = true; 是否以交互方式运行命令。</li><li>public $silentExitOnException; 如果为真 - 脚本以 <code>ExitCode::OK</code> 结束，以防出现异常。Default: <code>YII_ENV_TEST</code>.</li></ul><p>方法：</p><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 使用指定的操作 ID 和参数运行操作。</span></span><br><span class="line"><span class="comment">  * 如果动作 ID 为空，该方法将使用 [[defaultAction]]。</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> string $id the ID of the action to be executed.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> array $params the parameters (name-value pairs) to be passed to the action.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> int the status of the action execution. 0 means normal, other values mean abnormal.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> InvalidRouteException if the requested action ID cannot be resolved into an action successfully.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> Exception if there are unknown options or missing arguments</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> createAction</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">runAction</span><span class="params">($id, $params = [])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($params)) {</span><br><span class="line">        <span class="comment">// 在此处填充选项，以便它们在 beforeAction() 中可用。</span></span><br><span class="line">        $options = <span class="keyword">$this</span>-&gt;options($id === <span class="string">''</span> ? <span class="keyword">$this</span>-&gt;defaultAction : $id);</span><br><span class="line">        <span class="comment">// 是否设置了别名</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($params[<span class="string">'_aliases'</span>])) {</span><br><span class="line">            $optionAliases = <span class="keyword">$this</span>-&gt;optionAliases();</span><br><span class="line">            <span class="keyword">foreach</span> ($params[<span class="string">'_aliases'</span>] <span class="keyword">as</span> $name =&gt; $value) {</span><br><span class="line">                <span class="keyword">if</span> (array_key_exists($name, $optionAliases)) {</span><br><span class="line">                    $params[$optionAliases[$name]] = $value;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    $message = Yii::t(<span class="string">'yii'</span>, <span class="string">'Unknown alias: -{name}'</span>, [<span class="string">'name'</span> =&gt; $name]);</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="keyword">empty</span>($optionAliases)) {</span><br><span class="line">                        $aliasesAvailable = [];</span><br><span class="line">                        <span class="keyword">foreach</span> ($optionAliases <span class="keyword">as</span> $alias =&gt; $option) {</span><br><span class="line">                            $aliasesAvailable[] = <span class="string">'-'</span> . $alias . <span class="string">' (--'</span> . $option . <span class="string">')'</span>;</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        $message .= <span class="string">'. '</span> . Yii::t(<span class="string">'yii'</span>, <span class="string">'Aliases available: {aliases}'</span>, [</span><br><span class="line">                            <span class="string">'aliases'</span> =&gt; implode(<span class="string">', '</span>, $aliasesAvailable)</span><br><span class="line">                        ]);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>($message);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">unset</span>($params[<span class="string">'_aliases'</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 遍历参数</span></span><br><span class="line">        <span class="keyword">foreach</span> ($params <span class="keyword">as</span> $name =&gt; $value) {</span><br><span class="line">            <span class="comment">// 允许在 kebab-case 中输入 camelCase 选项</span></span><br><span class="line">            <span class="keyword">if</span> (!in_array($name, $options, <span class="keyword">true</span>) &amp;&amp; strpos($name, <span class="string">'-'</span>) !== <span class="keyword">false</span>) {</span><br><span class="line">                $kebabName = $name;</span><br><span class="line">                $altName = lcfirst(Inflector::id2camel($kebabName));</span><br><span class="line">                <span class="keyword">if</span> (in_array($altName, $options, <span class="keyword">true</span>)) {</span><br><span class="line">                    $name = $altName;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($name, $options, <span class="keyword">true</span>)) {</span><br><span class="line">                $default = <span class="keyword">$this</span>-&gt;$name;</span><br><span class="line">                <span class="keyword">if</span> (is_array($default) &amp;&amp; is_string($value)) {</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;$name = preg_split(<span class="string">'/\s*,\s*(?![^()]*\))/'</span>, $value);</span><br><span class="line">                } <span class="keyword">elseif</span> ($default !== <span class="keyword">null</span>) {</span><br><span class="line">                    settype($value, gettype($default));</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;$name = $value;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;$name = $value;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">$this</span>-&gt;_passedOptions[] = $name;</span><br><span class="line">                <span class="keyword">unset</span>($params[$name]);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>($kebabName)) {</span><br><span class="line">                    <span class="keyword">unset</span>($params[$kebabName]);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">elseif</span> (!is_int($name)) {</span><br><span class="line">                $message = Yii::t(<span class="string">'yii'</span>, <span class="string">'Unknown option: --{name}'</span>, [<span class="string">'name'</span> =&gt; $name]);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($options)) {</span><br><span class="line">                    $message .= <span class="string">'. '</span> . Yii::t(<span class="string">'yii'</span>, <span class="string">'Options available: {options}'</span>, [<span class="string">'options'</span> =&gt; <span class="string">'--'</span> . implode(<span class="string">', --'</span>, $options)]);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>($message);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;help) {</span><br><span class="line">        <span class="comment">// 没有参数 &amp; 开启帮助时执行到</span></span><br><span class="line">        <span class="comment">// yii\console\controllers\HelpController</span></span><br><span class="line">        $route = <span class="keyword">$this</span>-&gt;getUniqueId() . <span class="string">'/'</span> . $id;</span><br><span class="line">        <span class="keyword">return</span> Yii::$app-&gt;runAction(<span class="string">'help'</span>, [$route]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">parent</span>::runAction($id, $params);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="yii-rest-Controller"><a href="#yii-rest-Controller" class="headerlink" title="yii\rest\Controller"></a>yii\rest\Controller</h2><ol><li>Resolving response format (see <code>ContentNegotiator</code>);</li><li>Validating request method (see <code>verbs()</code>).</li><li>Authenticating user (see <code>\yii\filters\auth\AuthInterface</code>);</li><li>Rate limiting (see <code>RateLimiter</code>);</li><li>Formatting response data (see <code>serializeData()</code>).</li></ol><p>– EOF –</p></article><ul class="tags-postTags"><li><a href="/tags/php/" rel="tag"># php</a></li></ul></div></div></div><nav id="gobottom" class="pagination"><a class="prev-post" title="Yii2 源码阅读 08 - Action" href="/2021/11/26/reading-yii2-source-code-08/">← Yii2 源码阅读 08 - Action </a><span class="prev-next-post">·</span> <a class="next-post" title="PHP 安装 gRPC" href="/2021/10/13/php-install-grpc/">PHP 安装 gRPC →</a></nav></div><div class="toc-bar"><div class="toc-btn-bar"><a href="#site-main" class="toc-btn"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M793.024 710.272a32 32 0 1 0 45.952-44.544l-310.304-320a32 32 0 0 0-46.4 0.48l-297.696 320a32 32 0 0 0 46.848 43.584l274.752-295.328 286.848 295.808z"></path></svg></a><div class="toc-btn toc-switch"><svg class="toc-open" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M779.776 480h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M779.776 672h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M256 288a32 32 0 1 0 0 64 32 32 0 0 0 0-64M392.576 352h387.2a32 32 0 0 0 0-64h-387.2a32 32 0 0 0 0 64M256 480a32 32 0 1 0 0 64 32 32 0 0 0 0-64M256 672a32 32 0 1 0 0 64 32 32 0 0 0 0-64"></path></svg> <svg class="toc-close hide" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 960c-247.039484 0-448-200.960516-448-448S264.960516 64 512 64 960 264.960516 960 512 759.039484 960 512 960zM512 128.287273c-211.584464 0-383.712727 172.128262-383.712727 383.712727 0 211.551781 172.128262 383.712727 383.712727 383.712727 211.551781 0 383.712727-172.159226 383.712727-383.712727C895.712727 300.415536 723.551781 128.287273 512 128.287273z"></path><path d="M557.05545 513.376159l138.367639-136.864185c12.576374-12.416396 12.672705-32.671738 0.25631-45.248112s-32.704421-12.672705-45.248112-0.25631l-138.560301 137.024163-136.447897-136.864185c-12.512727-12.512727-32.735385-12.576374-45.248112-0.063647-12.512727 12.480043-12.54369 32.735385-0.063647 45.248112l136.255235 136.671523-137.376804 135.904314c-12.576374 12.447359-12.672705 32.671738-0.25631 45.248112 6.271845 6.335493 14.496116 9.504099 22.751351 9.504099 8.12794 0 16.25588-3.103239 22.496761-9.247789l137.567746-136.064292 138.687596 139.136568c6.240882 6.271845 14.432469 9.407768 22.65674 9.407768 8.191587 0 16.352211-3.135923 22.591372-9.34412 12.512727-12.480043 12.54369-32.704421 0.063647-45.248112L557.05545 513.376159z"></path></svg></div><a href="#gobottom" class="toc-btn"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M231.424 346.208a32 32 0 0 0-46.848 43.584l297.696 320a32 32 0 0 0 46.4 0.48l310.304-320a32 32 0 1 0-45.952-44.544l-286.848 295.808-274.752-295.36z"></path></svg></a></div><div class="toc-main"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#yii-base-Controller"><span class="toc-text">yii\base\Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yii-web-Controller"><span class="toc-text">yii\web\Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yii-console-Controller"><span class="toc-text">yii\console\Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yii-rest-Controller"><span class="toc-text">yii\rest\Controller</span></a></li></ol></div></div><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div><aside class="read-next outer"><div class="inner"><div class="read-next-feed"><article class="read-next-card" style="background-image:url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"><header class="read-next-card-header"><small class="read-next-card-header-sitetitle">— 全力以赴 —</small><h3 class="read-next-card-header-title">Recent Posts</h3></header><div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"></path></svg></div><div class="read-next-card-content"><ul><li><a href="/2022/08/14/mysql-course-45-reading-notes/">《MySQL 实战 45 讲》笔记</a></li><li><a href="/2022/07/28/shell-code-snippet/">Shell Code Snippet</a></li><li><a href="/2022/07/26/front-end-code-snippet/">Front-end Code Snippet</a></li></ul></div><footer class="read-next-card-footer"><a href="/archives">MORE →</a></footer></article><article class="read-next-card" style="background-image:url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"><header class="read-next-card-header tagcloud-card"><h3 class="read-next-card-header-title">Categories</h3></header><div class="read-next-card-content"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/code-snippet/">code-snippet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/report/">report</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/yii2/">yii2</a></li></ul></div></article><article class="read-next-card" style="background-image:url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"><header class="read-next-card-header tagcloud-card"><h3 class="read-next-card-header-title">Tag Cloud</h3></header><div class="read-next-card-content-ext"><a href="/tags/algorithm/" style="font-size:18.62px">algorithm</a> <a href="/tags/aws/" style="font-size:14px">aws</a> <a href="/tags/centos/" style="font-size:14.77px">centos</a> <a href="/tags/composer/" style="font-size:15.54px">composer</a> <a href="/tags/css/" style="font-size:17.08px">css</a> <a href="/tags/design-patterns/" style="font-size:14.77px">design-patterns</a> <a href="/tags/docker/" style="font-size:14px">docker</a> <a href="/tags/git/" style="font-size:23.23px">git</a> <a href="/tags/github/" style="font-size:15.54px">github</a> <a href="/tags/hexo/" style="font-size:15.54px">hexo</a> <a href="/tags/hive/" style="font-size:14px">hive</a> <a href="/tags/html/" style="font-size:16.31px">html</a> <a href="/tags/ios/" style="font-size:20.15px">ios</a> <a href="/tags/java/" style="font-size:20.92px">java</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/js/" style="font-size:14px">js</a> <a href="/tags/leetcode/" style="font-size:22.46px">leetcode</a> <a href="/tags/linux/" style="font-size:17.08px">linux</a> <a href="/tags/mac/" style="font-size:17.08px">mac</a> <a href="/tags/movie/" style="font-size:14px">movie</a> <a href="/tags/mysql/" style="font-size:21.69px">mysql</a> <a href="/tags/nginx/" style="font-size:17.85px">nginx</a> <a href="/tags/node-js/" style="font-size:14.77px">node-js</a> <a href="/tags/npm/" style="font-size:14px">npm</a> <a href="/tags/photoshop/" style="font-size:14px">photoshop</a> <a href="/tags/php/" style="font-size:24px">php</a> <a href="/tags/phpstorm/" style="font-size:14.77px">phpstorm</a> <a href="/tags/pr/" style="font-size:14px">pr</a> <a href="/tags/react/" style="font-size:16.31px">react</a> <a href="/tags/react-native/" style="font-size:14px">react-native</a> <a href="/tags/reading-notes/" style="font-size:17.85px">reading-notes</a> <a href="/tags/redis/" style="font-size:14px">redis</a> <a href="/tags/sql/" style="font-size:14px">sql</a> <a href="/tags/ssh/" style="font-size:14.77px">ssh</a> <a href="/tags/swift/" style="font-size:19.38px">swift</a> <a href="/tags/swoft/" style="font-size:14px">swoft</a> <a href="/tags/thinking/" style="font-size:14px">thinking</a> <a href="/tags/ubuntu/" style="font-size:18.62px">ubuntu</a> <a href="/tags/vim/" style="font-size:14px">vim</a> <a href="/tags/vscode/" style="font-size:14px">vscode</a> <a href="/tags/vue/" style="font-size:14.77px">vue</a> <a href="/tags/xcode/" style="font-size:14px">xcode</a> <a href="/tags/yii2/" style="font-size:14.77px">yii2</a></div></article></div></div></aside><div id="search" class="search-overlay"><div class="search-form"><input id="local-search-input" class="search-input" type="text" name="search" placeholder="Search ..."> <a class="search-overlay-close" href="#"></a></div><div id="local-search-result"></div></div><footer class="site-footer outer"><div class="site-footer-content inner"><div class="copyright"><a href="/" title="全力以赴">全力以赴 · 永远热泪盈眶 © 2022</a></div><nav class="site-footer-nav"><a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> <a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a></nav></div></footer><script data-ad-client="ca-pub-2330747317815601" async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>window.navigator&&navigator.serviceWorker&&navigator.serviceWorker.getRegistrations().then(function(r){for(var e of r)e.unregister()})</script><script id="scriptLoad" src="/js/allinone.min.js" async=""></script><script>document.getElementById("scriptLoad").addEventListener("load",function(){new Blazy;searchFunc("/")})</script><link rel="stylesheet" href="/photoswipe/photoswipe.css"><link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css"><script src="/photoswipe/photoswipe.min.js"></script><script src="/photoswipe/photoswipe-ui-default.min.js"></script></body></html>