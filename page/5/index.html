<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.146.7"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ZYF.IM BLOG</title>
<meta name=keywords content="ZYF,ZYF.IM,Blog,Portfolio,PaperMod"><meta name=description content="Code. Create. Conquer."><meta name=author content="Me"><link rel=canonical href=https://zyf.im/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://zyf.im/index.xml><link rel=alternate type=application/json href=https://zyf.im/index.json><link rel=alternate hreflang=en href=https://zyf.im/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://zyf.im/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="ZYF.IM BLOG"><meta property="og:description" content="Code. Create. Conquer."><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="ZYF.IM BLOG"><meta name=twitter:description content="Code. Create. Conquer."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"ZYF.IM BLOG","url":"https://zyf.im/","description":"Code. Create. Conquer.","logo":"https://zyf.im/favicon.ico","sameAs":["https://github.com/","https://space.bilibili.com/29991589","/links/"]}</script></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Redis 正则批量删除 key</h2></header><div class=entry-content><p>EVAL "return redis.call('del', 'defaultKey', unpack(redis.call('keys', ARGV[1])))" 0 prefix:* 循环删除：
EVAL "local keys = redis.call('keys', ARGV[1]) \n for i=1,#keys,5000 do \n redis.call('del', unpack(keys, i, math.min(i+4999, #keys))) \n end \n return keys" 0 prefix:* References How to atomically delete keys matching a pattern using Redis | stackoverflow – EOF –</p></div><footer class=entry-footer><span title='2020-08-17 19:34:29 +0000 UTC'>August 17, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;48 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Redis 正则批量删除 key" href=https://zyf.im/2020/08/17/redis-matching-a-pattern-delete-keys/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>MySQL JSON 数据类型</h2></header><div class=entry-content><p>The JSON Data Type | mysql
As of MySQL 5.7.8, MySQL supports a native JSON data type
JSON Function Reference | mysql
A JSON column cannot have a non-NULL default value.
索引 设置虚拟列 -> 虚拟列建立索引
在 MySQL 5.7 中，支持两种 Generated Column，即 Virtual Generated Column 和 Stored Generated Column，前者只将 Generated Column 保存在数据字典中（表的元数据），并不会将这一列数据持久化到磁盘上；后者会将 Generated Column 持久化到磁盘上，而不是每次读取的时候计算所得。很明显，后者存放了可以通过已有数据计算而得的数据，需要更多的磁盘空间，与 Virtual Column 相比并没有优势，因此，MySQL 5.7 中，不指定 Generated Column 的类型，默认是 Virtual Column。
如果需要 Stored Generated Golumn 的话，可能在 Virtual Generated Column 上建立索引更加合适，一般情况下，都使用 Virtual Generated Column，这也是 MySQL 默认的方式。
...</p></div><footer class=entry-footer><span title='2020-08-14 19:39:55 +0000 UTC'>August 14, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;160 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to MySQL JSON 数据类型" href=https://zyf.im/2020/08/14/mysql-json-data-type/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Composer vendor 提交至 Git</h2></header><div class=entry-content><p>应该将 vendor 提交到 Git 吗 一般建议是 不。vendor 目录应添加到 .gitignore。
最佳实践是让所有开发人员使用 Composer 来安装依赖项。类似地，构建服务器、CI、部署工具等都应该作为项目启动的一部分来运行 Composer。
虽然在某些环境下这样做很诱人，但也会导致一些问题：
大型 VCS 存储库的大小和更新代码时的差异。 在你自己的 VCS 复制你所有依赖的历史。 将通过 git 安装的依赖项添加到 git repo 中将显示为 submodules。这是有问题的，因为它们不是真正的 submodules，您将会遇到问题。 如果你真的觉得你必须这样做，你有几个选择：
限制自己安装带标记的版本（没有 dev 版本），这样就只能安装压缩版，并避免与 git submodules 有关的问题。 Use --prefer-dist or set preferred-install to dist in your config. Remove the .git directory of every dependency after the installation, then you can add them to your git repo. You can do that with rm -rf vendor/\*\*/.git in ZSH or find vendor/ -type d -name ".git" -exec rm -rf {} \; in Bash. 但这意味着您必须在运行 composer 更新之前从磁盘中删除这些依赖项。 Add a .gitignore rule /vendor/**/.git to ignore all the vendor .git folders. 这种方法不需要在运行编写器更新之前从磁盘删除依赖项。 我的做法 问题解决了，但是不确信做法是否正确。
...</p></div><footer class=entry-footer><span title='2020-08-10 14:24:47 +0000 UTC'>August 10, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;142 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Composer vendor 提交至 Git" href=https://zyf.im/2020/08/10/commit-composer-vendor-to-git/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>tcpdump 入门使用</h2></header><div class=entry-content><p>tcpdump 是 Unix/Linux 下的抓包工具，可以针对指定网卡、端口、协议进行抓包。
字太多不看 sudo tcpdump host api.test and tcp port 80 -A -nn sudo tcpdump dst api.test and tcp port 80 -A 一举成名天下知 man tcpdump 获取适配器列表 tcpdump -D tcpdump --list-interfaces 1.en0 [Up, Running] 2.p2p0 [Up, Running] 3.awdl0 [Up, Running] 4.llw0 [Up, Running] 5.utun0 [Up, Running] 6.utun1 [Up, Running] 7.utun2 [Up, Running] 8.en5 [Up, Running] 9.lo0 [Up, Running, Loopback] 10.bridge0 [Up, Running] 11.en1 [Up, Running] 12.en2 [Up, Running] 13.en3 [Up, Running] 14.en4 [Up, Running] 15.gif0 [none] 16.stf0 [none] 17.XHC0 [none] 18.XHC1 [none] 19.ap1 [none] 20.XHC20 [none] 21.VHC128 [none] 监听适配器 Listen on interface.
...</p></div><footer class=entry-footer><span title='2020-06-29 10:24:16 +0000 UTC'>June 29, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;639 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to tcpdump 入门使用" href=https://zyf.im/2020/06/29/tcpdump-getting-started/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>配置 Laradock PhpStorm Xdubug</h2></header><div class=entry-content><p>最近在学习 Yii2 的源码，为了方便调试所以研究下 Laradock + PhpStorm + Xdubug 的配置。
环境 macOS Laradock v10.0 请保证 Laradock 是最新的版本，可以减少不必要的麻烦。也推荐使用我精简过的项目 imzyf/my-dock | github。
配置 Laradock vim .env WORKSPACE_INSTALL_XDEBUG=true PHP_FPM_INSTALL_XDEBUG=true 重新编译 php-fpm 和 workspace 容器：
docker-compose build php-fpm workspace 配置 PhpStorm 配置 Docker Preferences > Build, Execution, Deploymnent > Docker
配置 PHP Preferences > Languages & Frameworks > PHP，PHP CLI Interpreter 点 ...
点击 +，选择 From Docker, Vagrant…
...</p></div><footer class=entry-footer><span title='2020-05-26 09:45:15 +0000 UTC'>May 26, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;137 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to 配置 Laradock PhpStorm Xdubug" href=https://zyf.im/2020/05/26/config-laradock-phpstorm-xdubug/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>PHP float 精度</h2></header><div class=entry-content><p>实例 1 $a = 1.1; var_dump(gettype($a)); // string(6) "double" var_dump($a); // float(1.1) 实例 2 $a = "123456789.1100110011"; $a = (float) $a; var_dump($a); // float(123456789.11001) var_dump(sprintf('%.11f', $a)); // string(21) "123456789.11001099646" $b = 123456789.11001; var_dump($b); // float(123456789.11001) var_dump(sprintf('%.11f', $b)); // string(21) "123456789.11000999808" $c = '123456789.1100110011'; $c = (float) $c; var_dump($c); // float(123456789.11001) $c = (string) $c; var_dump($c); // string(15) "123456789.11001" $c = (float) $c; var_dump($c); // float(123456789.11001) var_dump(sprintf('%.11f', $c)); // string(21) "123456789.11000999808" var_dump($a === $b); // bool(false) - 说明 $a 还是携带着 float 的精度 var_dump($b === $c); // bool(true) 实例 3 // # 1 var_dump(120085 === 1200.85 * 100); // bool(false) // # 2 var_dump(120085 == 1200.85 * 100); // bool(false) // # 3 var_dump(120081 == 1200.81 * 100); // bool(true) // # 4 var_dump(120085 - 1200.85 * 100); // float(1.4551915228367E-11) 实例 4 $a = 0.1; $b = 0.9; $c = 1; var_dump(($a + $b) == $c); // bool(true) var_dump(($c - $b) == $a); // bool(false) var_dump(sprintf('%.20f', $a + $b)); // string(22) "1.00000000000000000000" var_dump(sprintf('%.20f', $c - $b)); // string(22) "0.09999999999999997780" var_dump((0.5 - 0.25) === 0.25); // bool(true) 0.5 二进制 0.1，0.25 二进制 0.01 var_dump((0.25 + 0.25) === 0.5); // bool(true) 实例 5 $n = 19.99; dump($n * 100); // 1999.0 dump((int) ($n * 100)); // 1998 !!! dump((string) ($n * 100)); // "1999" dump((int) (string) ($n * 100)); // 1999 dump(round($n * 100)); // 1999.0 !!! dump((int) round($n * 100)); // 1999 分析 看文档：
...</p></div><footer class=entry-footer><span title='2020-05-09 17:32:34 +0000 UTC'>May 9, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;428 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to PHP float 精度" href=https://zyf.im/2020/05/09/php-float-precision/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>vim Code Snippet</h2></header><div class=entry-content><p>常用 全选（高亮显示）：按 esc 后，然后 ggvG 或者 ggVG 全部复制：按 esc 后，然后 ggyG 全部删除：按 esc 后，然后 dG 粘贴到终端 vim 缩进错乱 https://stackoverflow.com/questions/2514445/turning-off-auto-indent-when-pasting-text-into-vim/38258720#38258720
在 vim 中粘贴前先输入：
:set paste 原因：在终端的 vim 中没有相应的程序来处理这个从其他应用复制粘贴的过程，所以 vim 通过插入键盘输入的 buffer 来模拟这个粘贴的过程，这个时候 vim 会以为这是用户输入的。
问题就是出在这：当上一行结束，光标进入下一行时 vim 会自动以上一行的的缩进为初始位置。这样就会破坏原始文件的缩进。
基础命令 gg 是让光标移到首行，在 vim 才有效，vi 中无效 G 光标移到最后一行 d 删除选中内容 y 复制选中内容到 0 号寄存器 References vim 全选，全部复制，全部删除 | cnblogs 用 vim 打开后中文乱码怎么办？ | zhihu – EOF –</p></div><footer class=entry-footer><span title='2020-04-28 10:43:39 +0000 UTC'>April 28, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;63 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to vim Code Snippet" href=https://zyf.im/2020/04/28/vim-code-snippet/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>PHP GD 入门使用</h2></header><div class=entry-content><p>GD 安装、配置 考虑到功能需要使用字体库、图像格式 jpeg\png 所以先安装相关库。
字体库 FreeType 2 https://www.freetype.org/
# 在临时目录进行操作 cd /tmp # https://download.savannah.gnu.org/releases/freetype/ wget http://download.savannah.gnu.org/releases/freetype/freetype-2.10.1.tar.gz tar zxvf freetype-2.10.1.tar.gz cd freetype-2.10.1 ./configure --prefix=/usr/local/freetype && make && make install 图像格式 jpeg cd /tmp # http://www.ijg.org/ wget http://www.ijg.org/files/jpegsrc.v9d.tar.gz tar zxvf jpegsrc.v9.tar.gz cd jpeg-9/ ./configure --prefix=/usr/local/jpeg && make && make install 图像格式 png cd /tmp # http://www.libpng.org/pub/png/libpng.html wget https://download.sourceforge.net/libpng/libpng-1.6.37.tar.gz --no-check-certificate tar zxvf libpng-1.6.37.tar.gz cd libpng-1.6.37 ./configure --prefix=/usr/local/libpng && make && make install 安装 GD ...</p></div><footer class=entry-footer><span title='2020-04-16 17:24:37 +0000 UTC'>April 16, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;212 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to PHP GD 入门使用" href=https://zyf.im/2020/04/16/php-gd-getting-started/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>PHP Code Snippet</h2></header><div class=entry-content><p>PHP Sandbox Online PHP editor | 3v4l.org PHP Sandbox | onlinephp.io PHP.net Supported Versions | PHP.net Unsupported Branches | PHP.net References PHP News, Articles, Upcoming Changes, and more | PHP.Watch Laravel illuminate # https://github.com/illuminate/database/blob/master/README.md $capsule = new Capsule(); $capsule->addConnection($this->dbConfig); $capsule->setAsGlobal(); // Setup the Eloquent ORM... (optional; unless you've used setEventDispatcher()) $capsule->bootEloquent(); $capsule->getDatabaseManager()->extend('mongodb', function ($config, $name) { $config['name'] = $name; return new \Jenssegers\Mongodb\Connection($config); }); 参数查看 # 查看 PHP 编译时的参数 php -r "phpinfo();" | grep configure # 查看 .ini 配置文件路径 php --ini php -r "phpinfo();" | grep "Configuration File" # 查看 Modules php -m # 显示扩展配置 php --ri gd # 检查扩展是否存在 php --re decimal # 交互式运行模式。具有函数、常量、类名、变量、静态方法调用和类常量的 `tab` 补全功能 # http://php.net/manual/en/features.commandline.interactive.php php -a 查看、修改内存限制 php -r "echo ini_get('memory_limit');" php -r "phpinfo();" | grep memory memory_limit = 1024M; // 临时设置最大内存占用 ini_set('memory_limit', '1024M'); // 设置脚本最大执行时间为 0 永不过期 set_time_limit(0); Too Many Open Files PHP-FPM Too Many Open Files 24 Error (set open file descriptor limit)
...</p></div><footer class=entry-footer><span title='2020-04-15 18:03:44 +0000 UTC'>April 15, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;499 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to PHP Code Snippet" href=https://zyf.im/2020/04/15/php-code-snippet/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>MySQL Illegal mix of collations</h2></header><div class=entry-content><p>Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation utf8mb4_unicode_ci 和 utf8_general_ci 列不能混合查询
解决方法 1 统一字段 varchar 的编码集，我推荐使用 utf8mb4_unicode_ci。
解决方法 2 在查询 SQL 中需要转化的字段后面加 COLLATE utf8mb4_unicode_ci.
对比 准确性：
utf8mb4_unicode_ci 是基于标准的 Unicode 来排序和比较，能够在各种语言之间精确排序。 utf8mb4_general_ci 没有实现 Unicode 排序规则，在遇到某些特殊语言或者字符集，排序结果可能不一致。 性能：
utf8mb4_unicode_ci 在特殊情况下，Unicode 排序规则为了能够处理特殊字符的情况，实现了略微复杂的排序算法。但是在绝大多数情况下发，不会发生此类复杂比较。相比选择哪一 collation，使用者更应该关心字符集与排序规则在 db 里需要统一。 utf8mb4_general_ci 在比较和排序的时候更快。 utf8mb4 mb4 是 most bytes 4 的意思，专门用来兼容四字节的 unicode。
References Illegal mix of collations | 少年阿斌 – EOF –</p></div><footer class=entry-footer><span title='2020-04-14 17:05:01 +0000 UTC'>April 14, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;63 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to MySQL Illegal mix of collations" href=https://zyf.im/2020/04/14/mysql-illegal-mix-of-collations/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://zyf.im/page/4/>«&nbsp;Prev&nbsp;
</a><a class=next href=https://zyf.im/page/6/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>