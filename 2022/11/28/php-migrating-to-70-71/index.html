<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PHP Migrating to 7.0 7.1 | ZYF.IM BLOG</title>
<meta name=keywords content="php"><meta name=description content="
实验环境：https://onlinephp.io/
Polyfill https://github.com/symfony/polyfill/tree/main/src

PHP7.0 to PHP7.1

https://www.php.net/manual/en/migration71.php
7.1 New Features
// Nullable types 可为空类型
function test(?string $name): ?string
// Void 函数
function swap(&$left, &$right) : void
// 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告
// 对称数组解构
$data = [
    [1, 'Tom'],
    [2, 'Fred'],
];
[$id, $name] = $data[0];
// 赋值部分
[, $name1] = $data[1];

foreach ($data as [$id, $name]) {
    // logic here with $id and $name
}

function swap(&$a, &$b): void
{
    [$a, $b] = [$b, $a];
}
// list 支持键名
$data = [
    [&#34;id&#34; => 1, &#34;name&#34; => 'Tom'],
    [&#34;id&#34; => 2, &#34;name&#34; => 'Fred'],
];
foreach ($data as [&#34;name&#34; => $name, &#34;id&#34; => $id]) {
    // logic here with $id and $name
}
// 类常量支持可见性
class ConstDemo
{
    public const PUBLIC_CONST_A = 1;
}
// iterable 伪类（与 callable 类似）
interface Traversable extends iterable {
    // 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口
    // Traversable as part of either Iterator or IteratorAggregate，不能直接实现
}

function iterator(iterable $iter)
{
    foreach ($iter as $val) {
        // ...
    }
}
// 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获
try {
    // some code
} catch (FirstException | SecondException $e) {
    // handle first and second exceptions
}
// 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量
// 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量
// 中文操作要小心
var_dump(&#34;abcdef&#34;[-2]); // e
var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;)); // 2
var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;, -3)); // 3
// 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象
// public static Closure::fromCallable(callable $callback): Closure
class Test
{
    public function exposeFunction()
    {
        return Closure::fromCallable([$this, 'privateFunction']);
    }
    private function privateFunction($param)
    {
        var_dump($param);
    }
}

$privFunc = (new Test)->exposeFunction();
$privFunc('some value');
// string(10) &#34;some value&#34;
7.1 New Functions
// 否为可迭代
is_iterable()
7.1 Backward Incompatible Changes
// 当传递参数过少时将抛出错误
function test($param){}
test();
/*
PHP71
Fatal error: Uncaught ArgumentCountError: Too few arguments to function test()

PHP70
Warning: Missing argument 1 for test()
*/
// 禁止动态调用作用域自检函数
// $func() or array_map('extract', ...)
// function array_map($callback, array $array, array ...$arrays): array
(function () {
    $func = 'func_num_args';
    $func();
})();
/*
PHP71
Warning: Cannot call func_num_args() dynamically
*/
// 以下名称不能用于命名 class, interface, trait
// - void
// - iterable
// 数字字符串转换 遵循科学记数法
var_dump(intval('1e5'));
var_dump(is_numeric('1e5'));
var_dump(is_numeric('e'));
// PHP71             PHP70
// int(100000)       int(1)
// bool(true)        bool(true)
// bool(false)       bool(false)
// call_user_func() 不再支持对传址的函数的调用
error_reporting(E_ALL);
function increment(&$var)
{
    $var++;
}

$a = 0;
call_user_func('increment', $a); // ...expected to be a reference, value given
call_user_func_array('increment', [&$a]); // 1
$increment = 'increment';
$increment($a); // 2
// 字符串不再支持空索引运算符
$str = &#34;&#34;;
$str[] = &#34;abc&#34;;
var_dump($str);
// PHP71 Fatal error: Uncaught Error: [] operator not supported for strings
// PHP70 array(1) {
//   [0]=>
//   string(3) &#34;abc&#34;
// }

$a = &#34;&#34;;
$a[0] = &#34;hello world&#34;;
var_dump($a);
// PHP71 string(1) &#34;h&#34;
// PHP70 array(1) {
//   [0]=>
//   string(11) &#34;hello world&#34;
// }
// 通过空字符串上的字符串索引访问赋值
$str = '';
$str[10] = 'foo';
var_dump($str);
// PHP71 string(11) &#34;          f&#34;
// PHP70 array(1) {
//   [10]=>
//   string(3) &#34;foo&#34;
// }
// 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。
$array = [];
$array['a'] = &$array['b'];
$array['b'] = 1;
var_dump($array);
// PHP71 array(2) {
//   [&#34;b&#34;]=>
//   &amp;int(1)
//   [&#34;a&#34;]=>
//   &amp;int(1)
// }
// PHP70 array(2) {
//   [&#34;a&#34;]=>
//   &amp;int(1)
//   [&#34;b&#34;]=>
//   &amp;int(1)
// }
// 词法绑定变量不能重用名称，以下都将 fatal error
$f = function () use ($_SERVER) {}; // any superglobals
$f = function () use ($this) {};
$f = function ($param) use ($param) {};
// 禁止 &#34;return;&#34; 对于已经在编译时键入的返回值
function test(int $i): array
{
    $i += 1;
    return;
}
// PHP Compile Error A function with return type must return a value
var_dump('1b' + 'something');
// PHP71
// Notice: A non well formed numeric value encountered
// Warning: A non-numeric value encountered
// int(1)
// PHP70 int(1)
PHP5.6 to PHP7.0

https://www.php.net/manual/en/migration70.php

Backward incompatible changes
// 错误和异常处理相关的变更
// set_exception_handler() 不再保证收到的一定是 Exception 对象
function handler(Exception $e) { ... }
set_exception_handler('handler');

// 兼容 PHP 5 和 7
function handler($e) { ... }

// 仅支持 PHP 7
function handler(Throwable $e) { ... }

// 当内部构造器失败的时候，总是抛出异常
// 间接调用的表达式的新旧解析顺序
// 现在严格遵循从左到右的顺序来解析
// 表达式               PHP 5 的解析方式           PHP 7 的解析方式
$$foo['bar']['baz']    ${$foo['bar']['baz']}    ($$foo)['bar']['baz']
$foo->$bar['baz']      $foo->{$bar['baz']}      ($foo->$bar)['baz']
// foreach 通过值遍历时，操作的值为数组的副本
$array = [0];
foreach ($array as $val) {
    var_dump($val);
    $array[1] = 1;
}
// int(0)

// foreach通过引用遍历时，有更好的迭代特性
$array = [0];
foreach ($array as &$val) {
    var_dump($val);
    $array[1] = 1;
}
// PHP 7.0
// int(0)
// int(1)

// PHP 5.6
// int(0)
// call_user_method() and call_user_method_array() 被移除。
// 应该使用 call_user_func() 和 call_user_func_array()
// 在函数中检视参数值会返回 当前 的值
function foo($x) {
    $x++;
    var_dump(func_get_arg(0));
}
foo(1);
// int(2) PHP 7.0
// int(1) PHP 5.6
7.0 New Features
// 标量类型声明
// 返回值类型声明
function arraysSum(array ...$arrays): array
{
    return array_map(function(array $array): int {
        return array_sum($array);
    }, $arrays);
}
// null 合并运算符，对 isset() 的简化
$username = $_GET['user'] ?? 'nobody';

// 太空船操作符（组合比较符）
echo 1 <=> 1; // 0
echo 1 <=> 2; // -1
echo 2 <=> 1; // 1
// 通过 define() 定义 常量数组
define('ANIMALS', [
    'dog',
    'cat',
    'bird'
]);
// 匿名类 用来替代一些“用后即焚”的完整类定义
$app = new Application;
$app->setLogger(new class implements Logger {
    public function log(string $msg) {
        echo $msg;
    }
});
// Unicode codepoint 转译语法
// 这接受一个以 16 进制形式的 Unicode codepoint
echo &#34;\u{9999}&#34;; // 香
// Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它
// PHP 7 之前版本的代码
$getXCB = function() {return $this->x;};
// function bindTo($newThis, $newScope = 'static') { }
// $newScope 将闭包关联到的类作用域
$getX = $getXCB->bindTo(new A, A::class); // 中间层闭包
echo $getX();

// PHP 7+ 及更高版本的代码
$getX = function() {return $this->x;};
echo $getX->call(new A);
// 生成器委托 yield from
function gen()
{
    yield 1;
    yield 2;

    yield from gen2();
}
function gen2()
{
    yield 3;
    yield 4;
}
foreach (gen() as $val)
{
    echo $val, PHP_EOL;
}
// 1
// 2
// 3
// 4
// 柯里化
function add($a) {
  return function($b) use ($a) {
    return $a + $b;
  };
}
$result = add(10)(15);
var_dump($result); // int 25
Deprecated features in PHP 7.0.x
// 构造函数（方法名和类名一样）将被弃用，并在将来移除
class Foo {
    function foo() {
        echo 'I am the constructor';
    }
}
// PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP
// PHP 5.6: OK
Other Changes
// 放宽了保留词限制，以前不能用 'new'、'private' 和 'for'
Project::new('Project Name')->private()->for('purpose here')->with('username here');
// class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class）
New Global Constants
PHP_INT_MIN
&ndash; EOF &ndash;"><meta name=author content="Me"><link rel=canonical href=https://zyf.im/2022/11/28/php-migrating-to-70-71/><link crossorigin=anonymous href=/assets/css/stylesheet.eb010ba19da259e1633d31a246087e3b0656d556c30406763ea24160333d238f.css integrity="sha256-6wELoZ2iWeFjPTGiRgh+OwZW1VbDBAZ2PqJBYDM9I48=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zyf.im/2022/11/28/php-migrating-to-70-71/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6DVZ6E58DG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6DVZ6E58DG")}</script><meta property="og:url" content="https://zyf.im/2022/11/28/php-migrating-to-70-71/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="PHP Migrating to 7.0 7.1"><meta property="og:description" content=" 实验环境：https://onlinephp.io/ Polyfill https://github.com/symfony/polyfill/tree/main/src PHP7.0 to PHP7.1 https://www.php.net/manual/en/migration71.php
7.1 New Features // Nullable types 可为空类型 function test(?string $name): ?string // Void 函数 function swap(&$left, &$right) : void // 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告 // 对称数组解构 $data = [ [1, 'Tom'], [2, 'Fred'], ]; [$id, $name] = $data[0]; // 赋值部分 [, $name1] = $data[1]; foreach ($data as [$id, $name]) { // logic here with $id and $name } function swap(&$a, &$b): void { [$a, $b] = [$b, $a]; } // list 支持键名 $data = [ [&#34;id&#34; => 1, &#34;name&#34; => 'Tom'], [&#34;id&#34; => 2, &#34;name&#34; => 'Fred'], ]; foreach ($data as [&#34;name&#34; => $name, &#34;id&#34; => $id]) { // logic here with $id and $name } // 类常量支持可见性 class ConstDemo { public const PUBLIC_CONST_A = 1; } // iterable 伪类（与 callable 类似） interface Traversable extends iterable { // 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口 // Traversable as part of either Iterator or IteratorAggregate，不能直接实现 } function iterator(iterable $iter) { foreach ($iter as $val) { // ... } } // 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获 try { // some code } catch (FirstException | SecondException $e) { // handle first and second exceptions } // 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量 // 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量 // 中文操作要小心 var_dump(&#34;abcdef&#34;[-2]); // e var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;)); // 2 var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;, -3)); // 3 // 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象 // public static Closure::fromCallable(callable $callback): Closure class Test { public function exposeFunction() { return Closure::fromCallable([$this, 'privateFunction']); } private function privateFunction($param) { var_dump($param); } } $privFunc = (new Test)->exposeFunction(); $privFunc('some value'); // string(10) &#34;some value&#34; 7.1 New Functions // 否为可迭代 is_iterable() 7.1 Backward Incompatible Changes // 当传递参数过少时将抛出错误 function test($param){} test(); /* PHP71 Fatal error: Uncaught ArgumentCountError: Too few arguments to function test() PHP70 Warning: Missing argument 1 for test() */ // 禁止动态调用作用域自检函数 // $func() or array_map('extract', ...) // function array_map($callback, array $array, array ...$arrays): array (function () { $func = 'func_num_args'; $func(); })(); /* PHP71 Warning: Cannot call func_num_args() dynamically */ // 以下名称不能用于命名 class, interface, trait // - void // - iterable // 数字字符串转换 遵循科学记数法 var_dump(intval('1e5')); var_dump(is_numeric('1e5')); var_dump(is_numeric('e')); // PHP71 PHP70 // int(100000) int(1) // bool(true) bool(true) // bool(false) bool(false) // call_user_func() 不再支持对传址的函数的调用 error_reporting(E_ALL); function increment(&$var) { $var++; } $a = 0; call_user_func('increment', $a); // ...expected to be a reference, value given call_user_func_array('increment', [&$a]); // 1 $increment = 'increment'; $increment($a); // 2 // 字符串不再支持空索引运算符 $str = &#34;&#34;; $str[] = &#34;abc&#34;; var_dump($str); // PHP71 Fatal error: Uncaught Error: [] operator not supported for strings // PHP70 array(1) { // [0]=> // string(3) &#34;abc&#34; // } $a = &#34;&#34;; $a[0] = &#34;hello world&#34;; var_dump($a); // PHP71 string(1) &#34;h&#34; // PHP70 array(1) { // [0]=> // string(11) &#34;hello world&#34; // } // 通过空字符串上的字符串索引访问赋值 $str = ''; $str[10] = 'foo'; var_dump($str); // PHP71 string(11) &#34; f&#34; // PHP70 array(1) { // [10]=> // string(3) &#34;foo&#34; // } // 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。 $array = []; $array['a'] = &$array['b']; $array['b'] = 1; var_dump($array); // PHP71 array(2) { // [&#34;b&#34;]=> // &amp;int(1) // [&#34;a&#34;]=> // &amp;int(1) // } // PHP70 array(2) { // [&#34;a&#34;]=> // &amp;int(1) // [&#34;b&#34;]=> // &amp;int(1) // } // 词法绑定变量不能重用名称，以下都将 fatal error $f = function () use ($_SERVER) {}; // any superglobals $f = function () use ($this) {}; $f = function ($param) use ($param) {}; // 禁止 &#34;return;&#34; 对于已经在编译时键入的返回值 function test(int $i): array { $i += 1; return; } // PHP Compile Error A function with return type must return a value var_dump('1b' + 'something'); // PHP71 // Notice: A non well formed numeric value encountered // Warning: A non-numeric value encountered // int(1) // PHP70 int(1) PHP5.6 to PHP7.0 https://www.php.net/manual/en/migration70.php Backward incompatible changes // 错误和异常处理相关的变更 // set_exception_handler() 不再保证收到的一定是 Exception 对象 function handler(Exception $e) { ... } set_exception_handler('handler'); // 兼容 PHP 5 和 7 function handler($e) { ... } // 仅支持 PHP 7 function handler(Throwable $e) { ... } // 当内部构造器失败的时候，总是抛出异常 // 间接调用的表达式的新旧解析顺序 // 现在严格遵循从左到右的顺序来解析 // 表达式 PHP 5 的解析方式 PHP 7 的解析方式 $$foo['bar']['baz'] ${$foo['bar']['baz']} ($$foo)['bar']['baz'] $foo->$bar['baz'] $foo->{$bar['baz']} ($foo->$bar)['baz'] // foreach 通过值遍历时，操作的值为数组的副本 $array = [0]; foreach ($array as $val) { var_dump($val); $array[1] = 1; } // int(0) // foreach通过引用遍历时，有更好的迭代特性 $array = [0]; foreach ($array as &$val) { var_dump($val); $array[1] = 1; } // PHP 7.0 // int(0) // int(1) // PHP 5.6 // int(0) // call_user_method() and call_user_method_array() 被移除。 // 应该使用 call_user_func() 和 call_user_func_array() // 在函数中检视参数值会返回 当前 的值 function foo($x) { $x++; var_dump(func_get_arg(0)); } foo(1); // int(2) PHP 7.0 // int(1) PHP 5.6 7.0 New Features // 标量类型声明 // 返回值类型声明 function arraysSum(array ...$arrays): array { return array_map(function(array $array): int { return array_sum($array); }, $arrays); } // null 合并运算符，对 isset() 的简化 $username = $_GET['user'] ?? 'nobody'; // 太空船操作符（组合比较符） echo 1 <=> 1; // 0 echo 1 <=> 2; // -1 echo 2 <=> 1; // 1 // 通过 define() 定义 常量数组 define('ANIMALS', [ 'dog', 'cat', 'bird' ]); // 匿名类 用来替代一些“用后即焚”的完整类定义 $app = new Application; $app->setLogger(new class implements Logger { public function log(string $msg) { echo $msg; } }); // Unicode codepoint 转译语法 // 这接受一个以 16 进制形式的 Unicode codepoint echo &#34;\u{9999}&#34;; // 香 // Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它 // PHP 7 之前版本的代码 $getXCB = function() {return $this->x;}; // function bindTo($newThis, $newScope = 'static') { } // $newScope 将闭包关联到的类作用域 $getX = $getXCB->bindTo(new A, A::class); // 中间层闭包 echo $getX(); // PHP 7+ 及更高版本的代码 $getX = function() {return $this->x;}; echo $getX->call(new A); // 生成器委托 yield from function gen() { yield 1; yield 2; yield from gen2(); } function gen2() { yield 3; yield 4; } foreach (gen() as $val) { echo $val, PHP_EOL; } // 1 // 2 // 3 // 4 // 柯里化 function add($a) { return function($b) use ($a) { return $a + $b; }; } $result = add(10)(15); var_dump($result); // int 25 Deprecated features in PHP 7.0.x // 构造函数（方法名和类名一样）将被弃用，并在将来移除 class Foo { function foo() { echo 'I am the constructor'; } } // PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP // PHP 5.6: OK Other Changes // 放宽了保留词限制，以前不能用 'new'、'private' 和 'for' Project::new('Project Name')->private()->for('purpose here')->with('username here'); // class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class） New Global Constants PHP_INT_MIN – EOF –"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-28T10:36:34+00:00"><meta property="article:modified_time" content="2022-11-28T10:36:34+00:00"><meta property="article:tag" content="Php"><meta property="og:image" content="https://images.unsplash.com/photo-1531878272632-1fdcf961549e?q=80&amp;w=960&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1531878272632-1fdcf961549e?q=80&amp;w=960&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.0.3"><meta name=twitter:title content="PHP Migrating to 7.0 7.1"><meta name=twitter:description content="
实验环境：https://onlinephp.io/
Polyfill https://github.com/symfony/polyfill/tree/main/src

PHP7.0 to PHP7.1

https://www.php.net/manual/en/migration71.php
7.1 New Features
// Nullable types 可为空类型
function test(?string $name): ?string
// Void 函数
function swap(&$left, &$right) : void
// 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告
// 对称数组解构
$data = [
    [1, 'Tom'],
    [2, 'Fred'],
];
[$id, $name] = $data[0];
// 赋值部分
[, $name1] = $data[1];

foreach ($data as [$id, $name]) {
    // logic here with $id and $name
}

function swap(&$a, &$b): void
{
    [$a, $b] = [$b, $a];
}
// list 支持键名
$data = [
    [&#34;id&#34; => 1, &#34;name&#34; => 'Tom'],
    [&#34;id&#34; => 2, &#34;name&#34; => 'Fred'],
];
foreach ($data as [&#34;name&#34; => $name, &#34;id&#34; => $id]) {
    // logic here with $id and $name
}
// 类常量支持可见性
class ConstDemo
{
    public const PUBLIC_CONST_A = 1;
}
// iterable 伪类（与 callable 类似）
interface Traversable extends iterable {
    // 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口
    // Traversable as part of either Iterator or IteratorAggregate，不能直接实现
}

function iterator(iterable $iter)
{
    foreach ($iter as $val) {
        // ...
    }
}
// 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获
try {
    // some code
} catch (FirstException | SecondException $e) {
    // handle first and second exceptions
}
// 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量
// 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量
// 中文操作要小心
var_dump(&#34;abcdef&#34;[-2]); // e
var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;)); // 2
var_dump(strpos(&#34;aabbcc&#34;, &#34;b&#34;, -3)); // 3
// 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象
// public static Closure::fromCallable(callable $callback): Closure
class Test
{
    public function exposeFunction()
    {
        return Closure::fromCallable([$this, 'privateFunction']);
    }
    private function privateFunction($param)
    {
        var_dump($param);
    }
}

$privFunc = (new Test)->exposeFunction();
$privFunc('some value');
// string(10) &#34;some value&#34;
7.1 New Functions
// 否为可迭代
is_iterable()
7.1 Backward Incompatible Changes
// 当传递参数过少时将抛出错误
function test($param){}
test();
/*
PHP71
Fatal error: Uncaught ArgumentCountError: Too few arguments to function test()

PHP70
Warning: Missing argument 1 for test()
*/
// 禁止动态调用作用域自检函数
// $func() or array_map('extract', ...)
// function array_map($callback, array $array, array ...$arrays): array
(function () {
    $func = 'func_num_args';
    $func();
})();
/*
PHP71
Warning: Cannot call func_num_args() dynamically
*/
// 以下名称不能用于命名 class, interface, trait
// - void
// - iterable
// 数字字符串转换 遵循科学记数法
var_dump(intval('1e5'));
var_dump(is_numeric('1e5'));
var_dump(is_numeric('e'));
// PHP71             PHP70
// int(100000)       int(1)
// bool(true)        bool(true)
// bool(false)       bool(false)
// call_user_func() 不再支持对传址的函数的调用
error_reporting(E_ALL);
function increment(&$var)
{
    $var++;
}

$a = 0;
call_user_func('increment', $a); // ...expected to be a reference, value given
call_user_func_array('increment', [&$a]); // 1
$increment = 'increment';
$increment($a); // 2
// 字符串不再支持空索引运算符
$str = &#34;&#34;;
$str[] = &#34;abc&#34;;
var_dump($str);
// PHP71 Fatal error: Uncaught Error: [] operator not supported for strings
// PHP70 array(1) {
//   [0]=>
//   string(3) &#34;abc&#34;
// }

$a = &#34;&#34;;
$a[0] = &#34;hello world&#34;;
var_dump($a);
// PHP71 string(1) &#34;h&#34;
// PHP70 array(1) {
//   [0]=>
//   string(11) &#34;hello world&#34;
// }
// 通过空字符串上的字符串索引访问赋值
$str = '';
$str[10] = 'foo';
var_dump($str);
// PHP71 string(11) &#34;          f&#34;
// PHP70 array(1) {
//   [10]=>
//   string(3) &#34;foo&#34;
// }
// 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。
$array = [];
$array['a'] = &$array['b'];
$array['b'] = 1;
var_dump($array);
// PHP71 array(2) {
//   [&#34;b&#34;]=>
//   &amp;int(1)
//   [&#34;a&#34;]=>
//   &amp;int(1)
// }
// PHP70 array(2) {
//   [&#34;a&#34;]=>
//   &amp;int(1)
//   [&#34;b&#34;]=>
//   &amp;int(1)
// }
// 词法绑定变量不能重用名称，以下都将 fatal error
$f = function () use ($_SERVER) {}; // any superglobals
$f = function () use ($this) {};
$f = function ($param) use ($param) {};
// 禁止 &#34;return;&#34; 对于已经在编译时键入的返回值
function test(int $i): array
{
    $i += 1;
    return;
}
// PHP Compile Error A function with return type must return a value
var_dump('1b' + 'something');
// PHP71
// Notice: A non well formed numeric value encountered
// Warning: A non-numeric value encountered
// int(1)
// PHP70 int(1)
PHP5.6 to PHP7.0

https://www.php.net/manual/en/migration70.php

Backward incompatible changes
// 错误和异常处理相关的变更
// set_exception_handler() 不再保证收到的一定是 Exception 对象
function handler(Exception $e) { ... }
set_exception_handler('handler');

// 兼容 PHP 5 和 7
function handler($e) { ... }

// 仅支持 PHP 7
function handler(Throwable $e) { ... }

// 当内部构造器失败的时候，总是抛出异常
// 间接调用的表达式的新旧解析顺序
// 现在严格遵循从左到右的顺序来解析
// 表达式               PHP 5 的解析方式           PHP 7 的解析方式
$$foo['bar']['baz']    ${$foo['bar']['baz']}    ($$foo)['bar']['baz']
$foo->$bar['baz']      $foo->{$bar['baz']}      ($foo->$bar)['baz']
// foreach 通过值遍历时，操作的值为数组的副本
$array = [0];
foreach ($array as $val) {
    var_dump($val);
    $array[1] = 1;
}
// int(0)

// foreach通过引用遍历时，有更好的迭代特性
$array = [0];
foreach ($array as &$val) {
    var_dump($val);
    $array[1] = 1;
}
// PHP 7.0
// int(0)
// int(1)

// PHP 5.6
// int(0)
// call_user_method() and call_user_method_array() 被移除。
// 应该使用 call_user_func() 和 call_user_func_array()
// 在函数中检视参数值会返回 当前 的值
function foo($x) {
    $x++;
    var_dump(func_get_arg(0));
}
foo(1);
// int(2) PHP 7.0
// int(1) PHP 5.6
7.0 New Features
// 标量类型声明
// 返回值类型声明
function arraysSum(array ...$arrays): array
{
    return array_map(function(array $array): int {
        return array_sum($array);
    }, $arrays);
}
// null 合并运算符，对 isset() 的简化
$username = $_GET['user'] ?? 'nobody';

// 太空船操作符（组合比较符）
echo 1 <=> 1; // 0
echo 1 <=> 2; // -1
echo 2 <=> 1; // 1
// 通过 define() 定义 常量数组
define('ANIMALS', [
    'dog',
    'cat',
    'bird'
]);
// 匿名类 用来替代一些“用后即焚”的完整类定义
$app = new Application;
$app->setLogger(new class implements Logger {
    public function log(string $msg) {
        echo $msg;
    }
});
// Unicode codepoint 转译语法
// 这接受一个以 16 进制形式的 Unicode codepoint
echo &#34;\u{9999}&#34;; // 香
// Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它
// PHP 7 之前版本的代码
$getXCB = function() {return $this->x;};
// function bindTo($newThis, $newScope = 'static') { }
// $newScope 将闭包关联到的类作用域
$getX = $getXCB->bindTo(new A, A::class); // 中间层闭包
echo $getX();

// PHP 7+ 及更高版本的代码
$getX = function() {return $this->x;};
echo $getX->call(new A);
// 生成器委托 yield from
function gen()
{
    yield 1;
    yield 2;

    yield from gen2();
}
function gen2()
{
    yield 3;
    yield 4;
}
foreach (gen() as $val)
{
    echo $val, PHP_EOL;
}
// 1
// 2
// 3
// 4
// 柯里化
function add($a) {
  return function($b) use ($a) {
    return $a + $b;
  };
}
$result = add(10)(15);
var_dump($result); // int 25
Deprecated features in PHP 7.0.x
// 构造函数（方法名和类名一样）将被弃用，并在将来移除
class Foo {
    function foo() {
        echo 'I am the constructor';
    }
}
// PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP
// PHP 5.6: OK
Other Changes
// 放宽了保留词限制，以前不能用 'new'、'private' 和 'for'
Project::new('Project Name')->private()->for('purpose here')->with('username here');
// class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class）
New Global Constants
PHP_INT_MIN
&ndash; EOF &ndash;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zyf.im/posts/"},{"@type":"ListItem","position":2,"name":"PHP Migrating to 7.0 7.1","item":"https://zyf.im/2022/11/28/php-migrating-to-70-71/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PHP Migrating to 7.0 7.1","name":"PHP Migrating to 7.0 7.1","description":" 实验环境：https://onlinephp.io/ Polyfill https://github.com/symfony/polyfill/tree/main/src PHP7.0 to PHP7.1 https://www.php.net/manual/en/migration71.php\n7.1 New Features // Nullable types 可为空类型 function test(?string $name): ?string // Void 函数 function swap(\u0026amp;$left, \u0026amp;$right) : void // 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告 // 对称数组解构 $data = [ [1, \u0026#39;Tom\u0026#39;], [2, \u0026#39;Fred\u0026#39;], ]; [$id, $name] = $data[0]; // 赋值部分 [, $name1] = $data[1]; foreach ($data as [$id, $name]) { // logic here with $id and $name } function swap(\u0026amp;$a, \u0026amp;$b): void { [$a, $b] = [$b, $a]; } // list 支持键名 $data = [ [\u0026#34;id\u0026#34; =\u0026gt; 1, \u0026#34;name\u0026#34; =\u0026gt; \u0026#39;Tom\u0026#39;], [\u0026#34;id\u0026#34; =\u0026gt; 2, \u0026#34;name\u0026#34; =\u0026gt; \u0026#39;Fred\u0026#39;], ]; foreach ($data as [\u0026#34;name\u0026#34; =\u0026gt; $name, \u0026#34;id\u0026#34; =\u0026gt; $id]) { // logic here with $id and $name } // 类常量支持可见性 class ConstDemo { public const PUBLIC_CONST_A = 1; } // iterable 伪类（与 callable 类似） interface Traversable extends iterable { // 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口 // Traversable as part of either Iterator or IteratorAggregate，不能直接实现 } function iterator(iterable $iter) { foreach ($iter as $val) { // ... } } // 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获 try { // some code } catch (FirstException | SecondException $e) { // handle first and second exceptions } // 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量 // 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量 // 中文操作要小心 var_dump(\u0026#34;abcdef\u0026#34;[-2]); // e var_dump(strpos(\u0026#34;aabbcc\u0026#34;, \u0026#34;b\u0026#34;)); // 2 var_dump(strpos(\u0026#34;aabbcc\u0026#34;, \u0026#34;b\u0026#34;, -3)); // 3 // 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象 // public static Closure::fromCallable(callable $callback): Closure class Test { public function exposeFunction() { return Closure::fromCallable([$this, \u0026#39;privateFunction\u0026#39;]); } private function privateFunction($param) { var_dump($param); } } $privFunc = (new Test)-\u0026gt;exposeFunction(); $privFunc(\u0026#39;some value\u0026#39;); // string(10) \u0026#34;some value\u0026#34; 7.1 New Functions // 否为可迭代 is_iterable() 7.1 Backward Incompatible Changes // 当传递参数过少时将抛出错误 function test($param){} test(); /* PHP71 Fatal error: Uncaught ArgumentCountError: Too few arguments to function test() PHP70 Warning: Missing argument 1 for test() */ // 禁止动态调用作用域自检函数 // $func() or array_map(\u0026#39;extract\u0026#39;, ...) // function array_map($callback, array $array, array ...$arrays): array (function () { $func = \u0026#39;func_num_args\u0026#39;; $func(); })(); /* PHP71 Warning: Cannot call func_num_args() dynamically */ // 以下名称不能用于命名 class, interface, trait // - void // - iterable // 数字字符串转换 遵循科学记数法 var_dump(intval(\u0026#39;1e5\u0026#39;)); var_dump(is_numeric(\u0026#39;1e5\u0026#39;)); var_dump(is_numeric(\u0026#39;e\u0026#39;)); // PHP71 PHP70 // int(100000) int(1) // bool(true) bool(true) // bool(false) bool(false) // call_user_func() 不再支持对传址的函数的调用 error_reporting(E_ALL); function increment(\u0026amp;$var) { $var++; } $a = 0; call_user_func(\u0026#39;increment\u0026#39;, $a); // ...expected to be a reference, value given call_user_func_array(\u0026#39;increment\u0026#39;, [\u0026amp;$a]); // 1 $increment = \u0026#39;increment\u0026#39;; $increment($a); // 2 // 字符串不再支持空索引运算符 $str = \u0026#34;\u0026#34;; $str[] = \u0026#34;abc\u0026#34;; var_dump($str); // PHP71 Fatal error: Uncaught Error: [] operator not supported for strings // PHP70 array(1) { // [0]=\u0026gt; // string(3) \u0026#34;abc\u0026#34; // } $a = \u0026#34;\u0026#34;; $a[0] = \u0026#34;hello world\u0026#34;; var_dump($a); // PHP71 string(1) \u0026#34;h\u0026#34; // PHP70 array(1) { // [0]=\u0026gt; // string(11) \u0026#34;hello world\u0026#34; // } // 通过空字符串上的字符串索引访问赋值 $str = \u0026#39;\u0026#39;; $str[10] = \u0026#39;foo\u0026#39;; var_dump($str); // PHP71 string(11) \u0026#34; f\u0026#34; // PHP70 array(1) { // [10]=\u0026gt; // string(3) \u0026#34;foo\u0026#34; // } // 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。 $array = []; $array[\u0026#39;a\u0026#39;] = \u0026amp;$array[\u0026#39;b\u0026#39;]; $array[\u0026#39;b\u0026#39;] = 1; var_dump($array); // PHP71 array(2) { // [\u0026#34;b\u0026#34;]=\u0026gt; // \u0026amp;int(1) // [\u0026#34;a\u0026#34;]=\u0026gt; // \u0026amp;int(1) // } // PHP70 array(2) { // [\u0026#34;a\u0026#34;]=\u0026gt; // \u0026amp;int(1) // [\u0026#34;b\u0026#34;]=\u0026gt; // \u0026amp;int(1) // } // 词法绑定变量不能重用名称，以下都将 fatal error $f = function () use ($_SERVER) {}; // any superglobals $f = function () use ($this) {}; $f = function ($param) use ($param) {}; // 禁止 \u0026#34;return;\u0026#34; 对于已经在编译时键入的返回值 function test(int $i): array { $i += 1; return; } // PHP Compile Error A function with return type must return a value var_dump(\u0026#39;1b\u0026#39; + \u0026#39;something\u0026#39;); // PHP71 // Notice: A non well formed numeric value encountered // Warning: A non-numeric value encountered // int(1) // PHP70 int(1) PHP5.6 to PHP7.0 https://www.php.net/manual/en/migration70.php Backward incompatible changes // 错误和异常处理相关的变更 // set_exception_handler() 不再保证收到的一定是 Exception 对象 function handler(Exception $e) { ... } set_exception_handler(\u0026#39;handler\u0026#39;); // 兼容 PHP 5 和 7 function handler($e) { ... } // 仅支持 PHP 7 function handler(Throwable $e) { ... } // 当内部构造器失败的时候，总是抛出异常 // 间接调用的表达式的新旧解析顺序 // 现在严格遵循从左到右的顺序来解析 // 表达式 PHP 5 的解析方式 PHP 7 的解析方式 $$foo[\u0026#39;bar\u0026#39;][\u0026#39;baz\u0026#39;] ${$foo[\u0026#39;bar\u0026#39;][\u0026#39;baz\u0026#39;]} ($$foo)[\u0026#39;bar\u0026#39;][\u0026#39;baz\u0026#39;] $foo-\u0026gt;$bar[\u0026#39;baz\u0026#39;] $foo-\u0026gt;{$bar[\u0026#39;baz\u0026#39;]} ($foo-\u0026gt;$bar)[\u0026#39;baz\u0026#39;] // foreach 通过值遍历时，操作的值为数组的副本 $array = [0]; foreach ($array as $val) { var_dump($val); $array[1] = 1; } // int(0) // foreach通过引用遍历时，有更好的迭代特性 $array = [0]; foreach ($array as \u0026amp;$val) { var_dump($val); $array[1] = 1; } // PHP 7.0 // int(0) // int(1) // PHP 5.6 // int(0) // call_user_method() and call_user_method_array() 被移除。 // 应该使用 call_user_func() 和 call_user_func_array() // 在函数中检视参数值会返回 当前 的值 function foo($x) { $x++; var_dump(func_get_arg(0)); } foo(1); // int(2) PHP 7.0 // int(1) PHP 5.6 7.0 New Features // 标量类型声明 // 返回值类型声明 function arraysSum(array ...$arrays): array { return array_map(function(array $array): int { return array_sum($array); }, $arrays); } // null 合并运算符，对 isset() 的简化 $username = $_GET[\u0026#39;user\u0026#39;] ?? \u0026#39;nobody\u0026#39;; // 太空船操作符（组合比较符） echo 1 \u0026lt;=\u0026gt; 1; // 0 echo 1 \u0026lt;=\u0026gt; 2; // -1 echo 2 \u0026lt;=\u0026gt; 1; // 1 // 通过 define() 定义 常量数组 define(\u0026#39;ANIMALS\u0026#39;, [ \u0026#39;dog\u0026#39;, \u0026#39;cat\u0026#39;, \u0026#39;bird\u0026#39; ]); // 匿名类 用来替代一些“用后即焚”的完整类定义 $app = new Application; $app-\u0026gt;setLogger(new class implements Logger { public function log(string $msg) { echo $msg; } }); // Unicode codepoint 转译语法 // 这接受一个以 16 进制形式的 Unicode codepoint echo \u0026#34;\\u{9999}\u0026#34;; // 香 // Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它 // PHP 7 之前版本的代码 $getXCB = function() {return $this-\u0026gt;x;}; // function bindTo($newThis, $newScope = \u0026#39;static\u0026#39;) { } // $newScope 将闭包关联到的类作用域 $getX = $getXCB-\u0026gt;bindTo(new A, A::class); // 中间层闭包 echo $getX(); // PHP 7+ 及更高版本的代码 $getX = function() {return $this-\u0026gt;x;}; echo $getX-\u0026gt;call(new A); // 生成器委托 yield from function gen() { yield 1; yield 2; yield from gen2(); } function gen2() { yield 3; yield 4; } foreach (gen() as $val) { echo $val, PHP_EOL; } // 1 // 2 // 3 // 4 // 柯里化 function add($a) { return function($b) use ($a) { return $a + $b; }; } $result = add(10)(15); var_dump($result); // int 25 Deprecated features in PHP 7.0.x // 构造函数（方法名和类名一样）将被弃用，并在将来移除 class Foo { function foo() { echo \u0026#39;I am the constructor\u0026#39;; } } // PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP // PHP 5.6: OK Other Changes // 放宽了保留词限制，以前不能用 \u0026#39;new\u0026#39;、\u0026#39;private\u0026#39; 和 \u0026#39;for\u0026#39; Project::new(\u0026#39;Project Name\u0026#39;)-\u0026gt;private()-\u0026gt;for(\u0026#39;purpose here\u0026#39;)-\u0026gt;with(\u0026#39;username here\u0026#39;); // class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class） New Global Constants PHP_INT_MIN \u0026ndash; EOF \u0026ndash;\n","keywords":["php"],"articleBody":" 实验环境：https://onlinephp.io/ Polyfill https://github.com/symfony/polyfill/tree/main/src PHP7.0 to PHP7.1 https://www.php.net/manual/en/migration71.php\n7.1 New Features // Nullable types 可为空类型 function test(?string $name): ?string // Void 函数 function swap(\u0026$left, \u0026$right) : void // 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告 // 对称数组解构 $data = [ [1, 'Tom'], [2, 'Fred'], ]; [$id, $name] = $data[0]; // 赋值部分 [, $name1] = $data[1]; foreach ($data as [$id, $name]) { // logic here with $id and $name } function swap(\u0026$a, \u0026$b): void { [$a, $b] = [$b, $a]; } // list 支持键名 $data = [ [\"id\" =\u003e 1, \"name\" =\u003e 'Tom'], [\"id\" =\u003e 2, \"name\" =\u003e 'Fred'], ]; foreach ($data as [\"name\" =\u003e $name, \"id\" =\u003e $id]) { // logic here with $id and $name } // 类常量支持可见性 class ConstDemo { public const PUBLIC_CONST_A = 1; } // iterable 伪类（与 callable 类似） interface Traversable extends iterable { // 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口 // Traversable as part of either Iterator or IteratorAggregate，不能直接实现 } function iterator(iterable $iter) { foreach ($iter as $val) { // ... } } // 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获 try { // some code } catch (FirstException | SecondException $e) { // handle first and second exceptions } // 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量 // 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量 // 中文操作要小心 var_dump(\"abcdef\"[-2]); // e var_dump(strpos(\"aabbcc\", \"b\")); // 2 var_dump(strpos(\"aabbcc\", \"b\", -3)); // 3 // 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象 // public static Closure::fromCallable(callable $callback): Closure class Test { public function exposeFunction() { return Closure::fromCallable([$this, 'privateFunction']); } private function privateFunction($param) { var_dump($param); } } $privFunc = (new Test)-\u003eexposeFunction(); $privFunc('some value'); // string(10) \"some value\" 7.1 New Functions // 否为可迭代 is_iterable() 7.1 Backward Incompatible Changes // 当传递参数过少时将抛出错误 function test($param){} test(); /* PHP71 Fatal error: Uncaught ArgumentCountError: Too few arguments to function test() PHP70 Warning: Missing argument 1 for test() */ // 禁止动态调用作用域自检函数 // $func() or array_map('extract', ...) // function array_map($callback, array $array, array ...$arrays): array (function () { $func = 'func_num_args'; $func(); })(); /* PHP71 Warning: Cannot call func_num_args() dynamically */ // 以下名称不能用于命名 class, interface, trait // - void // - iterable // 数字字符串转换 遵循科学记数法 var_dump(intval('1e5')); var_dump(is_numeric('1e5')); var_dump(is_numeric('e')); // PHP71 PHP70 // int(100000) int(1) // bool(true) bool(true) // bool(false) bool(false) // call_user_func() 不再支持对传址的函数的调用 error_reporting(E_ALL); function increment(\u0026$var) { $var++; } $a = 0; call_user_func('increment', $a); // ...expected to be a reference, value given call_user_func_array('increment', [\u0026$a]); // 1 $increment = 'increment'; $increment($a); // 2 // 字符串不再支持空索引运算符 $str = \"\"; $str[] = \"abc\"; var_dump($str); // PHP71 Fatal error: Uncaught Error: [] operator not supported for strings // PHP70 array(1) { // [0]=\u003e // string(3) \"abc\" // } $a = \"\"; $a[0] = \"hello world\"; var_dump($a); // PHP71 string(1) \"h\" // PHP70 array(1) { // [0]=\u003e // string(11) \"hello world\" // } // 通过空字符串上的字符串索引访问赋值 $str = ''; $str[10] = 'foo'; var_dump($str); // PHP71 string(11) \" f\" // PHP70 array(1) { // [10]=\u003e // string(3) \"foo\" // } // 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。 $array = []; $array['a'] = \u0026$array['b']; $array['b'] = 1; var_dump($array); // PHP71 array(2) { // [\"b\"]=\u003e // \u0026int(1) // [\"a\"]=\u003e // \u0026int(1) // } // PHP70 array(2) { // [\"a\"]=\u003e // \u0026int(1) // [\"b\"]=\u003e // \u0026int(1) // } // 词法绑定变量不能重用名称，以下都将 fatal error $f = function () use ($_SERVER) {}; // any superglobals $f = function () use ($this) {}; $f = function ($param) use ($param) {}; // 禁止 \"return;\" 对于已经在编译时键入的返回值 function test(int $i): array { $i += 1; return; } // PHP Compile Error A function with return type must return a value var_dump('1b' + 'something'); // PHP71 // Notice: A non well formed numeric value encountered // Warning: A non-numeric value encountered // int(1) // PHP70 int(1) PHP5.6 to PHP7.0 https://www.php.net/manual/en/migration70.php Backward incompatible changes // 错误和异常处理相关的变更 // set_exception_handler() 不再保证收到的一定是 Exception 对象 function handler(Exception $e) { ... } set_exception_handler('handler'); // 兼容 PHP 5 和 7 function handler($e) { ... } // 仅支持 PHP 7 function handler(Throwable $e) { ... } // 当内部构造器失败的时候，总是抛出异常 // 间接调用的表达式的新旧解析顺序 // 现在严格遵循从左到右的顺序来解析 // 表达式 PHP 5 的解析方式 PHP 7 的解析方式 $$foo['bar']['baz'] ${$foo['bar']['baz']} ($$foo)['bar']['baz'] $foo-\u003e$bar['baz'] $foo-\u003e{$bar['baz']} ($foo-\u003e$bar)['baz'] // foreach 通过值遍历时，操作的值为数组的副本 $array = [0]; foreach ($array as $val) { var_dump($val); $array[1] = 1; } // int(0) // foreach通过引用遍历时，有更好的迭代特性 $array = [0]; foreach ($array as \u0026$val) { var_dump($val); $array[1] = 1; } // PHP 7.0 // int(0) // int(1) // PHP 5.6 // int(0) // call_user_method() and call_user_method_array() 被移除。 // 应该使用 call_user_func() 和 call_user_func_array() // 在函数中检视参数值会返回 当前 的值 function foo($x) { $x++; var_dump(func_get_arg(0)); } foo(1); // int(2) PHP 7.0 // int(1) PHP 5.6 7.0 New Features // 标量类型声明 // 返回值类型声明 function arraysSum(array ...$arrays): array { return array_map(function(array $array): int { return array_sum($array); }, $arrays); } // null 合并运算符，对 isset() 的简化 $username = $_GET['user'] ?? 'nobody'; // 太空船操作符（组合比较符） echo 1 \u003c=\u003e 1; // 0 echo 1 \u003c=\u003e 2; // -1 echo 2 \u003c=\u003e 1; // 1 // 通过 define() 定义 常量数组 define('ANIMALS', [ 'dog', 'cat', 'bird' ]); // 匿名类 用来替代一些“用后即焚”的完整类定义 $app = new Application; $app-\u003esetLogger(new class implements Logger { public function log(string $msg) { echo $msg; } }); // Unicode codepoint 转译语法 // 这接受一个以 16 进制形式的 Unicode codepoint echo \"\\u{9999}\"; // 香 // Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它 // PHP 7 之前版本的代码 $getXCB = function() {return $this-\u003ex;}; // function bindTo($newThis, $newScope = 'static') { } // $newScope 将闭包关联到的类作用域 $getX = $getXCB-\u003ebindTo(new A, A::class); // 中间层闭包 echo $getX(); // PHP 7+ 及更高版本的代码 $getX = function() {return $this-\u003ex;}; echo $getX-\u003ecall(new A); // 生成器委托 yield from function gen() { yield 1; yield 2; yield from gen2(); } function gen2() { yield 3; yield 4; } foreach (gen() as $val) { echo $val, PHP_EOL; } // 1 // 2 // 3 // 4 // 柯里化 function add($a) { return function($b) use ($a) { return $a + $b; }; } $result = add(10)(15); var_dump($result); // int 25 Deprecated features in PHP 7.0.x // 构造函数（方法名和类名一样）将被弃用，并在将来移除 class Foo { function foo() { echo 'I am the constructor'; } } // PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP // PHP 5.6: OK Other Changes // 放宽了保留词限制，以前不能用 'new'、'private' 和 'for' Project::new('Project Name')-\u003eprivate()-\u003efor('purpose here')-\u003ewith('username here'); // class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class） New Global Constants PHP_INT_MIN – EOF –\n","wordCount":"975","inLanguage":"en","image":"https://images.unsplash.com/photo-1531878272632-1fdcf961549e?q=80\u0026w=960\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3","datePublished":"2022-11-28T10:36:34Z","dateModified":"2022-11-28T10:36:34Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zyf.im/2022/11/28/php-migrating-to-70-71/"},"publisher":{"@type":"Organization","name":"ZYF.IM BLOG","logo":{"@type":"ImageObject","url":"https://zyf.im/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zyf.im/>Home</a>&nbsp;»&nbsp;<a href=https://zyf.im/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PHP Migrating to 7.0 7.1</h1><div class=post-meta><span title='2022-11-28 10:36:34 +0000 UTC'>November 28, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;975 words&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#php70-to-php71>PHP7.0 to PHP7.1</a><ul><li><a href=#71-new-features>7.1 New Features</a></li><li><a href=#71-new-functions>7.1 New Functions</a></li><li><a href=#71-backward-incompatible-changes>7.1 Backward Incompatible Changes</a></li></ul></li><li><a href=#php56-to-php70>PHP5.6 to PHP7.0</a><ul><li><a href=#backward-incompatible-changes>Backward incompatible changes</a></li><li><a href=#70-new-features>7.0 New Features</a></li><li><a href=#deprecated-features-in-php-70x>Deprecated features in PHP 7.0.x</a></li><li><a href=#other-changes>Other Changes</a></li><li><a href=#new-global-constants>New Global Constants</a></li></ul></li></ul></nav></div></details></div><div class=post-content><ul><li>实验环境：<a href=https://onlinephp.io/>https://onlinephp.io/</a></li><li>Polyfill <a href=https://github.com/symfony/polyfill/tree/main/src>https://github.com/symfony/polyfill/tree/main/src</a></li></ul><h2 id=php70-to-php71>PHP7.0 to PHP7.1<a hidden class=anchor aria-hidden=true href=#php70-to-php71>#</a></h2><blockquote><p><a href=https://www.php.net/manual/en/migration71.php>https://www.php.net/manual/en/migration71.php</a></p></blockquote><h3 id=71-new-features>7.1 New Features<a hidden class=anchor aria-hidden=true href=#71-new-features>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Nullable types 可为空类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=o>?</span><span class=nx>string</span> <span class=nv>$name</span><span class=p>)</span><span class=o>:</span> <span class=o>?</span><span class=nx>string</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Void 函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>swap</span><span class=p>(</span><span class=o>&amp;</span><span class=nv>$left</span><span class=p>,</span> <span class=o>&amp;</span><span class=nv>$right</span><span class=p>)</span> <span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl><span class=c1>// 获取一个 void 方法的返回值会得到 null，并且不会产生任何警告
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 对称数组解构
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$data</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;Tom&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;Fred&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nv>$id</span><span class=p>,</span> <span class=nv>$name</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$data</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c1>// 赋值部分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[,</span> <span class=nv>$name1</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$data</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$data</span> <span class=k>as</span> <span class=p>[</span><span class=nv>$id</span><span class=p>,</span> <span class=nv>$name</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// logic here with $id and $name
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>swap</span><span class=p>(</span><span class=o>&amp;</span><span class=nv>$a</span><span class=p>,</span> <span class=o>&amp;</span><span class=nv>$b</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>$a</span><span class=p>,</span> <span class=nv>$b</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=nv>$b</span><span class=p>,</span> <span class=nv>$a</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// list 支持键名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$data</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s2>&#34;id&#34;</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Tom&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s2>&#34;id&#34;</span> <span class=o>=&gt;</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Fred&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$data</span> <span class=k>as</span> <span class=p>[</span><span class=s2>&#34;name&#34;</span> <span class=o>=&gt;</span> <span class=nv>$name</span><span class=p>,</span> <span class=s2>&#34;id&#34;</span> <span class=o>=&gt;</span> <span class=nv>$id</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// logic here with $id and $name
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 类常量支持可见性
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>ConstDemo</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>const</span> <span class=no>PUBLIC_CONST_A</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// iterable 伪类（与 callable 类似）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>interface</span> <span class=nx>Traversable</span> <span class=k>extends</span> <span class=nx>iterable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 这个接口没有任何方法，它的作用仅仅是作为所有可遍历类的基本接口
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Traversable as part of either Iterator or IteratorAggregate，不能直接实现
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>iterator</span><span class=p>(</span><span class=nx>iterable</span> <span class=nv>$iter</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$iter</span> <span class=k>as</span> <span class=nv>$val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 多异常捕获处理，可以通过管道字符(|)来实现多个异常的捕获
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// some code
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>FirstException</span> <span class=o>|</span> <span class=nx>SecondException</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// handle first and second exceptions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 支持为负的字符串偏移量，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量
</span></span></span><span class=line><span class=cl><span class=c1>// 所有支持偏移量的字符串操作函数，都支持接受负数作为偏移量
</span></span></span><span class=line><span class=cl><span class=c1>// 中文操作要小心
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=s2>&#34;abcdef&#34;</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>]);</span> <span class=c1>// e
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=s2>&#34;aabbcc&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>));</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=s2>&#34;aabbcc&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=o>-</span><span class=mi>3</span><span class=p>));</span> <span class=c1>// 3
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 新增 Closure::fromCallable()，将 callable 转为一个 Closure 对象
</span></span></span><span class=line><span class=cl><span class=c1>// public static Closure::fromCallable(callable $callback): Closure
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Test</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>exposeFunction</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>Closure</span><span class=o>::</span><span class=na>fromCallable</span><span class=p>([</span><span class=nv>$this</span><span class=p>,</span> <span class=s1>&#39;privateFunction&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>privateFunction</span><span class=p>(</span><span class=nv>$param</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>var_dump</span><span class=p>(</span><span class=nv>$param</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$privFunc</span> <span class=o>=</span> <span class=p>(</span><span class=k>new</span> <span class=nx>Test</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>exposeFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$privFunc</span><span class=p>(</span><span class=s1>&#39;some value&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// string(10) &#34;some value&#34;
</span></span></span></code></pre></div><h3 id=71-new-functions>7.1 New Functions<a hidden class=anchor aria-hidden=true href=#71-new-functions>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 否为可迭代
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>is_iterable</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=71-backward-incompatible-changes>7.1 Backward Incompatible Changes<a hidden class=anchor aria-hidden=true href=#71-backward-incompatible-changes>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 当传递参数过少时将抛出错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nv>$param</span><span class=p>){}</span>
</span></span><span class=line><span class=cl><span class=nx>test</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>PHP71
</span></span></span><span class=line><span class=cl><span class=cm>Fatal error: Uncaught ArgumentCountError: Too few arguments to function test()
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>PHP70
</span></span></span><span class=line><span class=cl><span class=cm>Warning: Missing argument 1 for test()
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 禁止动态调用作用域自检函数
</span></span></span><span class=line><span class=cl><span class=c1>// $func() or array_map(&#39;extract&#39;, ...)
</span></span></span><span class=line><span class=cl><span class=c1>// function array_map($callback, array $array, array ...$arrays): array
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$func</span> <span class=o>=</span> <span class=s1>&#39;func_num_args&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$func</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>PHP71
</span></span></span><span class=line><span class=cl><span class=cm>Warning: Cannot call func_num_args() dynamically
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 以下名称不能用于命名 class, interface, trait
</span></span></span><span class=line><span class=cl><span class=c1>// - void
</span></span></span><span class=line><span class=cl><span class=c1>// - iterable
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 数字字符串转换 遵循科学记数法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>intval</span><span class=p>(</span><span class=s1>&#39;1e5&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>is_numeric</span><span class=p>(</span><span class=s1>&#39;1e5&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>is_numeric</span><span class=p>(</span><span class=s1>&#39;e&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71             PHP70
</span></span></span><span class=line><span class=cl><span class=c1>// int(100000)       int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// bool(true)        bool(true)
</span></span></span><span class=line><span class=cl><span class=c1>// bool(false)       bool(false)
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// call_user_func() 不再支持对传址的函数的调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>error_reporting</span><span class=p>(</span><span class=k>E_ALL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>increment</span><span class=p>(</span><span class=o>&amp;</span><span class=nv>$var</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$var</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>call_user_func</span><span class=p>(</span><span class=s1>&#39;increment&#39;</span><span class=p>,</span> <span class=nv>$a</span><span class=p>);</span> <span class=c1>// ...expected to be a reference, value given
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>call_user_func_array</span><span class=p>(</span><span class=s1>&#39;increment&#39;</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=nv>$a</span><span class=p>]);</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$increment</span> <span class=o>=</span> <span class=s1>&#39;increment&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$increment</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span> <span class=c1>// 2
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 字符串不再支持空索引运算符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$str</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$str</span><span class=p>[]</span> <span class=o>=</span> <span class=s2>&#34;abc&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71 Fatal error: Uncaught Error: [] operator not supported for strings
</span></span></span><span class=line><span class=cl><span class=c1>// PHP70 array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(3) &#34;abc&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;hello world&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71 string(1) &#34;h&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// PHP70 array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(11) &#34;hello world&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 通过空字符串上的字符串索引访问赋值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$str</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;foo&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71 string(11) &#34;          f&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// PHP70 array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [10]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(3) &#34;foo&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 当通过引用赋值引用它们自动创建这些元素时，数组中元素的顺序已更改。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$array</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=o>&amp;</span><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$array</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71 array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;b&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   &amp;int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;a&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   &amp;int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>// PHP70 array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;a&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   &amp;int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;b&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   &amp;int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 词法绑定变量不能重用名称，以下都将 fatal error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$f</span> <span class=o>=</span> <span class=k>function</span> <span class=p>()</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$_SERVER</span><span class=p>)</span> <span class=p>{};</span> <span class=c1>// any superglobals
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$f</span> <span class=o>=</span> <span class=k>function</span> <span class=p>()</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$this</span><span class=p>)</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=nv>$f</span> <span class=o>=</span> <span class=k>function</span> <span class=p>(</span><span class=nv>$param</span><span class=p>)</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$param</span><span class=p>)</span> <span class=p>{};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 禁止 &#34;return;&#34; 对于已经在编译时键入的返回值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$i</span><span class=p>)</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP Compile Error A function with return type must return a value
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=s1>&#39;1b&#39;</span> <span class=o>+</span> <span class=s1>&#39;something&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: A non well formed numeric value encountered
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: A non-numeric value encountered
</span></span></span><span class=line><span class=cl><span class=c1>// int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// PHP70 int(1)
</span></span></span></code></pre></div><h2 id=php56-to-php70>PHP5.6 to PHP7.0<a hidden class=anchor aria-hidden=true href=#php56-to-php70>#</a></h2><ul><li><a href=https://www.php.net/manual/en/migration70.php>https://www.php.net/manual/en/migration70.php</a></li></ul><h3 id=backward-incompatible-changes>Backward incompatible changes<a hidden class=anchor aria-hidden=true href=#backward-incompatible-changes>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 错误和异常处理相关的变更
</span></span></span><span class=line><span class=cl><span class=c1>// set_exception_handler() 不再保证收到的一定是 Exception 对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>handler</span><span class=p>(</span><span class=nx>Exception</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>set_exception_handler</span><span class=p>(</span><span class=s1>&#39;handler&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 兼容 PHP 5 和 7
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>handler</span><span class=p>(</span><span class=nv>$e</span><span class=p>)</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 仅支持 PHP 7
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>handler</span><span class=p>(</span><span class=nx>Throwable</span> <span class=nv>$e</span><span class=p>)</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 当内部构造器失败的时候，总是抛出异常
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 间接调用的表达式的新旧解析顺序
</span></span></span><span class=line><span class=cl><span class=c1>// 现在严格遵循从左到右的顺序来解析
</span></span></span><span class=line><span class=cl><span class=c1>// 表达式               PHP 5 的解析方式           PHP 7 的解析方式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$$foo</span><span class=p>[</span><span class=s1>&#39;bar&#39;</span><span class=p>][</span><span class=s1>&#39;baz&#39;</span><span class=p>]</span>    <span class=err>$</span><span class=p>{</span><span class=nv>$foo</span><span class=p>[</span><span class=s1>&#39;bar&#39;</span><span class=p>][</span><span class=s1>&#39;baz&#39;</span><span class=p>]}</span>    <span class=p>(</span><span class=nv>$$foo</span><span class=p>)[</span><span class=s1>&#39;bar&#39;</span><span class=p>][</span><span class=s1>&#39;baz&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nv>$foo</span><span class=o>-&gt;</span><span class=nv>$bar</span><span class=p>[</span><span class=s1>&#39;baz&#39;</span><span class=p>]</span>      <span class=nv>$foo</span><span class=o>-&gt;</span><span class=p>{</span><span class=nv>$bar</span><span class=p>[</span><span class=s1>&#39;baz&#39;</span><span class=p>]}</span>      <span class=p>(</span><span class=nv>$foo</span><span class=o>-&gt;</span><span class=nv>$bar</span><span class=p>)[</span><span class=s1>&#39;baz&#39;</span><span class=p>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// foreach 通过值遍历时，操作的值为数组的副本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$array</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$array</span> <span class=k>as</span> <span class=nv>$val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nv>$val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$array</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// int(0)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// foreach通过引用遍历时，有更好的迭代特性
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$array</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$array</span> <span class=k>as</span> <span class=o>&amp;</span><span class=nv>$val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nv>$val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$array</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP 7.0
</span></span></span><span class=line><span class=cl><span class=c1>// int(0)
</span></span></span><span class=line><span class=cl><span class=c1>// int(1)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// PHP 5.6
</span></span></span><span class=line><span class=cl><span class=c1>// int(0)
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// call_user_method() and call_user_method_array() 被移除。
</span></span></span><span class=line><span class=cl><span class=c1>// 应该使用 call_user_func() 和 call_user_func_array()
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 在函数中检视参数值会返回 当前 的值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>foo</span><span class=p>(</span><span class=nv>$x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$x</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nx>func_get_arg</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>foo</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// int(2) PHP 7.0
</span></span></span><span class=line><span class=cl><span class=c1>// int(1) PHP 5.6
</span></span></span></code></pre></div><h3 id=70-new-features>7.0 New Features<a hidden class=anchor aria-hidden=true href=#70-new-features>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 标量类型声明
</span></span></span><span class=line><span class=cl><span class=c1>// 返回值类型声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>arraysSum</span><span class=p>(</span><span class=k>array</span> <span class=o>...</span><span class=nv>$arrays</span><span class=p>)</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>array_map</span><span class=p>(</span><span class=k>function</span><span class=p>(</span><span class=k>array</span> <span class=nv>$array</span><span class=p>)</span><span class=o>:</span> <span class=nx>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>array_sum</span><span class=p>(</span><span class=nv>$array</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=nv>$arrays</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// null 合并运算符，对 isset() 的简化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$username</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]</span> <span class=o>??</span> <span class=s1>&#39;nobody&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 太空船操作符（组合比较符）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=mi>1</span> <span class=o>&lt;=&gt;</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=mi>1</span> <span class=o>&lt;=&gt;</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// -1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=mi>2</span> <span class=o>&lt;=&gt;</span> <span class=mi>1</span><span class=p>;</span> <span class=c1>// 1
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 通过 define() 定义 常量数组
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;ANIMALS&#39;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;dog&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;cat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;bird&#39;</span>
</span></span><span class=line><span class=cl><span class=p>]);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 匿名类 用来替代一些“用后即焚”的完整类定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Application</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$app</span><span class=o>-&gt;</span><span class=na>setLogger</span><span class=p>(</span><span class=k>new</span> <span class=k>class</span> <span class=nc>implements</span> <span class=nx>Logger</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>log</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$msg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$msg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Unicode codepoint 转译语法
</span></span></span><span class=line><span class=cl><span class=c1>// 这接受一个以 16 进制形式的 Unicode codepoint
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=s2>&#34;\u{9999}&#34;</span><span class=p>;</span> <span class=c1>// 香
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Closure::call() 新方法，简化绑定一个方法到对象上闭包并调用它
</span></span></span><span class=line><span class=cl><span class=c1>// PHP 7 之前版本的代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$getXCB</span> <span class=o>=</span> <span class=k>function</span><span class=p>()</span> <span class=p>{</span><span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>x</span><span class=p>;};</span>
</span></span><span class=line><span class=cl><span class=c1>// function bindTo($newThis, $newScope = &#39;static&#39;) { }
</span></span></span><span class=line><span class=cl><span class=c1>// $newScope 将闭包关联到的类作用域
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$getX</span> <span class=o>=</span> <span class=nv>$getXCB</span><span class=o>-&gt;</span><span class=na>bindTo</span><span class=p>(</span><span class=k>new</span> <span class=nx>A</span><span class=p>,</span> <span class=nx>A</span><span class=o>::</span><span class=na>class</span><span class=p>);</span> <span class=c1>// 中间层闭包
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nv>$getX</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PHP 7+ 及更高版本的代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$getX</span> <span class=o>=</span> <span class=k>function</span><span class=p>()</span> <span class=p>{</span><span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>x</span><span class=p>;};</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$getX</span><span class=o>-&gt;</span><span class=na>call</span><span class=p>(</span><span class=k>new</span> <span class=nx>A</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 生成器委托 yield from
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=nx>from</span> <span class=nx>gen2</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>gen2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nx>gen</span><span class=p>()</span> <span class=k>as</span> <span class=nv>$val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nv>$val</span><span class=p>,</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1>// 4
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 柯里化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>add</span><span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>function</span><span class=p>(</span><span class=nv>$b</span><span class=p>)</span> <span class=k>use</span> <span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$a</span> <span class=o>+</span> <span class=nv>$b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=nx>add</span><span class=p>(</span><span class=mi>10</span><span class=p>)(</span><span class=mi>15</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$result</span><span class=p>);</span> <span class=c1>// int 25
</span></span></span></code></pre></div><h3 id=deprecated-features-in-php-70x>Deprecated features in PHP 7.0.x<a hidden class=anchor aria-hidden=true href=#deprecated-features-in-php-70x>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 构造函数（方法名和类名一样）将被弃用，并在将来移除
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>foo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;I am the constructor&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP 7.0: Deprecated: Methods with the same name as their class will not be constructors in a future version of PHP
</span></span></span><span class=line><span class=cl><span class=c1>// PHP 5.6: OK
</span></span></span></code></pre></div><h3 id=other-changes>Other Changes<a hidden class=anchor aria-hidden=true href=#other-changes>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 放宽了保留词限制，以前不能用 &#39;new&#39;、&#39;private&#39; 和 &#39;for&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Project</span><span class=o>::</span><span class=na>new</span><span class=p>(</span><span class=s1>&#39;Project Name&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>private</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>for</span><span class=p>(</span><span class=s1>&#39;purpose here&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>(</span><span class=s1>&#39;username here&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// class 关键词不能用于常量名，否则会和类名解析语法冲突（ClassName::class）
</span></span></span></code></pre></div><h3 id=new-global-constants>New Global Constants<a hidden class=anchor aria-hidden=true href=#new-global-constants>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>PHP_INT_MIN</span>
</span></span></code></pre></div><p>&ndash; EOF &ndash;</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zyf.im/tags/php/>Php</a></li></ul><nav class=paginav><a class=prev href=https://zyf.im/2022/12/12/php-migrating-to-72-73-74/><span class=title>« Prev</span><br><span>PHP Migrating to 7.2 7.3 7.4</span>
</a><a class=next href=https://zyf.im/2022/11/17/docker-code-snippet/><span class=title>Next »</span><br><span>Docker Code Snippet</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>