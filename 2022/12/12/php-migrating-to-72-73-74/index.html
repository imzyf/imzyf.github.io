<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PHP Migrating to 7.2 7.3 7.4 | ZYF.IM BLOG</title>
<meta name=keywords content="php"><meta name=description content='
实验环境：https://onlinephp.io/

PHP7.1 to PHP7.2

https://www.php.net/manual/en/migration72.php
https://php.watch/versions/7.2


Argon2 password hashing support, class constant visibility, object type, and many more.
New Features 7.2
// 新的 object 类型
// 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型
// https://www.php.net/manual/zh/language.oop5.variance.php
// 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型
function test(object $obj): object
{
    return new SplQueue();
}
test(new StdClass());
// 抽象类可以重写被继承的抽象类的抽象方法
abstract class A
{
    abstract function test(string $s);
}
abstract class B extends A
{
    // overridden - 仍然保持参数的逆变和返回的逆变
    abstract function test($s): int;
}
// 重写方法和接口实现的参数类型可以省略
// 仍然是符合LSP，这种参数类型是逆变
interface A
{
    public function test(array $input);
}
class B implements A
{
    // type omitted for $input
    public function test($input){
        return $input;
    }
}
var_dump((new B())->test(1));
// PHP72 int(1)
//
// PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input)
Backward incompatible changes 7.2
// 防止 number_format() 返回负零
var_dump(number_format(-0.01));
// PHP72 string(1) "0"
//
// PHP71 string(2) "-0"
// 转换对象和数组中的数字键
$arr = [0 => 1];
$obj = (object) $arr;
var_dump($obj);
var_dump($obj->{&#39;0&#39;}, // 新写法
    $obj->{0} // 新写法
);
// PHP72 object(stdClass)#1 (1) {
//   ["0"]=>
//   int(1)
// }
// int(1)
// int(1)
//
// PHP71 object(stdClass)#1 (1) {
//   [0]=>
//   int(1)
// }
// Notice: Undefined property: stdClass::$0


$obj = new class {
    public function __construct()
    {
        $this->{1} = "value";
    }
};
$arr = (array) $obj;
var_dump($arr);
var_dump($arr["1"]); // 整数 或者 字符串整数 含义相同
var_dump($arr[1]); // PHP71
var_dump($arr[0]);
// PHP72 array(1) {
//   [1]=>
//   string(2) "my"
// }
//
// PHP71 无法取整型字符串 key
// array(1) {
//   ["1"]=>
//   string(2) "my"
// }
// Notice: Undefined offset: 1
// Notice: Undefined offset: 1
// Notice: Undefined offset: 0

$a = [1.3 => "v1", 1.4 => "v2"];
var_dump($a);
// ALL array key float 会被转换为 int
// array(1) {
//   [1]=>
//   string(2) "v2"
// }
// get_class() 函数不再接受 null
var_dump(get_class(null));
// PHP72
// Warning: get_class() expects parameter 1 to be object
// bool(false)
//
// PHP71
// Warning: get_class() called without object from outside a class
// bool(false)
//
// PHP80
// Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given
// 计算非可数类型（non-countable）时发出警告
var_dump(
    count(null), // NULL is not countable
    count(1), // integers are not countable
    count(&#39;abc&#39;), // strings are not countable
    count(new stdclass) // objects not implementing the Countable interface are not countable
);
// PHP72
// Warning: count(): Parameter must be an array or an object that implements Countable
//
// PHP71
// 无 Warning
//
// PHP80
// Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array
// 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)）
// PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常
var_dump(MY_CONST);
// PHP72
// Warning: Use of undefined constant MY_CONST - assumed &#39;MY_CONST&#39;
// string(8) "MY_CONST"
//
// PHP71
// Notice: Use of undefined constant MY_CONST
// string(8) "MY_CONST"
//
// PHP80
// Fatal error: Uncaught Error: Undefined constant "MY_CONST"
// bcmod 任意精度数字取模，添加新增参数 scale
var_dump(bcmod("4", "3.5"));
// PHP72
// string(1) "0"
//
// PHP71
// string(1) "1"
var_dump(bcmod("4", "3.5", 1));
// PHP72
// string(3) "0.5"
//
// PHP71
// Warning: bcmod() expects exactly 2 parameters, 3 given
// json_decode associative 允许为 null
// 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。
// 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY
// https://www.php.net/manual/zh/function.json-decode.php
$json = &#39;{"a":1,"b":2}&#39;;
var_dump(json_decode($json, null, 512, JSON_OBJECT_AS_ARRAY));
// PHP72
// array(2) {
//   ["a"]=>
//   int(1)
//   ["b"]=>
//   int(2)
// }
//
// PHP71
// object(stdClass)#1 (2) {
//   ["a"]=>
//   int(1)
//   ["b"]=>
//   int(2)
// }
PHP7.2 to PHP7.3

https://www.php.net/manual/en/migration72.php
https://php.watch/versions/7.3


Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.'><meta name=author content="Me"><link rel=canonical href=https://zyf.im/2022/12/12/php-migrating-to-72-73-74/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zyf.im/2022/12/12/php-migrating-to-72-73-74/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://zyf.im/2022/12/12/php-migrating-to-72-73-74/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="PHP Migrating to 7.2 7.3 7.4"><meta property="og:description" content=' 实验环境：https://onlinephp.io/ PHP7.1 to PHP7.2 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.2 Argon2 password hashing support, class constant visibility, object type, and many more.
New Features 7.2 // 新的 object 类型 // 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型 // https://www.php.net/manual/zh/language.oop5.variance.php // 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型 function test(object $obj): object { return new SplQueue(); } test(new StdClass()); // 抽象类可以重写被继承的抽象类的抽象方法 abstract class A { abstract function test(string $s); } abstract class B extends A { // overridden - 仍然保持参数的逆变和返回的逆变 abstract function test($s): int; } // 重写方法和接口实现的参数类型可以省略 // 仍然是符合LSP，这种参数类型是逆变 interface A { public function test(array $input); } class B implements A { // type omitted for $input public function test($input){ return $input; } } var_dump((new B())->test(1)); // PHP72 int(1) // // PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input) Backward incompatible changes 7.2 // 防止 number_format() 返回负零 var_dump(number_format(-0.01)); // PHP72 string(1) "0" // // PHP71 string(2) "-0" // 转换对象和数组中的数字键 $arr = [0 => 1]; $obj = (object) $arr; var_dump($obj); var_dump($obj->{&#39;0&#39;}, // 新写法 $obj->{0} // 新写法 ); // PHP72 object(stdClass)#1 (1) { // ["0"]=> // int(1) // } // int(1) // int(1) // // PHP71 object(stdClass)#1 (1) { // [0]=> // int(1) // } // Notice: Undefined property: stdClass::$0 $obj = new class { public function __construct() { $this->{1} = "value"; } }; $arr = (array) $obj; var_dump($arr); var_dump($arr["1"]); // 整数 或者 字符串整数 含义相同 var_dump($arr[1]); // PHP71 var_dump($arr[0]); // PHP72 array(1) { // [1]=> // string(2) "my" // } // // PHP71 无法取整型字符串 key // array(1) { // ["1"]=> // string(2) "my" // } // Notice: Undefined offset: 1 // Notice: Undefined offset: 1 // Notice: Undefined offset: 0 $a = [1.3 => "v1", 1.4 => "v2"]; var_dump($a); // ALL array key float 会被转换为 int // array(1) { // [1]=> // string(2) "v2" // } // get_class() 函数不再接受 null var_dump(get_class(null)); // PHP72 // Warning: get_class() expects parameter 1 to be object // bool(false) // // PHP71 // Warning: get_class() called without object from outside a class // bool(false) // // PHP80 // Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given // 计算非可数类型（non-countable）时发出警告 var_dump( count(null), // NULL is not countable count(1), // integers are not countable count(&#39;abc&#39;), // strings are not countable count(new stdclass) // objects not implementing the Countable interface are not countable ); // PHP72 // Warning: count(): Parameter must be an array or an object that implements Countable // // PHP71 // 无 Warning // // PHP80 // Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array // 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)） // PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常 var_dump(MY_CONST); // PHP72 // Warning: Use of undefined constant MY_CONST - assumed &#39;MY_CONST&#39; // string(8) "MY_CONST" // // PHP71 // Notice: Use of undefined constant MY_CONST // string(8) "MY_CONST" // // PHP80 // Fatal error: Uncaught Error: Undefined constant "MY_CONST" // bcmod 任意精度数字取模，添加新增参数 scale var_dump(bcmod("4", "3.5")); // PHP72 // string(1) "0" // // PHP71 // string(1) "1" var_dump(bcmod("4", "3.5", 1)); // PHP72 // string(3) "0.5" // // PHP71 // Warning: bcmod() expects exactly 2 parameters, 3 given // json_decode associative 允许为 null // 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。 // 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY // https://www.php.net/manual/zh/function.json-decode.php $json = &#39;{"a":1,"b":2}&#39;; var_dump(json_decode($json, null, 512, JSON_OBJECT_AS_ARRAY)); // PHP72 // array(2) { // ["a"]=> // int(1) // ["b"]=> // int(2) // } // // PHP71 // object(stdClass)#1 (2) { // ["a"]=> // int(1) // ["b"]=> // int(2) // } PHP7.2 to PHP7.3 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.3 Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-12T20:51:51+00:00"><meta property="article:modified_time" content="2022-12-12T20:51:51+00:00"><meta property="article:tag" content="Php"><meta name=twitter:card content="summary"><meta name=twitter:title content="PHP Migrating to 7.2 7.3 7.4"><meta name=twitter:description content='
实验环境：https://onlinephp.io/

PHP7.1 to PHP7.2

https://www.php.net/manual/en/migration72.php
https://php.watch/versions/7.2


Argon2 password hashing support, class constant visibility, object type, and many more.
New Features 7.2
// 新的 object 类型
// 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型
// https://www.php.net/manual/zh/language.oop5.variance.php
// 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型
function test(object $obj): object
{
    return new SplQueue();
}
test(new StdClass());
// 抽象类可以重写被继承的抽象类的抽象方法
abstract class A
{
    abstract function test(string $s);
}
abstract class B extends A
{
    // overridden - 仍然保持参数的逆变和返回的逆变
    abstract function test($s): int;
}
// 重写方法和接口实现的参数类型可以省略
// 仍然是符合LSP，这种参数类型是逆变
interface A
{
    public function test(array $input);
}
class B implements A
{
    // type omitted for $input
    public function test($input){
        return $input;
    }
}
var_dump((new B())->test(1));
// PHP72 int(1)
//
// PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input)
Backward incompatible changes 7.2
// 防止 number_format() 返回负零
var_dump(number_format(-0.01));
// PHP72 string(1) "0"
//
// PHP71 string(2) "-0"
// 转换对象和数组中的数字键
$arr = [0 => 1];
$obj = (object) $arr;
var_dump($obj);
var_dump($obj->{&#39;0&#39;}, // 新写法
    $obj->{0} // 新写法
);
// PHP72 object(stdClass)#1 (1) {
//   ["0"]=>
//   int(1)
// }
// int(1)
// int(1)
//
// PHP71 object(stdClass)#1 (1) {
//   [0]=>
//   int(1)
// }
// Notice: Undefined property: stdClass::$0


$obj = new class {
    public function __construct()
    {
        $this->{1} = "value";
    }
};
$arr = (array) $obj;
var_dump($arr);
var_dump($arr["1"]); // 整数 或者 字符串整数 含义相同
var_dump($arr[1]); // PHP71
var_dump($arr[0]);
// PHP72 array(1) {
//   [1]=>
//   string(2) "my"
// }
//
// PHP71 无法取整型字符串 key
// array(1) {
//   ["1"]=>
//   string(2) "my"
// }
// Notice: Undefined offset: 1
// Notice: Undefined offset: 1
// Notice: Undefined offset: 0

$a = [1.3 => "v1", 1.4 => "v2"];
var_dump($a);
// ALL array key float 会被转换为 int
// array(1) {
//   [1]=>
//   string(2) "v2"
// }
// get_class() 函数不再接受 null
var_dump(get_class(null));
// PHP72
// Warning: get_class() expects parameter 1 to be object
// bool(false)
//
// PHP71
// Warning: get_class() called without object from outside a class
// bool(false)
//
// PHP80
// Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given
// 计算非可数类型（non-countable）时发出警告
var_dump(
    count(null), // NULL is not countable
    count(1), // integers are not countable
    count(&#39;abc&#39;), // strings are not countable
    count(new stdclass) // objects not implementing the Countable interface are not countable
);
// PHP72
// Warning: count(): Parameter must be an array or an object that implements Countable
//
// PHP71
// 无 Warning
//
// PHP80
// Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array
// 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)）
// PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常
var_dump(MY_CONST);
// PHP72
// Warning: Use of undefined constant MY_CONST - assumed &#39;MY_CONST&#39;
// string(8) "MY_CONST"
//
// PHP71
// Notice: Use of undefined constant MY_CONST
// string(8) "MY_CONST"
//
// PHP80
// Fatal error: Uncaught Error: Undefined constant "MY_CONST"
// bcmod 任意精度数字取模，添加新增参数 scale
var_dump(bcmod("4", "3.5"));
// PHP72
// string(1) "0"
//
// PHP71
// string(1) "1"
var_dump(bcmod("4", "3.5", 1));
// PHP72
// string(3) "0.5"
//
// PHP71
// Warning: bcmod() expects exactly 2 parameters, 3 given
// json_decode associative 允许为 null
// 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。
// 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY
// https://www.php.net/manual/zh/function.json-decode.php
$json = &#39;{"a":1,"b":2}&#39;;
var_dump(json_decode($json, null, 512, JSON_OBJECT_AS_ARRAY));
// PHP72
// array(2) {
//   ["a"]=>
//   int(1)
//   ["b"]=>
//   int(2)
// }
//
// PHP71
// object(stdClass)#1 (2) {
//   ["a"]=>
//   int(1)
//   ["b"]=>
//   int(2)
// }
PHP7.2 to PHP7.3

https://www.php.net/manual/en/migration72.php
https://php.watch/versions/7.3


Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zyf.im/posts/"},{"@type":"ListItem","position":2,"name":"PHP Migrating to 7.2 7.3 7.4","item":"https://zyf.im/2022/12/12/php-migrating-to-72-73-74/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PHP Migrating to 7.2 7.3 7.4","name":"PHP Migrating to 7.2 7.3 7.4","description":" 实验环境：https://onlinephp.io/ PHP7.1 to PHP7.2 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.2 Argon2 password hashing support, class constant visibility, object type, and many more.\nNew Features 7.2 // 新的 object 类型 // 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型 // https://www.php.net/manual/zh/language.oop5.variance.php // 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型 function test(object $obj): object { return new SplQueue(); } test(new StdClass()); // 抽象类可以重写被继承的抽象类的抽象方法 abstract class A { abstract function test(string $s); } abstract class B extends A { // overridden - 仍然保持参数的逆变和返回的逆变 abstract function test($s): int; } // 重写方法和接口实现的参数类型可以省略 // 仍然是符合LSP，这种参数类型是逆变 interface A { public function test(array $input); } class B implements A { // type omitted for $input public function test($input){ return $input; } } var_dump((new B())-\u0026gt;test(1)); // PHP72 int(1) // // PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input) Backward incompatible changes 7.2 // 防止 number_format() 返回负零 var_dump(number_format(-0.01)); // PHP72 string(1) \u0026#34;0\u0026#34; // // PHP71 string(2) \u0026#34;-0\u0026#34; // 转换对象和数组中的数字键 $arr = [0 =\u0026gt; 1]; $obj = (object) $arr; var_dump($obj); var_dump($obj-\u0026gt;{\u0026#39;0\u0026#39;}, // 新写法 $obj-\u0026gt;{0} // 新写法 ); // PHP72 object(stdClass)#1 (1) { // [\u0026#34;0\u0026#34;]=\u0026gt; // int(1) // } // int(1) // int(1) // // PHP71 object(stdClass)#1 (1) { // [0]=\u0026gt; // int(1) // } // Notice: Undefined property: stdClass::$0 $obj = new class { public function __construct() { $this-\u0026gt;{1} = \u0026#34;value\u0026#34;; } }; $arr = (array) $obj; var_dump($arr); var_dump($arr[\u0026#34;1\u0026#34;]); // 整数 或者 字符串整数 含义相同 var_dump($arr[1]); // PHP71 var_dump($arr[0]); // PHP72 array(1) { // [1]=\u0026gt; // string(2) \u0026#34;my\u0026#34; // } // // PHP71 无法取整型字符串 key // array(1) { // [\u0026#34;1\u0026#34;]=\u0026gt; // string(2) \u0026#34;my\u0026#34; // } // Notice: Undefined offset: 1 // Notice: Undefined offset: 1 // Notice: Undefined offset: 0 $a = [1.3 =\u0026gt; \u0026#34;v1\u0026#34;, 1.4 =\u0026gt; \u0026#34;v2\u0026#34;]; var_dump($a); // ALL array key float 会被转换为 int // array(1) { // [1]=\u0026gt; // string(2) \u0026#34;v2\u0026#34; // } // get_class() 函数不再接受 null var_dump(get_class(null)); // PHP72 // Warning: get_class() expects parameter 1 to be object // bool(false) // // PHP71 // Warning: get_class() called without object from outside a class // bool(false) // // PHP80 // Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given // 计算非可数类型（non-countable）时发出警告 var_dump( count(null), // NULL is not countable count(1), // integers are not countable count(\u0026#39;abc\u0026#39;), // strings are not countable count(new stdclass) // objects not implementing the Countable interface are not countable ); // PHP72 // Warning: count(): Parameter must be an array or an object that implements Countable // // PHP71 // 无 Warning // // PHP80 // Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array // 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)） // PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常 var_dump(MY_CONST); // PHP72 // Warning: Use of undefined constant MY_CONST - assumed \u0026#39;MY_CONST\u0026#39; // string(8) \u0026#34;MY_CONST\u0026#34; // // PHP71 // Notice: Use of undefined constant MY_CONST // string(8) \u0026#34;MY_CONST\u0026#34; // // PHP80 // Fatal error: Uncaught Error: Undefined constant \u0026#34;MY_CONST\u0026#34; // bcmod 任意精度数字取模，添加新增参数 scale var_dump(bcmod(\u0026#34;4\u0026#34;, \u0026#34;3.5\u0026#34;)); // PHP72 // string(1) \u0026#34;0\u0026#34; // // PHP71 // string(1) \u0026#34;1\u0026#34; var_dump(bcmod(\u0026#34;4\u0026#34;, \u0026#34;3.5\u0026#34;, 1)); // PHP72 // string(3) \u0026#34;0.5\u0026#34; // // PHP71 // Warning: bcmod() expects exactly 2 parameters, 3 given // json_decode associative 允许为 null // 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。 // 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY // https://www.php.net/manual/zh/function.json-decode.php $json = \u0026#39;{\u0026#34;a\u0026#34;:1,\u0026#34;b\u0026#34;:2}\u0026#39;; var_dump(json_decode($json, null, 512, JSON_OBJECT_AS_ARRAY)); // PHP72 // array(2) { // [\u0026#34;a\u0026#34;]=\u0026gt; // int(1) // [\u0026#34;b\u0026#34;]=\u0026gt; // int(2) // } // // PHP71 // object(stdClass)#1 (2) { // [\u0026#34;a\u0026#34;]=\u0026gt; // int(1) // [\u0026#34;b\u0026#34;]=\u0026gt; // int(2) // } PHP7.2 to PHP7.3 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.3 Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.\n","keywords":["php"],"articleBody":" 实验环境：https://onlinephp.io/ PHP7.1 to PHP7.2 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.2 Argon2 password hashing support, class constant visibility, object type, and many more.\nNew Features 7.2 // 新的 object 类型 // 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型 // https://www.php.net/manual/zh/language.oop5.variance.php // 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型 function test(object $obj): object { return new SplQueue(); } test(new StdClass()); // 抽象类可以重写被继承的抽象类的抽象方法 abstract class A { abstract function test(string $s); } abstract class B extends A { // overridden - 仍然保持参数的逆变和返回的逆变 abstract function test($s): int; } // 重写方法和接口实现的参数类型可以省略 // 仍然是符合LSP，这种参数类型是逆变 interface A { public function test(array $input); } class B implements A { // type omitted for $input public function test($input){ return $input; } } var_dump((new B())-\u003etest(1)); // PHP72 int(1) // // PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input) Backward incompatible changes 7.2 // 防止 number_format() 返回负零 var_dump(number_format(-0.01)); // PHP72 string(1) \"0\" // // PHP71 string(2) \"-0\" // 转换对象和数组中的数字键 $arr = [0 =\u003e 1]; $obj = (object) $arr; var_dump($obj); var_dump($obj-\u003e{'0'}, // 新写法 $obj-\u003e{0} // 新写法 ); // PHP72 object(stdClass)#1 (1) { // [\"0\"]=\u003e // int(1) // } // int(1) // int(1) // // PHP71 object(stdClass)#1 (1) { // [0]=\u003e // int(1) // } // Notice: Undefined property: stdClass::$0 $obj = new class { public function __construct() { $this-\u003e{1} = \"value\"; } }; $arr = (array) $obj; var_dump($arr); var_dump($arr[\"1\"]); // 整数 或者 字符串整数 含义相同 var_dump($arr[1]); // PHP71 var_dump($arr[0]); // PHP72 array(1) { // [1]=\u003e // string(2) \"my\" // } // // PHP71 无法取整型字符串 key // array(1) { // [\"1\"]=\u003e // string(2) \"my\" // } // Notice: Undefined offset: 1 // Notice: Undefined offset: 1 // Notice: Undefined offset: 0 $a = [1.3 =\u003e \"v1\", 1.4 =\u003e \"v2\"]; var_dump($a); // ALL array key float 会被转换为 int // array(1) { // [1]=\u003e // string(2) \"v2\" // } // get_class() 函数不再接受 null var_dump(get_class(null)); // PHP72 // Warning: get_class() expects parameter 1 to be object // bool(false) // // PHP71 // Warning: get_class() called without object from outside a class // bool(false) // // PHP80 // Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given // 计算非可数类型（non-countable）时发出警告 var_dump( count(null), // NULL is not countable count(1), // integers are not countable count('abc'), // strings are not countable count(new stdclass) // objects not implementing the Countable interface are not countable ); // PHP72 // Warning: count(): Parameter must be an array or an object that implements Countable // // PHP71 // 无 Warning // // PHP80 // Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array // 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)） // PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常 var_dump(MY_CONST); // PHP72 // Warning: Use of undefined constant MY_CONST - assumed 'MY_CONST' // string(8) \"MY_CONST\" // // PHP71 // Notice: Use of undefined constant MY_CONST // string(8) \"MY_CONST\" // // PHP80 // Fatal error: Uncaught Error: Undefined constant \"MY_CONST\" // bcmod 任意精度数字取模，添加新增参数 scale var_dump(bcmod(\"4\", \"3.5\")); // PHP72 // string(1) \"0\" // // PHP71 // string(1) \"1\" var_dump(bcmod(\"4\", \"3.5\", 1)); // PHP72 // string(3) \"0.5\" // // PHP71 // Warning: bcmod() expects exactly 2 parameters, 3 given // json_decode associative 允许为 null // 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。 // 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY // https://www.php.net/manual/zh/function.json-decode.php $json = '{\"a\":1,\"b\":2}'; var_dump(json_decode($json, null, 512, JSON_OBJECT_AS_ARRAY)); // PHP72 // array(2) { // [\"a\"]=\u003e // int(1) // [\"b\"]=\u003e // int(2) // } // // PHP71 // object(stdClass)#1 (2) { // [\"a\"]=\u003e // int(1) // [\"b\"]=\u003e // int(2) // } PHP7.2 to PHP7.3 https://www.php.net/manual/en/migration72.php https://php.watch/versions/7.3 Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.\nNew Features 7.3 // Heredoc Nowdoc 不再需要后跟分号或换行符 // 结束标记可以缩进，结束时所引用的标识符必须在该行的第一列 $values = [\u003c\u003c\u003cEND a b c END, 'd e f']; var_dump($values); // PHP73 array(2) { // [0]=\u003e // string(13) \"a // b // c\" // [1]=\u003e // string(5) \"d e f\" // } // // PHP72 Parse error: syntax error, unexpected end of file echo \u003c\u003c","wordCount":"1281","inLanguage":"en","datePublished":"2022-12-12T20:51:51Z","dateModified":"2022-12-12T20:51:51Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zyf.im/2022/12/12/php-migrating-to-72-73-74/"},"publisher":{"@type":"Organization","name":"ZYF.IM BLOG","logo":{"@type":"ImageObject","url":"https://zyf.im/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zyf.im/>Home</a>&nbsp;»&nbsp;<a href=https://zyf.im/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PHP Migrating to 7.2 7.3 7.4</h1><div class=post-meta><span title='2022-12-12 20:51:51 +0000 UTC'>December 12, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1281 words&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#php71-to-php72>PHP7.1 to PHP7.2</a><ul><li><a href=#new-features-72>New Features 7.2</a></li><li><a href=#backward-incompatible-changes-72>Backward incompatible changes 7.2</a></li></ul></li><li><a href=#php72-to-php73>PHP7.2 to PHP7.3</a><ul><li><a href=#new-features-73>New Features 7.3</a></li><li><a href=#new-functions-73>New Functions 7.3</a></li><li><a href=#backward-incompatible-changes-73>Backward Incompatible Changes 7.3</a></li></ul></li><li><a href=#php73-to-php74>PHP7.3 to PHP7.4</a><ul><li><a href=#new-features-74>New Features 7.4</a></li><li><a href=#backward-incompatible-changes-74>Backward Incompatible Changes 7.4</a></li><li><a href=#deprecated-features-74>Deprecated Features 7.4</a></li></ul></li></ul></nav></div></details></div><div class=post-content><ul><li>实验环境：<a href=https://onlinephp.io/>https://onlinephp.io/</a></li></ul><h2 id=php71-to-php72>PHP7.1 to PHP7.2<a hidden class=anchor aria-hidden=true href=#php71-to-php72>#</a></h2><ul><li><a href=https://www.php.net/manual/en/migration72.php>https://www.php.net/manual/en/migration72.php</a></li><li><a href=https://php.watch/versions/7.2>https://php.watch/versions/7.2</a></li></ul><blockquote><p>Argon2 password hashing support, class constant visibility, object type, and many more.</p></blockquote><h3 id=new-features-72>New Features 7.2<a hidden class=anchor aria-hidden=true href=#new-features-72>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 新的 object 类型
</span></span></span><span class=line><span class=cl><span class=c1>// 可用于逆变（contravariant）参数输入和协变（covariant）返回任何对象类型
</span></span></span><span class=line><span class=cl><span class=c1>// https://www.php.net/manual/zh/language.oop5.variance.php
</span></span></span><span class=line><span class=cl><span class=c1>// 协变使子类比父类方法能返回更具体的类型；逆变使子类比父类方法参数类型能接受更模糊的类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nx>object</span> <span class=nv>$obj</span><span class=p>)</span><span class=o>:</span> <span class=nx>object</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>SplQueue</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>test</span><span class=p>(</span><span class=k>new</span> <span class=k>StdClass</span><span class=p>());</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 抽象类可以重写被继承的抽象类的抽象方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>abstract</span> <span class=k>class</span> <span class=nc>A</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>abstract</span> <span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>abstract</span> <span class=k>class</span> <span class=nc>B</span> <span class=k>extends</span> <span class=nx>A</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// overridden - 仍然保持参数的逆变和返回的逆变
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>abstract</span> <span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nv>$s</span><span class=p>)</span><span class=o>:</span> <span class=nx>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 重写方法和接口实现的参数类型可以省略
</span></span></span><span class=line><span class=cl><span class=c1>// 仍然是符合LSP，这种参数类型是逆变
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>interface</span> <span class=nx>A</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=k>array</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span> <span class=k>implements</span> <span class=nx>A</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// type omitted for $input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>public</span> <span class=k>function</span> <span class=nf>test</span><span class=p>(</span><span class=nv>$input</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$input</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>((</span><span class=k>new</span> <span class=nx>B</span><span class=p>())</span><span class=o>-&gt;</span><span class=na>test</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72 int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71 Fatal error: Declaration of B::test($input) must be compatible with A::test(array $input)
</span></span></span></code></pre></div><h3 id=backward-incompatible-changes-72>Backward incompatible changes 7.2<a hidden class=anchor aria-hidden=true href=#backward-incompatible-changes-72>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 防止 number_format() 返回负零
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>number_format</span><span class=p>(</span><span class=o>-</span><span class=mf>0.01</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72 string(1) &#34;0&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71 string(2) &#34;-0&#34;
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 转换对象和数组中的数字键
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$arr</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=o>=&gt;</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$obj</span> <span class=o>=</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=nv>$arr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$obj</span><span class=o>-&gt;</span><span class=p>{</span><span class=s1>&#39;0&#39;</span><span class=p>},</span> <span class=c1>// 新写法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$obj</span><span class=o>-&gt;</span><span class=p>{</span><span class=mi>0</span><span class=p>}</span> <span class=c1>// 新写法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72 object(stdClass)#1 (1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;0&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>// int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71 object(stdClass)#1 (1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(1)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: Undefined property: stdClass::$0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$obj</span> <span class=o>=</span> <span class=k>new</span> <span class=k>class</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=p>{</span><span class=mi>1</span><span class=p>}</span> <span class=o>=</span> <span class=s2>&#34;value&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nv>$arr</span> <span class=o>=</span> <span class=p>(</span><span class=k>array</span><span class=p>)</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$arr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$arr</span><span class=p>[</span><span class=s2>&#34;1&#34;</span><span class=p>]);</span> <span class=c1>// 整数 或者 字符串整数 含义相同
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$arr</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72 array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(2) &#34;my&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71 无法取整型字符串 key
</span></span></span><span class=line><span class=cl><span class=c1>// array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;1&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(2) &#34;my&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: Undefined offset: 1
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: Undefined offset: 1
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: Undefined offset: 0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.3</span> <span class=o>=&gt;</span> <span class=s2>&#34;v1&#34;</span><span class=p>,</span> <span class=mf>1.4</span> <span class=o>=&gt;</span> <span class=s2>&#34;v2&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// ALL array key float 会被转换为 int
</span></span></span><span class=line><span class=cl><span class=c1>// array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(2) &#34;v2&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// get_class() 函数不再接受 null
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>get_class</span><span class=p>(</span><span class=k>null</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: get_class() expects parameter 1 to be object
</span></span></span><span class=line><span class=cl><span class=c1>// bool(false)
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: get_class() called without object from outside a class
</span></span></span><span class=line><span class=cl><span class=c1>// bool(false)
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP80
</span></span></span><span class=line><span class=cl><span class=c1>// Fatal error: Uncaught TypeError: get_class(): Argument #1 ($object) must be of type object, null given
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 计算非可数类型（non-countable）时发出警告
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>(</span><span class=k>null</span><span class=p>),</span> <span class=c1>// NULL is not countable
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>count</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=c1>// integers are not countable
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>count</span><span class=p>(</span><span class=s1>&#39;abc&#39;</span><span class=p>),</span> <span class=c1>// strings are not countable
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>count</span><span class=p>(</span><span class=k>new</span> <span class=k>stdclass</span><span class=p>)</span> <span class=c1>// objects not implementing the Countable interface are not countable
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: count(): Parameter must be an array or an object that implements Countable
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// 无 Warning
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP80
</span></span></span><span class=line><span class=cl><span class=c1>// Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 调用未定义的常量，现在会抛出一个 E_WARNING 错误（之前版本中为 E_NOTICE)）
</span></span></span><span class=line><span class=cl><span class=c1>// PHP8 将不会转化成他们自身的字符串，同时抛出 Error 异常
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>MY_CONST</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: Use of undefined constant MY_CONST - assumed &#39;MY_CONST&#39;
</span></span></span><span class=line><span class=cl><span class=c1>// string(8) &#34;MY_CONST&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// Notice: Use of undefined constant MY_CONST
</span></span></span><span class=line><span class=cl><span class=c1>// string(8) &#34;MY_CONST&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP80
</span></span></span><span class=line><span class=cl><span class=c1>// Fatal error: Uncaught Error: Undefined constant &#34;MY_CONST&#34;
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// bcmod 任意精度数字取模，添加新增参数 scale
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>bcmod</span><span class=p>(</span><span class=s2>&#34;4&#34;</span><span class=p>,</span> <span class=s2>&#34;3.5&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// string(1) &#34;0&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// string(1) &#34;1&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=nx>bcmod</span><span class=p>(</span><span class=s2>&#34;4&#34;</span><span class=p>,</span> <span class=s2>&#34;3.5&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// string(3) &#34;0.5&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// Warning: bcmod() expects exactly 2 parameters, 3 given
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// json_decode associative 允许为 null
</span></span></span><span class=line><span class=cl><span class=c1>// 当为 true 时，JSON 对象将返回关联 array；当为 false 时，JSON 对象将返回 object。
</span></span></span><span class=line><span class=cl><span class=c1>// 当为 null 时，JSON 对象将返回关联 array 或 object，这取决于是否在 flags 中设置 JSON_OBJECT_AS_ARRAY
</span></span></span><span class=line><span class=cl><span class=c1>// https://www.php.net/manual/zh/function.json-decode.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$json</span> <span class=o>=</span> <span class=s1>&#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nx>json_decode</span><span class=p>(</span><span class=nv>$json</span><span class=p>,</span> <span class=k>null</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=nx>JSON_OBJECT_AS_ARRAY</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP72
</span></span></span><span class=line><span class=cl><span class=c1>// array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;a&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;b&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(2)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP71
</span></span></span><span class=line><span class=cl><span class=c1>// object(stdClass)#1 (2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;a&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;b&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(2)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><h2 id=php72-to-php73>PHP7.2 to PHP7.3<a hidden class=anchor aria-hidden=true href=#php72-to-php73>#</a></h2><ul><li><a href=https://www.php.net/manual/en/migration72.php>https://www.php.net/manual/en/migration72.php</a></li><li><a href=https://php.watch/versions/7.3>https://php.watch/versions/7.3</a></li></ul><blockquote><p>Heredoc/nowdoc syntax improvements and a bunch of legacy code deprecations.</p></blockquote><h3 id=new-features-73>New Features 7.3<a hidden class=anchor aria-hidden=true href=#new-features-73>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Heredoc Nowdoc 不再需要后跟分号或换行符
</span></span></span><span class=line><span class=cl><span class=c1>// 结束标记可以缩进，结束时所引用的标识符必须在该行的第一列
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$values</span> <span class=o>=</span> <span class=p>[</span><span class=s>&lt;&lt;&lt;</span><span class=dl>END</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>a
</span></span></span><span class=line><span class=cl><span class=s>  b
</span></span></span><span class=line><span class=cl><span class=s>    c
</span></span></span><span class=line><span class=cl><span class=s>END, &#39;d e f&#39;];
</span></span></span><span class=line><span class=cl><span class=s>var_dump($values);
</span></span></span><span class=line><span class=cl><span class=s>// PHP73 array(2) {
</span></span></span><span class=line><span class=cl><span class=s>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=s>//   string(13) &#34;a
</span></span></span><span class=line><span class=cl><span class=s>//   b
</span></span></span><span class=line><span class=cl><span class=s>//     c&#34;
</span></span></span><span class=line><span class=cl><span class=s>//   [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=s>//   string(5) &#34;d e f&#34;
</span></span></span><span class=line><span class=cl><span class=s>// }
</span></span></span><span class=line><span class=cl><span class=s>//
</span></span></span><span class=line><span class=cl><span class=s>// PHP72 Parse error: syntax error, unexpected end of file
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>echo &lt;&lt;&lt;END
</span></span></span><span class=line><span class=cl><span class=s>      a
</span></span></span><span class=line><span class=cl><span class=s>     b
</span></span></span><span class=line><span class=cl><span class=s>    c
</span></span></span><span class=line><span class=cl><span class=s>    </span><span class=dl>END</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73
</span></span></span><span class=line><span class=cl><span class=c1>//   a
</span></span></span><span class=line><span class=cl><span class=c1>//  b
</span></span></span><span class=line><span class=cl><span class=c1>// c
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 Parse error: syntax error, unexpected end of file, expecting variable (T_VARIABLE) or heredoc end (T_END_HEREDOC) or ${ (T_DOLLAR_OPEN_CURLY_BRACES) or {$ (T_CURLY_OPEN)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s>&lt;&lt;&lt;</span><span class=dl>END</span><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  a
</span></span></span><span class=line><span class=cl><span class=s> b
</span></span></span><span class=line><span class=cl><span class=s>c
</span></span></span><span class=line><span class=cl><span class=s>   </span><span class=dl>END</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 Parse error: Invalid body indentation level
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 数组解构支持引用赋值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$arr</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>]];</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>&amp;</span><span class=nv>$a</span><span class=p>,</span> <span class=nv>$b</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$arr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=p>[]</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=p>[]</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$arr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   &amp;array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//     [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//     int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//     [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//     int(2)
</span></span></span><span class=line><span class=cl><span class=c1>//   }
</span></span></span><span class=line><span class=cl><span class=c1>//   [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   array(1) {
</span></span></span><span class=line><span class=cl><span class=c1>//     [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//     int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   }
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 Fatal error: [] and list() assignments cannot be by reference
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 允许将 literals 作为第一个操作数，always false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=k>true</span> <span class=nx>instanceof</span> <span class=k>stdClass</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 bool(false)
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 Fatal error: instanceof expects an object instance, constant given
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 调用中允许尾随逗号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>my</span><span class=p>(</span><span class=nv>$v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;php-</span><span class=si>{</span><span class=nv>$v</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>my</span><span class=p>(</span><span class=mi>73</span><span class=p>,);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 php-73
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 Parse error: syntax error, unexpected &#39;)&#39;
</span></span></span></code></pre></div><h3 id=new-functions-73>New Functions 7.3<a hidden class=anchor aria-hidden=true href=#new-functions-73>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Gets the first key of an array
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>array_key_first</span><span class=p>(</span><span class=k>array</span> <span class=nv>$array</span><span class=p>)</span><span class=o>:</span> <span class=nx>int</span><span class=o>|</span><span class=nx>string</span><span class=o>|</span><span class=k>null</span>
</span></span><span class=line><span class=cl><span class=c1>// Gets the last key of an array
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>array_key_last</span><span class=p>(</span><span class=k>array</span> <span class=nv>$array</span><span class=p>)</span><span class=o>:</span> <span class=nx>int</span><span class=o>|</span><span class=nx>string</span><span class=o>|</span><span class=k>null</span>
</span></span><span class=line><span class=cl><span class=c1>// Get the system&#39;s high resolution time
</span></span></span><span class=line><span class=cl><span class=c1>// [seconds, nanoseconds] int（64 位平台）或 float（32 位平台）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>hrtime</span><span class=p>(</span><span class=nx>bool</span> <span class=nv>$as_number</span> <span class=o>=</span> <span class=k>false</span><span class=p>)</span><span class=o>:</span> <span class=k>array</span><span class=o>|</span><span class=nx>int</span><span class=o>|</span><span class=nx>float</span><span class=o>|</span><span class=k>false</span>
</span></span><span class=line><span class=cl><span class=c1>// 验证变量的内容是否为 countable 值
</span></span></span><span class=line><span class=cl><span class=c1>// return is_array($value) || $value instanceof Countable || $value instanceof ResourceBundle || $value instanceof SimpleXmlElement;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>is_countable</span><span class=p>(</span><span class=nx>mixed</span> <span class=nv>$value</span><span class=p>)</span><span class=o>:</span> <span class=nx>bool</span>
</span></span></code></pre></div><h3 id=backward-incompatible-changes-73>Backward Incompatible Changes 7.3<a hidden class=anchor aria-hidden=true href=#backward-incompatible-changes-73>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Continue Targeting Switch 问题警告
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$foo</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=nv>$foo</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$foo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;baz&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>         <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=nv>$foo</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 Warning: &#34;continue&#34; targeting switch is equivalent to &#34;break&#34;. Did you mean to use &#34;continue 2&#34;?
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 ok
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// $obj[&#34;123&#34;] 类型的数组访问，其中 $obj 实现 ArrayAccess 且 &#34;123&#34; 是整数字符串文字将不再导致隐式转换为整数
</span></span></span><span class=line><span class=cl><span class=c1>// 数组的行为不会受到任何影响，它们继续将整数字符串键隐式转换为整数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>A</span> <span class=k>implements</span> <span class=nx>\ArrayAccess</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>offsetExists</span><span class=p>(</span><span class=nv>$offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>offsetGet</span><span class=p>(</span><span class=nv>$offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>var_dump</span><span class=p>(</span><span class=nv>$offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>offsetSet</span><span class=p>(</span><span class=nv>$offset</span><span class=p>,</span> <span class=nv>$value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>offsetUnset</span><span class=p>(</span><span class=nv>$offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>A</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=p>[</span><span class=s2>&#34;123&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP73 string(3) &#34;123&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// PHP72 int(123)
</span></span></span></code></pre></div><h2 id=php73-to-php74>PHP7.3 to PHP7.4<a hidden class=anchor aria-hidden=true href=#php73-to-php74>#</a></h2><ul><li><a href=https://www.php.net/manual/en/migration74.php>https://www.php.net/manual/en/migration74.php</a></li><li><a href=https://php.watch/versions/7.4>https://php.watch/versions/7.4</a></li></ul><blockquote><p>PHP 7.4, the final release in the PHP 7.x series. PHP 7.4 brings typed properties, underscore numeric separator, and other minor improvements to PHP.</p></blockquote><h3 id=new-features-74>New Features 7.4<a hidden class=anchor aria-hidden=true href=#new-features-74>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Typed properties
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>User</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nx>int</span> <span class=nv>$id</span><span class=p>;</span> <span class=c1>// 会强制要求 $user-&gt;id 只能为 int 类型，访问前必须进行处理化，?int 也要进行初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 箭头函数 Arrow functions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$factor</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$nums</span> <span class=o>=</span> <span class=nx>array_map</span><span class=p>(</span><span class=nx>fn</span><span class=p>(</span><span class=nv>$n</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$n</span> <span class=o>*</span> <span class=nv>$factor</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 有限的 Limited 返回类型协变和参数类型逆变
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>A</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span> <span class=k>extends</span> <span class=nx>A</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Producer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>method</span><span class=p>()</span><span class=o>:</span> <span class=nx>A</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ChildProducer</span> <span class=k>extends</span> <span class=nx>Producer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>method</span><span class=p>()</span><span class=o>:</span> <span class=nx>B</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP74 ok
</span></span></span><span class=line><span class=cl><span class=c1>// PHP73 Fatal error: Declaration of ChildProducer::method(): B must be compatible with Producer::method(): A
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 空合并赋值运算符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;key1&#39;</span><span class=p>]</span> <span class=o>??=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// is roughly equivalent to
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$array</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$array</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// array(2) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;key1&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(1)
</span></span></span><span class=line><span class=cl><span class=c1>//   [&#34;key2&#34;]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   int(2)
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Unpacking inside arrays
</span></span></span><span class=line><span class=cl><span class=c1>// 可以平替 array_merge
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$parts</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;pear&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$fruits</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=o>...</span><span class=nv>$parts</span><span class=p>,</span> <span class=s1>&#39;watermelon&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$fruits</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// array(4) {
</span></span></span><span class=line><span class=cl><span class=c1>//   [0]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(6) &#34;orange&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//   [1]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(5) &#34;apple&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//   [2]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(4) &#34;pear&#34;
</span></span></span><span class=line><span class=cl><span class=c1>//   [3]=&gt;
</span></span></span><span class=line><span class=cl><span class=c1>//   string(10) &#34;watermelon&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 数字文字分隔符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mf>6.674</span><span class=nx>_083e</span><span class=o>-</span><span class=mi>11</span><span class=p>;</span> <span class=c1>// float
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>299_792_458</span><span class=p>;</span>   <span class=c1>// decimal
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mh>0xCAFE_F00D</span><span class=p>;</span>   <span class=c1>// hexadecimal
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>0</span><span class=nx>b0101_1111</span><span class=p>;</span>   <span class=c1>// binary
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>((</span><span class=nx>int</span><span class=p>)</span><span class=s2>&#34;1_123&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// int(1)
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// WeakReference 类
</span></span></span><span class=line><span class=cl><span class=c1>// https://www.php.net/manual/zh/class.weakreference.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$obj</span> <span class=o>=</span> <span class=k>new</span> <span class=k>stdClass</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$weakref</span> <span class=o>=</span> <span class=nx>WeakReference</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=nv>$obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$weakref</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>unset</span><span class=p>(</span><span class=nv>$obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$weakref</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=c1>// object(stdClass)#1 (0) {
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1>// NULL
</span></span></span></code></pre></div><h3 id=backward-incompatible-changes-74>Backward Incompatible Changes 7.4<a hidden class=anchor aria-hidden=true href=#backward-incompatible-changes-74>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 以数组形式访问非数组，将会抛出 notic
</span></span></span><span class=line><span class=cl><span class=c1>// null, bool, int, float or resource
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$i</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP74 Notice: Trying to access array offset on value of type int
</span></span></span><span class=line><span class=cl><span class=c1>// PHP73 ok
</span></span></span><span class=line><span class=cl><span class=c1>// PHP80 Warning: Trying to access array offset on value of type int
</span></span></span></code></pre></div><h3 id=deprecated-features-74>Deprecated Features 7.4<a hidden class=anchor aria-hidden=true href=#deprecated-features-74>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// 嵌套的三元运算必须明确地使用括号来指示运算的顺序
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>var_dump</span><span class=p>(</span><span class=mi>1</span> <span class=o>?</span> <span class=mi>2</span> <span class=o>:</span> <span class=mi>3</span> <span class=o>?</span> <span class=mi>4</span> <span class=o>:</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// PHP74 Deprecated: Unparenthesized `a ? b : c ? d : e` is deprecated. Use either `(a ? b : c) ? d : e` or `a ? b : (c ? d : e)`
</span></span></span><span class=line><span class=cl><span class=c1>// PHP73 int(4)
</span></span></span></code></pre></div><p>&ndash; EOF &ndash;</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zyf.im/tags/php/>Php</a></li></ul><nav class=paginav><a class=prev href=https://zyf.im/2022/12/14/php-migrating-74-to-80/><span class=title>« Prev</span><br><span>PHP Migrating 7.4 to 8.0</span>
</a><a class=next href=https://zyf.im/2022/11/28/php-migrating-to-70-71/><span class=title>Next »</span><br><span>PHP Migrating to 7.0 7.1</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>