<!doctype html><html lang=en dir=auto data-theme=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LeetCode Database Trips and Users 262 | ZYF.IM BLOG</title><meta name=keywords content="leetcode"><meta name=description content="262. Trips and Users
  The Trips table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).
+----+-----------+-----------+---------+--------------------+----------+
| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|
+----+-----------+-----------+---------+--------------------+----------+
| 1  |     1     |    10     |    1    |     completed      |2013-10-01|
| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|
| 3  |     3     |    12     |    6    |     completed      |2013-10-01|
| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|
| 5  |     1     |    10     |    1    |     completed      |2013-10-02|
| 6  |     2     |    11     |    6    |     completed      |2013-10-02|
| 7  |     3     |    12     |    6    |     completed      |2013-10-02|
| 8  |     2     |    12     |    12   |     completed      |2013-10-03|
| 9  |     3     |    10     |    12   |     completed      |2013-10-03|
| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|
+----+-----------+-----------+---------+--------------------+----------+
  The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’)."><meta name=author content="Me"><link rel=canonical href=https://zyf.im/2016/09/14/leetcode-database-trips-and-users-262/><link crossorigin=anonymous href=/assets/css/stylesheet.88888b1f97bcb20b824590bc7c6603a852913a2540638b3b3e2663e642691da3.css integrity="sha256-iIiLH5e8sguCRZC8fGYDqFKROiVAY4s7PiZj5kJpHaM=" rel="preload stylesheet" as=style><link rel=icon href=https://zyf.im/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zyf.im/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zyf.im/favicon-32x32.png><link rel=apple-touch-icon href=https://zyf.im/apple-touch-icon.png><link rel=mask-icon href=https://zyf.im/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zyf.im/2016/09/14/leetcode-database-trips-and-users-262/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6DVZ6E58DG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6DVZ6E58DG")}</script><meta property="og:url" content="https://zyf.im/2016/09/14/leetcode-database-trips-and-users-262/"><meta property="og:site_name" content="ZYF.IM BLOG"><meta property="og:title" content="LeetCode Database Trips and Users 262"><meta property="og:description" content="262. Trips and Users The Trips table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).
+----+-----------+-----------+---------+--------------------+----------+ | Id | Client_Id | Driver_Id | City_Id | Status |Request_at| +----+-----------+-----------+---------+--------------------+----------+ | 1 | 1 | 10 | 1 | completed |2013-10-01| | 2 | 2 | 11 | 1 | cancelled_by_driver|2013-10-01| | 3 | 3 | 12 | 6 | completed |2013-10-01| | 4 | 4 | 13 | 6 | cancelled_by_client|2013-10-01| | 5 | 1 | 10 | 1 | completed |2013-10-02| | 6 | 2 | 11 | 6 | completed |2013-10-02| | 7 | 3 | 12 | 6 | completed |2013-10-02| | 8 | 2 | 12 | 12 | completed |2013-10-03| | 9 | 3 | 10 | 12 | completed |2013-10-03| | 10 | 4 | 13 | 12 | cancelled_by_driver|2013-10-03| +----+-----------+-----------+---------+--------------------+----------+ The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’)."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-09-14T13:45:00+08:00"><meta property="article:modified_time" content="2016-09-14T13:45:00+08:00"><meta property="article:tag" content="Leetcode"><meta name=twitter:card content="summary"><meta name=twitter:title content="LeetCode Database Trips and Users 262"><meta name=twitter:description content="262. Trips and Users
  The Trips table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).
+----+-----------+-----------+---------+--------------------+----------+
| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|
+----+-----------+-----------+---------+--------------------+----------+
| 1  |     1     |    10     |    1    |     completed      |2013-10-01|
| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|
| 3  |     3     |    12     |    6    |     completed      |2013-10-01|
| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|
| 5  |     1     |    10     |    1    |     completed      |2013-10-02|
| 6  |     2     |    11     |    6    |     completed      |2013-10-02|
| 7  |     3     |    12     |    6    |     completed      |2013-10-02|
| 8  |     2     |    12     |    12   |     completed      |2013-10-03|
| 9  |     3     |    10     |    12   |     completed      |2013-10-03|
| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|
+----+-----------+-----------+---------+--------------------+----------+
  The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zyf.im/posts/"},{"@type":"ListItem","position":2,"name":"LeetCode Database Trips and Users 262","item":"https://zyf.im/2016/09/14/leetcode-database-trips-and-users-262/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LeetCode Database Trips and Users 262","name":"LeetCode Database Trips and Users 262","description":"262. Trips and Users The Trips table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).\n+----+-----------+-----------+---------+--------------------+----------+ | Id | Client_Id | Driver_Id | City_Id | Status |Request_at| +----+-----------+-----------+---------+--------------------+----------+ | 1 | 1 | 10 | 1 | completed |2013-10-01| | 2 | 2 | 11 | 1 | cancelled_by_driver|2013-10-01| | 3 | 3 | 12 | 6 | completed |2013-10-01| | 4 | 4 | 13 | 6 | cancelled_by_client|2013-10-01| | 5 | 1 | 10 | 1 | completed |2013-10-02| | 6 | 2 | 11 | 6 | completed |2013-10-02| | 7 | 3 | 12 | 6 | completed |2013-10-02| | 8 | 2 | 12 | 12 | completed |2013-10-03| | 9 | 3 | 10 | 12 | completed |2013-10-03| | 10 | 4 | 13 | 12 | cancelled_by_driver|2013-10-03| +----+-----------+-----------+---------+--------------------+----------+ The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’).\n","keywords":["leetcode"],"articleBody":"262. Trips and Users The Trips table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).\n+----+-----------+-----------+---------+--------------------+----------+ | Id | Client_Id | Driver_Id | City_Id | Status |Request_at| +----+-----------+-----------+---------+--------------------+----------+ | 1 | 1 | 10 | 1 | completed |2013-10-01| | 2 | 2 | 11 | 1 | cancelled_by_driver|2013-10-01| | 3 | 3 | 12 | 6 | completed |2013-10-01| | 4 | 4 | 13 | 6 | cancelled_by_client|2013-10-01| | 5 | 1 | 10 | 1 | completed |2013-10-02| | 6 | 2 | 11 | 6 | completed |2013-10-02| | 7 | 3 | 12 | 6 | completed |2013-10-02| | 8 | 2 | 12 | 12 | completed |2013-10-03| | 9 | 3 | 10 | 12 | completed |2013-10-03| | 10 | 4 | 13 | 12 | cancelled_by_driver|2013-10-03| +----+-----------+-----------+---------+--------------------+----------+ The Users table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’).\n+----------+--------+--------+ | Users_Id | Banned | Role | +----------+--------+--------+ | 1 | No | client | | 2 | Yes | client | | 3 | No | client | | 4 | No | client | | 10 | No | driver | | 11 | No | driver | | 12 | No | driver | | 13 | No | driver | +----------+--------+--------+ Write a SQL query to find the cancellation rate of requests made by unbanned clients between Oct 1, 2013 and Oct 3, 2013. For the above tables, your SQL query should return the following rows with the cancellation rate being rounded to two decimal places.\n+------------+-------------------+ | Day | Cancellation Rate | +------------+-------------------+ | 2013-10-01 | 0.33 | | 2013-10-02 | 0.00 | | 2013-10-03 | 0.50 | +------------+-------------------+ 大体意思 写一个 SQL 语句，查询非禁止客户（Users 表中 Banned 列为 No 的客户）在 2013-10-1 至 2013-10-3 间的单据取消率，结果为四舍五入后的两位有效数字。\n别人的解法 SELECT Request_at DAY, ROUND(SUM(IF(Status = 'completed', 0, 1)) / COUNT(*), 2) 'Cancellation Rate' FROM Trips t LEFT JOIN Users t1 ON t.Client_Id = t1.Users_Id WHERE t1.Banned = 'No' AND Request_at BETWEEN '2013-10-01' AND '2013-10-03' GROUP BY t.Re quest_at; 这道题主要是统计计算\n笔记： 1、函数：ROUND(column_name,decimals) column_name 必需。要舍入的字段 decimals 必需。规定要返回的小数位数\n2、SUM(IF(Status = 'completed', 0, 1)) 统计 SUM 这里也好巧妙\n3、having 与 where 的区别 having 字句可以让我们筛选成组后的各种数据，where 字句在聚合前先筛选记录，也就是说作用在 group by 和 having 字句前。而 having 子句在聚合后对组记录进行筛选。\nSELECT region, SUM(population), SUM(area) FROM bbc GROUP BY region HAVING SUM(area) \u003e 1000000 在这里，我们不能用 where 来筛选超过 1000000 的地区，因为表中不存在这样一条记录。相反，having 子句可以让我们筛选成组后的各组数据\nReference: LeetCode：Trips and Users - 出租车接单取消率 - Tsybius2014 \u003e mysql 中的 where 和 having 子句的区别 - Hukin\n","wordCount":"436","inLanguage":"en","datePublished":"2016-09-14T13:45:00+08:00","dateModified":"2016-09-14T13:45:00+08:00","author":[{"@type":"Person","name":"Me"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://zyf.im/2016/09/14/leetcode-database-trips-and-users-262/"},"publisher":{"@type":"Organization","name":"ZYF.IM BLOG","logo":{"@type":"ImageObject","url":"https://zyf.im/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://zyf.im/ accesskey=h title="ZYF.IM (Alt + H)"><img src=https://zyf.im/apple-touch-icon.png alt aria-label=logo height=35>ZYF.IM</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://zyf.im/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://zyf.im/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zyf.im/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://zyf.im/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zyf.im/>Home</a>&nbsp;»&nbsp;<a href=https://zyf.im/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">LeetCode Database Trips and Users 262</h1><div class=post-meta><span title='2016-09-14 13:45:00 +0800 CST'>September 14, 2016</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>436 words</span>&nbsp;·&nbsp;<span>Me</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#大体意思>大体意思</a></li><li><a href=#别人的解法>别人的解法</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p><a href=https://leetcode.com/problems/trips-and-users/>262. Trips and Users</a>
  The <code>Trips</code> table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the Users_Id at the <code>Users</code> table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>+</span><span class=c1>----+-----------+-----------+---------+--------------------+----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Client_Id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Driver_Id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>City_Id</span><span class=w> </span><span class=o>|</span><span class=w>        </span><span class=n>Status</span><span class=w>      </span><span class=o>|</span><span class=n>Request_at</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-----------+-----------+---------+--------------------+----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>1</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>10</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w>    </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>01</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>2</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>11</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>cancelled_by_driver</span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>01</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>3</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>3</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>6</span><span class=w>    </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>01</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>4</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>13</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>6</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>cancelled_by_client</span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>01</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>5</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>1</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>10</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w>    </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>6</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>2</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>11</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>6</span><span class=w>    </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>7</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>3</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>6</span><span class=w>    </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>8</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>2</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>03</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>9</span><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=mi>3</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>10</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=n>completed</span><span class=w>      </span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>03</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=mi>4</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>13</span><span class=w>     </span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>cancelled_by_driver</span><span class=o>|</span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>03</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-----------+-----------+---------+--------------------+----------+
</span></span></span></code></pre></div><p>  The <code>Users</code> table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>+</span><span class=c1>----------+--------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Users_Id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Banned</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=k>Role</span><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+--------+--------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>    </span><span class=mi>1</span><span class=w>     </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>2</span><span class=w>     </span><span class=o>|</span><span class=w>   </span><span class=n>Yes</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>3</span><span class=w>     </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>4</span><span class=w>     </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>10</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>driver</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>11</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>driver</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>12</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>driver</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>    </span><span class=mi>13</span><span class=w>    </span><span class=o>|</span><span class=w>   </span><span class=k>No</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>driver</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----------+--------+--------+
</span></span></span></code></pre></div><p>  Write a SQL query to find the cancellation rate of requests made by unbanned clients between Oct 1, 2013 and Oct 3, 2013. For the above tables, your SQL query should return the following rows with the cancellation rate being rounded to two decimal places.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>+</span><span class=c1>------------+-------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>     </span><span class=k>Day</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>Cancellation</span><span class=w> </span><span class=n>Rate</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>01</span><span class=w> </span><span class=o>|</span><span class=w>       </span><span class=mi>0</span><span class=p>.</span><span class=mi>33</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>02</span><span class=w> </span><span class=o>|</span><span class=w>       </span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>2013</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>03</span><span class=w> </span><span class=o>|</span><span class=w>       </span><span class=mi>0</span><span class=p>.</span><span class=mi>50</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-------------------+
</span></span></span></code></pre></div><h3 id=大体意思>大体意思<a hidden class=anchor aria-hidden=true href=#大体意思>#</a></h3><p>写一个 SQL 语句，查询非禁止客户（Users 表中 Banned 列为 No 的客户）在 2013-10-1 至 2013-10-3 间的单据取消率，结果为四舍五入后的两位有效数字。</p><h3 id=别人的解法>别人的解法<a hidden class=anchor aria-hidden=true href=#别人的解法>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>Request_at</span><span class=w> </span><span class=k>DAY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>ROUND</span><span class=p>(</span><span class=k>SUM</span><span class=p>(</span><span class=k>IF</span><span class=p>(</span><span class=n>Status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;completed&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>))</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=s1>&#39;Cancellation Rate&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>   </span><span class=n>Trips</span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Users</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>Client_Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=n>Users_Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>  </span><span class=n>t1</span><span class=p>.</span><span class=n>Banned</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;No&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>Request_at</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2013-10-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2013-10-03&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w>  </span><span class=k>BY</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>Re</span><span class=w> </span><span class=n>quest_at</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>这道题主要是统计计算</p><p>笔记：
1、函数：ROUND(column_name,decimals)
<code>column_name</code> 必需。要舍入的字段
<code>decimals</code> 必需。规定要返回的小数位数</p><p>2、<code>SUM(IF(Status = 'completed', 0, 1))</code>
统计 SUM 这里也好巧妙</p><p>3、<code>having</code> 与 <code>where</code> 的区别
having 字句可以让我们筛选成组后的各种数据，where 字句在聚合前先筛选记录，也就是说作用在 group by 和 having 字句前。而 having 子句在聚合后对组记录进行筛选。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>population</span><span class=p>),</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>area</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>bbc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>region</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HAVING</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>area</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000000</span><span class=w>
</span></span></span></code></pre></div><p>在这里，我们不能用 where 来筛选超过 1000000 的地区，因为表中不存在这样一条记录。相反，having 子句可以让我们筛选成组后的各组数据</p><blockquote><p>Reference:
<a href=https://my.oschina.net/Tsybius2014/blog/496047>LeetCode：Trips and Users - 出租车接单取消率 - Tsybius2014</a> > <a href=http://www.blogjava.net/Johnny-Ajun/archive/2011/08/28/357445.html>mysql 中的 where 和 having 子句的区别 - Hukin</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://zyf.im/tags/leetcode/>Leetcode</a></li></ul><nav class=paginav><a class=prev href=https://zyf.im/2016/09/18/mysql-limit-query-optimization/><span class=title>« Prev</span><br><span>MySQL LIMIT 查询优化</span>
</a><a class=next href=https://zyf.im/2016/09/12/leetcode-database-department-highest-salary-184/><span class=title>Next »</span><br><span>LeetCode Database Department Highest Salary 184</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://zyf.im/>ZYF.IM BLOG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>